import{_ as ke,c as j,i as Te,a as Re,h as K,d as z,b as T,e as N,f as P,s as I,t as S,g as b,j as ze,k as u,S as L,F as ie,m as ce,M as W,l as Se,G as Oe,n as We,o as Ge,W as je,r as He}from"./vendor.5f02b9aa.js";const Ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}};Ue();const Xe={horizontal:[0,0,1,0],vertical:[0,0,0,1],"diagonal-top":[0,0,1,1],"diagonal-bottom":[0,1,1,0]},Ye=(o,e,t,a,r,n)=>{let s;if(e.dir==="radial"){const d=Math.sqrt((t/2)**2+(a/2)**2);s=o.createRadialGradient(r+t/2,n+a/2,d,r+t/2,n+a/2,0)}else{const[d,h,c,f]=Xe[e.dir];s=o.createLinearGradient(r+d*t,n+h*a,r+c*t,n+f*a)}const l=e.colors.length-1;return e.colors.forEach((d,h)=>{s.addColorStop(h/l,d)}),s},le=o=>new Promise(e=>{const t=new Image;t.addEventListener("load",()=>e(t),{once:!0}),t.src=o}),H=async(o,e,t,a,r,n,s=8)=>{if(n.type==="image"){const d=await le(n.data.src);s<8?o.drawImage(d,0,0,d.width*(s/8),d.height*(s/8),a,r,e,t):o.drawImage(d,a,r,e,t);return}const l=await(n.type==="solid"?n.data.color:Ye(o,n.data,e,t,a,r));if(l===null)throw new Error("Cannot create canvas fill style");o.fillStyle=l,o.fillRect(a,r,e,t)},Ke=22,qe="Fira Mono",he=(o,e,t,a,r=!1,n,s,l,d)=>{const h=s/1024;if(h<=.32)return;const c=Ke*h,f=6*h,v=4*h,$="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26".split(",").slice(0,a),m=r?$:$.reverse();o.font=`${c}px ${qe}`,o.textBaseline=l?"middle":"top",m.forEach((k,C)=>{o.fillStyle=n>0?e.onBorder:C%2===0?e.onLight:e.onDark;const g=l?n/2:f,w=(l?t*C+n+t/2:t*C+f)+d;o.textAlign=l?"center":"left",o.fillText(k,g,w)});const p="ABCDEFGHIJKLMNOPQRSTUWVXYZ".split("").slice(0,a),B=r?p.reverse():p;o.textBaseline=l?"middle":"bottom",B.forEach((k,C)=>{o.fillStyle=n>0?e.onBorder:C%2===0?e.onDark:e.onLight;const g=l?t*C+n+t/2:t*C+f,w=(l?s-n/2:s-v)+d;o.textAlign=l?"center":"left",o.fillText(k,g,w)})},Je=(o,e,t)=>{o=o/255,e=e/255,t=t/255;let a=Math.max(o,e,t),r=a-Math.min(o,e,t),n=1-Math.abs(a+a-r-1),s=r&&(a==o?(e-t)/r:a==e?2+(t-o)/r:4+(o-e)/r);return[60*(s<0?s+6:s),n?r/n:0,(a+a-r)/2]};let Ve=(o,e,t)=>{const a=e*Math.min(t,1-t),r=(n,s=(n+o/30)%12)=>t-a*Math.max(Math.min(s-3,9-s,1),-1);return"#"+[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)].map(n=>n.toString(16)).join("")};const fe=(o,e,t=0,a=0)=>{const[r,n,s]=ke(o.length===4?1:2,o.slice(1).split("")).map(f=>parseInt(f.join(""),16));let[l,d,h]=Je(r,n,s);const c=Math.abs(e);return l>=60&&l<240?(l+=e,l<60&&l>60-c?l=60:l>240&&l<240+c&&(l=240)):(l-=e,l>60&&l<60+c?l=60:l<240&&l>240-c&&(l=240)),l=l>360?l-360:l>0?l+360:l,d=Math.min(1,Math.max(0,d+t)),h=Math.min(1,Math.max(0,h+a)),Ve(l,d,h)},Qe="abcdefghijklmnopqrstuwvxyz",ge=(o,e,t)=>{const a=Qe.indexOf(o[0]),r=Number(o[1])-1;return[e?t-a-1:a,e?r:t-r-1]},Ze=async(o,e,t,{dark:a,light:r,moveIndicator:n},s,l,d,h)=>{const[c,f]=ge(e.from,d,l),[v,$]=ge(e.to,d,l),[m,p,B,k]=[c,f,v,$].map(w=>w*t+s);let C,g;if(n.type==="hueShift"){const w={type:"solid",data:{color:r.data.color?fe(r.data.color,n.data):"#00ff0055"}},_={type:"solid",data:{color:a.data.color?fe(a.data.color,n.data):"#00ff0055"}};C=(c+f)%2===0?w:_,g=(v+$)%2===0?w:_}else C={type:"solid",data:{color:n.data}},g=C;H(o,t,t,m,p+h,C),H(o,t,t,B,k+h,g)},de={Event:"E",Site:"S",Round:"N",White:"W",Black:"B",Date:"D",Result:"R",FEN:"F",WhiteElo:"WE",BlackElo:"BE"},Ce=Object.keys(de),et=Object.fromEntries(Object.entries(de).map(([o,e])=>[e,o])),tt=o=>{const e=new j.Chess;if(e.load_pgn(o),e.delete_comments(),!e.header().Result){const s=(o.trim().match(/(1-0)|(0-1)|(1\/2-1\/2)$/)||[])[0];s&&e.header("Result",s)}const t=Object.entries(e.header()),[a,r]=t.length>0?e.pgn().split(`

`):[void 0,e.pgn()];return[t.filter(([s,l])=>Ce.includes(s)&&l!=="?").map(([s,l])=>`[${s} "${l}"]`).sort().join(`
`),r].join(`

`)},Be=o=>{const e=new j.Chess;e.load_pgn(o);const t=e.history().join(" "),a=Object.entries(e.header()).filter(([r])=>Ce.includes(r)).map(([r,n])=>`${de[r]} ${n}`).sort().join(`
`);return btoa([a,t].join(`

`))},ot=o=>{const[e,t]=atob(o).split(`

`);let a;const r=e.split(`
`).map(s=>{const[l,...d]=s.split(" "),h=d.join(" ");return l==="R"&&(a=h),`[${et[l]} "${h}"]`}).join(`
`),n=t.split(" ").map((s,l)=>l%2===0?`${l/2+1}. ${s}`:s).join(" ")+` ${a}`;return[r,n].join(`

`)},at=["January","February","March","April","May","June","July","August","September","October","November","December"],nt=o=>{const[e,t,a]=o.split(".").map(Number),r=Number.isNaN(t)?null:at[t-1],n=Number.isNaN(a)||r===null?null:a,s=Number.isNaN(e)?null:e;return r&&n&&s?`${r} ${n}, ${s}`:r&&s?`${r} ${s}`:s?String(s):""},ue=o=>o.split(",").map(e=>e.trim()).reverse().join(" "),te=o=>{if(o===null)return!1;try{return new URL(o),!0}catch{return!1}},rt=new Map([["q",9],["r",5],["b",3],["n",3],["p",1]]),R=(o,e=null)=>!o||o==="?"?e:o;class U{positions=[];game=new j.Chess;constructor(){}loadPGN(e){const t=new j.Chess,a=new j.Chess;t.load_pgn(tt(e)),t.delete_comments();const r=t.history({verbose:!0}),n=t.header().FEN;return n&&a.load(n),this.positions=[{ply:0,move:null,end:r.length,fen:a.fen(),check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(a.fen()),last:r.length===0}],r.forEach((s,l)=>{a.move(s);const d=a.fen();this.positions.push({ply:l+1,move:s,end:r.length-1-l,fen:d,check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(d),last:l===r.length-1})}),this.game=t,this}loadFEN(e){return this.game=new j.Chess(e),this.positions=[{ply:0,move:null,end:0,fen:e,check:this.game.in_check(),mate:this.game.in_checkmate(),turn:this.game.turn(),material:this.materialInfo(this.game.board()),placement:this.getPlacement(this.game.fen()),last:!0}],this}getPlacement(e){const t=new j.Chess(e).board(),a=[];for(let r=0;r<8;r++)for(let n=0;n<8;n++)if(t[r][n]!==null){const{type:s,color:l}=t[r][n];a.push({x:n,y:r,type:s,color:l})}return a}materialInfo(e){const t=e.flat().filter(Boolean),a={w:0,b:0},r={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}},n={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}};for(const s of t)if(s!==null&&s.type!=="k"){a[s.color]+=rt.get(s.type)??0,n[s.color][s.type]+=1;const l=s.color==="b"?"w":"b";r[l][s.type]===0?r[s.color][s.type]+=1:r[l][s.type]-=1}return{sum:a,imbalance:r,count:n,diff:a.w-a.b}}get length(){return this.positions.length}get header(){const e=this.game.header(),t=R(e.White,"Anonymous"),a=R(e.Black,"Anonymous"),r=R(e.Date);return{White:t,Black:a,WhitePretty:ue(t),BlackPretty:ue(a),WhiteElo:R(e.WhiteElo),BlackElo:R(e.BlackElo),Date:r,DatePretty:r===null?null:nt(r),Event:R(e.Event),Round:R(e.Round),Site:R(e.Site),Result:R(e.Result)}}getTitle({anonymous:e}){const t=this.header,a=e?"Anonymous":t.WhitePretty,r=e?"Anonymous":t.BlackPretty;return`${a} vs ${r}`+(t.Event?` | ${t.Event}`:"")+(t.Round?`, Round ${t.Round}`:"")+(t.DatePretty?` | ${t.DatePretty}`:"")}getFileName(e){const t=this.header,a=e?"Anonymous":t.WhitePretty,r=e?"Anonymous":t.BlackPretty;return((t.Date?`${t.Date.replace(/\?/g,"X").replace(/\./g,"-")}_`:"")+`${a}_${r}`+(t.Event?`_${t.Event}`:"")+(t.Round?`_R${t.Round}`:"")).replace(/\s+/g,"-")}get pgn(){return this.game.pgn()}get anonymousPGN(){const e=this.game.pgn().replace(/\[White .+\]/,'[White "Anonymous"]').replace(/\[Black .+\]/,'[Black "Anonymous"]');return te(this.header.Site)?e.replace(/\[Site .+\]/,'[Site "?"]'):e}getPosition(e){return this.positions[e]??null}getMoves(){return this.positions.slice(1).map(({move:e})=>e?.san)}}const st=()=>{const o=localStorage.getItem("boardConfig"),e=localStorage.getItem("gameConfig"),t=localStorage.getItem("siteConfig");return{boardConfig:o===null?{}:JSON.parse(o),gameConfig:e===null?{}:JSON.parse(e),siteConfig:t===null?{}:JSON.parse(t)}},Ee=Te(),ae=st(),it={size:1024,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!Ee,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},lt={titleScreen:!0,format:"GIF",picSize:"M",animationSize:"M"},dt={darkMode:!0,sounds:!0,speech:!1},ct={boardConfig:{...it,...ae.boardConfig},gameConfig:{...lt,...ae.gameConfig},siteConfig:{...dt,...ae.siteConfig},game:new U,pgn:"",fen:"",moves:[],ply:0,mobile:Ee,layout:window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple",activeTab:"load",playing:!1,anonymous:!1,refreshHash:!0},[i,y]=Re(ct),ht=["adventurer","alfonso_x","alpha","berlin","california","cardinal","cases","cburnett","chess7","chessnut","companion","condal","dubrovny","fantasy","fresca","gioco","governor","harlequin","horsey","icpieces","kingdom","kosal","leipzig","letter","line","lucena","maestro","magnetic","mark","marroquin","maya","mediaeval","merida","millennia","motif","pirat","pirouetti","pixel","regular","reillycraig","riohacha","shapes","smart","spatial","staunty","tatiana","tfb","traveller","utrecht","wisdom"],ft=["bb","bw","kb","kw","nb","nw","pb","pw","qb","qw","rb","rw"];let pe=null,me=new Map;const gt={async load(o){await Promise.all(ft.map(e=>{const t=`/pieces/${o}/${e}.svg`;return le(t).then(a=>{me.set(e,a)})}))},async get(o,e,t){pe!==o&&(await this.load(o),pe=o);const a=`${e}${t}`;return me.get(a)}},ut=async(o,e,t,a,r,n,s,l=!0)=>{const{placement:d,check:h,mate:c,turn:f}=e;o.shadowColor="rgba(0, 0, 0, 0)",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;for(const{x:v,y:$,type:m,color:p}of d){const B=await gt.get(s,m,p),k=r?8-1-$:$,C=r?8-1-v:v;if((h||c)&&m==="k"&&p===f){const g=c?"#ff002f":"#ffa600";o.shadowColor=g,o.shadowBlur=t*(i.mobile,.15),o.shadowOffsetX=0,o.shadowOffsetY=0,o.drawImage(B,a+C*t,a+k*t+n,t,t)}else l&&(o.shadowColor="rgba(0, 0, 0, 0.5)",o.shadowOffsetX=t*.07,o.shadowOffsetY=t*.07,o.shadowBlur=t*.1);o.drawImage(B,a+C*t,a+k*t+n,t,t),o.shadowColor="rgba(0, 0, 0, 0)",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0}},x=(o,e,t,a,r,n,s,l,d)=>(o.font=`${r} ${a}px ${t}`,o.textAlign=l,o.textBaseline="middle",o.fillText(e,n,s,d),Math.ceil(o.measureText(e).width)),pt=async(o,e,t,a,r,n)=>{o.clearRect(0,0,e,e),await H(o,e,e+a*2,0,0,r.border);const s="Ubuntu",l=[{key:"WhitePretty",line:60*t,fontSize:42*t,n:0},{key:"BlackPretty",line:60*t,fontSize:42*t,n:2},{key:"Event",line:30*t,fontSize:20*t,n:4},{key:"Round",line:30*t,fontSize:20*t,n:5},{key:"DatePretty",line:30*t,fontSize:20*t,n:7},{key:"Site",line:30*t,fontSize:20*t,n:8}],d=new Set(Object.keys(n)),h=l.filter(({key:m})=>d.has(m));if(n.WhitePretty&&n.BlackPretty&&h.push({key:"vs",line:50*t,fontSize:20*t,n:1}),(n.Event||n.Round)&&h.push({key:"margin",line:100*t,fontSize:0,n:3}),n.Date||n.Site){const m=n.Event||n.Round?20*t:100*t;h.push({key:"margin",line:m,fontSize:0,n:6})}const c=h.reduce((m,p)=>m+p.line,0);let f=(e+a*2-c)/2;o.fillStyle=r.coords.onBorder,h.sort((m,p)=>m.n-p.n).forEach(({key:m,line:p,fontSize:B})=>{if(m==="vs"){const C=f+p/2;x(o,"vs",s,B,700,e/2,C,"center"),f+=p;return}if(m==="margin"){f+=p;return}const k=n[m];if(k){const C=m==="Round"?`Round ${k}`:k,g=f+p/2;x(o,C,s,B,700,e/2,g,"center",e*.9)}f+=p});const v=await le("/img/logo-full.svg"),$=e*.114*.5;o.shadowColor="rgba(0, 0, 0, 1)",o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=10*t,o.drawImage(v,e/4,a+e+a-$*2,e/2,$),o.shadowColor="rgba(0, 0, 0, 0)",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0},ye={k:"l",q:"w",r:"t",b:"n",n:"j",p:"o"},mt=async(o,e,t,a,r,n,s,l,d)=>{const h=Math.round(20*a);let c=(r-h)/2,f=r/2;const v=c;o.fillStyle=n.coords.onBorder;{const g=x(o,s.White==="Anonymous"?"White":s.White,"Ubuntu",h,700,v,l?f:t-f,"left"),w=s.WhiteElo?` ${s.WhiteElo}`:"";x(o,w,"Fira Mono",h,500,v+g,l?f:t-f,"left")}{const g=x(o,s.Black==="Anonymous"?"Black":s.Black,"Ubuntu",h,700,v,l?t-f:f,"left"),w=s.BlackElo?` ${s.BlackElo}`:"";x(o,w,"Fira Mono",h,500,v+g,l?t-f:f,"left")}let $=0,m=0;if(d.last&&s.Result){const[g,w]=s.Result.split("-"),_=g==="0"?"Lost":g==="1"?"Won":"Draw",D=w==="0"?"Lost":w==="1"?"Won":"Draw",A=x(o,_,"Ubuntu",h,700,e-c,l?f:t-f,"right"),M=x(o,D,"Ubuntu",h,700,e-c,l?t-f:f,"right"),O=Math.max(A,M);$=O+20*a,m=O+20*a}const{diff:p,imbalance:B}=d.material,k=p>0?`+${Math.abs(p)}`:"";$+=x(o,k,"Fira Mono",h,500,e-c-$,l?f:t-f,"right");const C=p<0?`+${Math.abs(p)}`:"";m+=x(o,C,"Fira Mono",h,500,e-c-m,l?t-f:f,"right");for(const[g,w]of Object.entries(B.w))for(let _=0;_<w;_++){const D=x(o,ye[g],"Chess",h,500,e-c-$,(l?f:t-f)-2*a,"right");$+=_===w-1?D*.85:g==="p"?D*.4:D*.6}for(const[g,w]of Object.entries(B.b))for(let _=0;_<w;_++){const D=x(o,ye[g],"Chess",h,500,e-c-m,(l?t-f:f)-2*a,"right");m+=_===w-1?D*.85:g==="p"?D*.4:D*.6}},yt={name:"Standard",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#00ad88"}},light:{type:"solid",data:{color:"#9EE0BC"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#00735a"}},coords:{onLight:"#00735a",onDark:"#d4fff5",onBorder:"#bbfaec"}},bt={name:"Spring",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#6BB53E"}},light:{type:"solid",data:{color:"#C1D997"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"solid",data:{color:"#40761E"}},coords:{onLight:"#40761E",onDark:"#DBF5AD",onBorder:"#DBF5AD"}},vt={name:"Azure",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#277ECE"}},light:{type:"solid",data:{color:"#7DD3E2"}},moveIndicator:{type:"color",data:"#ff000044"},border:{type:"solid",data:{color:"#0F508C"}},coords:{onLight:"#0F508C",onDark:"#ACE3EC",onBorder:"#ACE3EC"}},_t={name:"Clay",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#BF5344"}},light:{type:"solid",data:{color:"#D9B08F"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#793329"}},coords:{onLight:"#793329",onDark:"#F4C8A3",onBorder:"#F4C8A3"}},$t={name:"Rock",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#949494"}},light:{type:"solid",data:{color:"#D4D4D4"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#595959"}},coords:{onLight:"#595959",onDark:"#EAEAEA",onBorder:"#EAEAEA"}},wt={name:"Danny",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#769656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312e2b"}},coords:{onLight:"#40522f",onDark:"#fcfce1",onBorder:"#eeeed2"}},kt={name:"Danny Green",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569666"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#40ff007f"},border:{type:"solid",data:{color:"#2B312B"}},coords:{onLight:"#2F5238",onDark:"#fcfce1",onBorder:"#eeeed2"}},St={name:"Danny Cyan",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00ff807f"},border:{type:"solid",data:{color:"#2B3130"}},coords:{onLight:"#2F5152",onDark:"#fcfce1",onBorder:"#eeeed2"}},Ct={name:"Danny Blue",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#566696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00bfff7f"},border:{type:"solid",data:{color:"#2B2E31"}},coords:{onLight:"#2F3752",onDark:"#fcfce1",onBorder:"#eeeed2"}},Bt={name:"Danny Purple",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#765696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38af7f"},border:{type:"solid",data:{color:"#2D2B31"}},coords:{onLight:"#412F52b",onDark:"#fcfce1",onBorder:"#eeeed2"}},Et={name:"Danny Pink",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965686"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38637f"},border:{type:"solid",data:{color:"#312B31"}},coords:{onLight:"#522F49",onDark:"#fcfce1",onBorder:"#eeeed2"}},Dt={name:"Danny Red",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffaf387f"},border:{type:"solid",data:{color:"#312B2D"}},coords:{onLight:"#522F2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},Lt={name:"Danny Yellow",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#968656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312E2B"}},coords:{onLight:"#524A2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},It={name:"Lichess",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b58863"}},light:{type:"solid",data:{color:"#f0d9b5"}},moveIndicator:{type:"hueShift",data:-40},border:{type:"solid",data:{color:"#80634d"}},coords:{onLight:"#9c6f49",onDark:"#f9f0e1",onBorder:"#f9f0e1"}},Pt={name:"Leko",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#919caf"}},light:{type:"solid",data:{color:"#c0c2d0"}},moveIndicator:{type:"hueShift",data:-90},border:{type:"solid",data:{color:"#58606e"}},coords:{onLight:"#58606e",onDark:"#dbe8ff",onBorder:"#dbe8ff"}},Nt={name:"Beige",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#93b092"}},light:{type:"solid",data:{color:"#becfc2"}},moveIndicator:{type:"hueShift",data:90},border:{type:"solid",data:{color:"#596e59"}},coords:{onLight:"#596e59",onDark:"#e4f5e4",onBorder:"#e4f5e4"}},xt={name:"Lila",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#c0acb5"}},light:{type:"solid",data:{color:"#e5d0cb"}},moveIndicator:{type:"hueShift",data:-120},border:{type:"solid",data:{color:"#735c66"}},coords:{onLight:"#876b77",onDark:"#fff5f2",onBorder:"#e5d0cb"}},Ft={name:"Peach",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#E54B4B"}},light:{type:"solid",data:{color:"#EFB293"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#9E3131"}},coords:{onLight:"#e54b4b",onDark:"#EFB293",onBorder:"#EFB293"}},At={name:"Violet",category:"solid",background:{type:"solid",data:{color:"#361b52"}},dark:{type:"solid",data:{color:"#7b4fa8"}},light:{type:"solid",data:{color:"#CB95CB"}},moveIndicator:{type:"hueShift",data:-60},border:{type:"solid",data:{color:"#50346e"}},coords:{onLight:"#50346e",onDark:"#eedeff",onBorder:"#e2c7ff"}},Mt={name:"Danya",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#4c7399"}},light:{type:"solid",data:{color:"#eae9d2"}},moveIndicator:{type:"color",data:"#00a5ff7f"},border:{type:"solid",data:{color:"#2a4057"}},coords:{onLight:"#2a4057",onDark:"#fffff0",onBorder:"#eae9d2"}},Tt={name:"Botez",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#8877b6"}},light:{type:"solid",data:{color:"#efefef"}},moveIndicator:{type:"color",data:"#7dacc97f"},border:{type:"solid",data:{color:"#554973"}},coords:{onLight:"#554973",onDark:"#f2f2f2",onBorder:"#efefef"}},Rt={name:"Beige",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b0a392"}},light:{type:"solid",data:{color:"#cfc8be"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#6e6559"}},coords:{onLight:"#6e6559",onDark:"#f5eee5",onBorder:"#f5eee5"}},zt={name:"Rose",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#F04A73"}},light:{type:"solid",data:{color:"#F7A8A1"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#A62444"}},coords:{onLight:"#f04a73",onDark:"#ffb8c9",onBorder:"#ffb8c9"}},Ot={name:"Avocado",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#72a843"}},light:{type:"solid",data:{color:"#ececa4"}},moveIndicator:{type:"hueShift",data:70},border:{type:"solid",data:{color:"#2d3923"}},coords:{onLight:"#4d7a26",onDark:"#ffffc4",onBorder:"#ececa4"}},Wt={name:"Mono Teal",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#106C73"}},light:{type:"solid",data:{color:"#4C989D"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#106C73"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Gt={name:"Mono Chico",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#885953"}},light:{type:"solid",data:{color:"#AB8A86"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#885953"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},jt={name:"Mono Goblin",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#468557"}},light:{type:"solid",data:{color:"#7DA989"}},moveIndicator:{type:"hueShift",data:40},border:{type:"solid",data:{color:"#468557"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Ht={name:"Mono Mahogany",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#CA3838"}},light:{type:"solid",data:{color:"#DA7373"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#CA3838"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Ut={name:"Mono Blue",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C95D3B"}},light:{type:"solid",data:{color:"#D98D75"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#C95D3B"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Xt={name:"Mono Mulberry",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C24B84"}},light:{type:"solid",data:{color:"#D481A9"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#C24B84"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Yt={name:"Mono Sycamore",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#809D41"}},light:{type:"solid",data:{color:"#A6BA7A"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#809D41"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Kt={name:"Mono Blue",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#514FAE"}},light:{type:"solid",data:{color:"#8583C6"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#514FAE"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},qt={name:"Smooth Sunset",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5B061","#EC366D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC7D47","#C32C73"]}},coords:{onLight:"#CF545D",onDark:"#fff",onBorder:"#fff"}},Jt={name:"Smooth Summer",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5CB61","#F58D61"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#D1AC4F","#D07852"]}},coords:{onLight:"#B2793C",onDark:"#fff",onBorder:"#fff"}},Vt={name:"Smooth Spring",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#D9DC5C","#60C945"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#B9BC4E","#50A839"]}},coords:{onLight:"#81A33A",onDark:"#fff",onBorder:"#fff"}},Qt={name:"Smooth Forest",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#96C93D","#00B09B"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#65A32E","#007A80"]}},coords:{onLight:"#328E57",onDark:"#fff",onBorder:"#fff"}},Zt={name:"Smooth Laguna",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#00c4a0","#096fe0"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#009c7f","#0052ad"]}},coords:{onLight:"#007795",onDark:"#fff",onBorder:"#fff"}},eo={name:"Smooth Sea",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#2881E4","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ff00ff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#1863B7","#773DC1"]}},coords:{onLight:"#4750BC",onDark:"#fff",onBorder:"#fff"}},to={name:"Smooth Violet",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC3BCC","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#AF2EA2","#8243D3"]}},coords:{onLight:"#9838BA",onDark:"#fff",onBorder:"#fff"}},oo={name:"Smooth Mono",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#BFBFBF","#7D7D7D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#A1A1A1","#606060"]}},coords:{onLight:"#818181",onDark:"#fff",onBorder:"#fff"}},ao={name:"Contrast A",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#ff9b38","#389bff"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#f27f0d","#0d7ff2"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},no={name:"Contrast B",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF4DA6","#4D74FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#BB3D7C","#3653BB"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},ro={name:"Contrast C",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF8D4D","#914DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"vertical",colors:["#E8702C","#6334B0"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},so={name:"Contrast D",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#61c43f","#864DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#559a3c","#6333cc"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},io={name:"Wood 1",category:"pic",background:{type:"image",data:{src:"/textures/wood01.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood01_bg.jpg"}},coords:{onLight:"#604939",onDark:"#e1d0b7",onBorder:"#dac4a4"},ico:"/textures/wood01_ico.png"},lo={name:"Wood 2",category:"pic",background:{type:"image",data:{src:"/textures/wood02.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood02_bg.jpg"}},coords:{onLight:"#704642",onDark:"#e1c1b7",onBorder:"#d9b1a5"},ico:"/textures/wood02_ico.png"},co={name:"Wood 3",category:"pic",background:{type:"image",data:{src:"/textures/wood03.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood03_bg.jpg"}},coords:{onLight:"#986738",onDark:"#e2d3b6",onBorder:"#dac7a0"},ico:"/textures/wood03_ico.png"},ho={name:"Wood 4",category:"pic",background:{type:"image",data:{src:"/textures/wood04.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood04_bg.jpg"}},coords:{onLight:"#9e543b",onDark:"#e3c7b5",onBorder:"#ddbba4"},ico:"/textures/wood04_ico.png"},fo={name:"Wood 5",category:"pic",background:{type:"image",data:{src:"/textures/wood05.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood05_bg.jpg"}},coords:{onLight:"#8f653d",onDark:"#e3ceb5",onBorder:"#dcc2a3"},ico:"/textures/wood05_ico.png"},go={name:"Wood 6",category:"pic",background:{type:"image",data:{src:"/textures/wood06.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood06_bg.jpg"}},coords:{onLight:"#865946",onDark:"#dfc8b9",onBorder:"#d7bba8"},ico:"/textures/wood06_ico.png"},uo={name:"Wood 7",category:"pic",background:{type:"image",data:{src:"/textures/wood07.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood07_bg.jpg"}},coords:{onLight:"#734926",onDark:"#cab99b",onBorder:"#cab99b"},ico:"/textures/wood07_ico.png"},po={name:"Wood 8",category:"pic",background:{type:"image",data:{src:"/textures/wood08.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood08_bg.jpg"}},coords:{onLight:"#723627",onDark:"#cbad9a",onBorder:"#cbad9a"},ico:"/textures/wood08_ico.png"},re={standard:yt,spring:bt,azure:vt,violet:At,rose:zt,peach:Ft,clay:_t,rock:$t,lila:xt,leko:Pt,patina:Nt,mud:Rt,danny:wt,dannyGreen:kt,dannyCyan:St,dannyBlue:Ct,dannyPurple:Bt,dannyPink:Et,dannyRed:Dt,dannyYellow:Lt,lichess:It,danya:Mt,botez:Tt,avocado:Ot,monoChico:Gt,monoMojo:Ut,monoMahogany:Ht,monoMulberry:Xt,monoBlue:Kt,monoTeal:Wt,monoGoblin:jt,monoSycamore:Yt,smoothSunset:qt,smoothSummer:Jt,smoothSpring:Vt,smoothForest:Qt,smoothLaguna:Zt,smoothSea:eo,smoothViolet:to,smoothMono:oo,contrastA:ao,contrastB:no,contrastC:ro,contrastD:so,wood1:io,wood2:lo,wood3:co,wood4:ho,wood5:fo,wood6:go,wood7:uo,wood8:po},mo={size:720,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!0,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},yo={White:"White",Black:"Black",WhitePretty:"White",BlackPretty:"Black",WhiteElo:null,BlackElo:null,Date:null,DatePretty:null,Event:null,Round:null,Site:null,Result:null};class oe{cfg=mo;_anonymous=!1;scale=1;size=0;squareSize=0;innerSize=0;borderWidth=0;margin=0;style=re.standard;header=yo;lastPosition=null;background=null;currentScreen="move";ctx;tempCtx;tempCanvas=document.createElement("canvas");canvas=document.createElement("canvas");constructor(e={}){const t=this.canvas.getContext("2d"),a=this.tempCanvas.getContext("2d");if(this.canvas.classList.add("board"),t===null||a===null)throw new Error("Cannot create canvas 2D context");this.ctx=t,this.tempCtx=a,this.updateConfig(e,!1)}async setCanvas(e){this.canvas=e,this.ctx=e.getContext("2d"),this.setSize(this.cfg.size),await this.refresh()}async updateConfig(e,t=!0){const a={...this.cfg,...e};this.cfg=a,this.setSize(a.size),this.setStyle(a.boardStyle),t&&await this.refresh()}set anonymous(e){this._anonymous=e,this.refresh()}async refresh(){await this.renderBackground(),this.currentScreen==="title"?await this.titleFrame(this.header):this.lastPosition!==null&&await this.frame(this.lastPosition,this.header),this.render()}setSize(e){this.size=e,this.scale=e/720,this.margin=this.cfg.showExtraInfo?Math.round(50*this.scale):0;const t=e+this.margin*2;(this.canvas.width!==e||this.canvas.height!==t)&&(this.canvas.width=e,this.canvas.height=t,this.tempCanvas.width=e,this.tempCanvas.height=t);const a=this.cfg.showBorder?this.size/32:0,r=this.size-a*2;return this.squareSize=Math.floor(r/this.cfg.tiles),this.innerSize=this.squareSize*this.cfg.tiles,this.borderWidth=(this.size-this.innerSize)/2,this}getSize(){return this.size}setStyle(e){return this.style=re[e],this.cfg.boardStyle=e,this.refresh(),this}setPiecesStyle(e){return this.cfg.piecesStyle=e,this.refresh(),this}flip(){return this.cfg.flipped=!this.cfg.flipped,this.refresh(),this}flipWhite(){if(!!this.cfg.flipped)return this.cfg.flipped=!1,this.refresh(),this}flipBlack(){if(!this.cfg.flipped)return this.cfg.flipped=!0,this.refresh(),this}hideBorder(){return this.cfg.showBorder=!1,this.setSize(this.size),this.refresh(),this}showBorder(){return this.cfg.showBorder=!0,this.setSize(this.size),this.refresh(),this}toggleBorder(){return this.cfg.showBorder=!this.cfg.showBorder,this.setSize(this.size),this.refresh(),this}toggleExtraInfo(){return this.cfg.showExtraInfo=!this.cfg.showExtraInfo,this.setSize(this.size),this.refresh(),this}toggleShadows(){return this.cfg.showShadows=!this.cfg.showShadows,this.refresh(),this}getFinalHeader(){return this._anonymous?{...this.header,White:"Anonymous",Black:"Anonymous",WhitePretty:"Anonymous",BlackPretty:"Anonymous",Site:te(this.header.Site)?null:this.header.Site}:{...this.header,Site:te(this.header.Site)?this.header.Site.replace(/^http[s]*:\/\//,""):this.header.Site}}async titleFrame(e){this.currentScreen="title",this.header=e,await pt(this.tempCtx,this.size,this.scale,this.margin,this.style,this.getFinalHeader())}async renderBackground(){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.size,e.height=this.size+this.margin*2;const{background:a,dark:r,light:n,border:s,coords:l}=this.style;await H(t,this.width,this.height,0,0,s),await H(t,this.innerSize,this.innerSize,this.cfg.showBorder?this.borderWidth:0,(this.cfg.showBorder?this.borderWidth:0)+this.margin,a,this.cfg.tiles);for(let d=0;d<this.cfg.tiles;d++)for(let h=0;h<this.cfg.tiles;h++){const c=h%2===0&&d%2===0||h%2!==0&&d%2!==0?n:r,f=h*this.squareSize+this.borderWidth,v=d*this.squareSize+this.borderWidth+this.margin;await H(t,this.squareSize,this.squareSize,f,v,c)}this.cfg.showBorder&&this.cfg.showCoords&&he(t,l,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.background=e}async frame(e,t){this.currentScreen="move",this.lastPosition=e,this.header=t??this.header,this.tempCtx.clearRect(0,0,this.size,this.size),this.background===null&&await this.renderBackground(),this.tempCtx.drawImage(await this.background,0,0),this.lastPosition?.move&&this.cfg.showMoveIndicator&&await Ze(this.tempCtx,this.lastPosition.move,this.squareSize,this.style,this.borderWidth,this.cfg.tiles,this.cfg.flipped,this.margin),!this.cfg.showBorder&&this.cfg.showCoords&&he(this.tempCtx,this.style.coords,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.lastPosition&&(await ut(this.tempCtx,this.lastPosition,this.squareSize,this.borderWidth,this.cfg.flipped,this.margin,this.cfg.piecesStyle,this.cfg.showShadows),this.cfg.showExtraInfo&&t&&await mt(this.tempCtx,this.width,this.height,this.scale,this.margin,this.style,this.getFinalHeader(),this.cfg.flipped,this.lastPosition))}render(){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.drawImage(this.tempCanvas,0,0)}toImgUrl(){return this.canvas.toDataURL()}toImageData(){return this.ctx.getImageData(0,0,this.width,this.height)}toClampedArray(){return this.ctx.getImageData(0,0,this.width,this.height).data}toImgElement(){const e=this.toImgUrl(),t=new Image;return t.classList.add("board"),t.src=e,t}get width(){return this.size}get height(){return this.size+this.margin*2}toGIF(){}}const q={move:new K.Howl({src:["/sfx/move.wav"],volume:.3}),take:new K.Howl({src:["/sfx/take.wav"],volume:.9}),swap:new K.Howl({src:["/sfx/swap.wav"],volume:.6}),snap:new K.Howl({src:["/sfx/snap.wav"],volume:.6}),rewind:new K.Howl({src:["/sfx/rewind.wav"],volume:.2})},be={x:" takes ","+":" check!","#":" mate!","=":" promotes to a ",P:"pawn ",R:"rook ",B:"bishop ",N:"knight ",Q:"queen ",K:"king ","O-O":"short castle","O-O-O":"long castle"},Z={volume:50,rate:2,lang:"en-US"},bo=o=>{if(o==="O-O"||o==="O-O-O")o=be[o];else{const e=o.match(/[a-h1-8][a-h][1-8]/);e&&(o=o.replace(e[0],`${e[0][0]} ${e[0][1]}${e[0][2]}`)),o=o.split("").map(t=>be[t]??t).join("").replace(/\s{2,}/g," ")}return o};class vo{voice;constructor(){const e=speechSynthesis.getVoices();this.voice=e.find(t=>t.lang===Z.lang)}say(e){const t=new SpeechSynthesisUtterance(e);t.volume=Z.volume/100,t.lang=Z.lang,this.voice&&(t.voice=this.voice),t.rate=1+Z.rate/10,speechSynthesis.speak(t)}}const _o=o=>new Promise(e=>setTimeout(e,o));class $o{constructor(e,t){this.board=e,this.config=t,this.speech=new vo}interval=1e3;game=new U;ply=0;callback=()=>{};speech;playing=!1;async init(){await this.board.frame(this.game.getPosition(0),this.game.header).then(e=>this.board.render())}watch(e){this.callback=e}updateConfig(e){this.config={...this.config,...e}}getPosition(){const e=this.game.getPosition(this.ply);return y({ply:e.ply}),y({fen:e.fen}),e}async load(e){this.pause(),this.game=e,this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async play(){for(this.playing=!0,this.callback(this.playing,this.ply),this.ply===this.game.getMoves().length&&this.first();await _o(this.interval),!!this.playing;)this.next()}pause(){this.playing=!1,this.callback(this.playing,this.ply)}async prev(){const e=this.ply-1;if(!(e<-1||e<0&&this.config.titleScreen===!1)){if(this.ply=e,e===-1){await this.board.titleFrame(this.game.header),this.board.render();return}await this.board.frame(this.getPosition(),this.game.header),this.board.render(),i.siteConfig.sounds&&q.rewind.play()}}async next(){const e=this.ply+1;if(e>=this.game.length){this.pause();return}this.ply=e;const t=this.getPosition();if(await this.board.frame(t,this.game.header),this.board.render(),this.ply>0&&i.siteConfig.speech&&this.speech.say(bo(t.move?.san)),this.ply>0&&i.siteConfig.sounds&&(t.mate?q.snap.play():/[ce]/.test(t.move?.flags)?q.take.play():/[kqp]/.test(t.move?.flags)?q.swap.play():q.move.play()),t.end===0&&i.siteConfig.speech){const a=this.game.header.Result;a&&this.speech.say(a==="1-0"?"White wins!":a==="0-1"?"Black wins!":"Draw!")}}async first(){this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async last(){this.ply=this.game.length-1,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async goto(e){this.ply=e,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}}const wo=S('<header class="header-box"><div class="header__logo"><a href="/"><div class="header__logo-pic"></div></a></div><div class="header__options"><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico" title="SOURCE CODE"><a href="https://github.com/sharechess/sharechess" target="_blank"><i class="lab la-github"></i></a></div></div></header>'),ko=o=>(T(!0),(()=>{const e=wo.cloneNode(!0),t=e.firstChild,a=t.nextSibling,r=a.firstChild,n=r.firstChild,s=r.nextSibling,l=s.firstChild,d=s.nextSibling,h=d.firstChild;return N(r,"click",o.handlers.toggleSound,!0),N(s,"click",o.handlers.toggleSpeech,!0),N(d,"click",o.handlers.toggleDarkMode,!0),P(c=>{const f=i.siteConfig.sounds?"MUTE":"SOUND ON",v=!i.siteConfig.sounds,$=i.siteConfig.sounds,m=i.siteConfig.speech?"SPEECH OFF":"SPEECH ON",p=!i.siteConfig.speech,B=i.siteConfig.speech,k=i.siteConfig.darkMode?"SWITCH TO LIGHT MODE":"SWITCH TO DARK MODE",C=i.siteConfig.darkMode,g=!i.siteConfig.darkMode;return f!==c._v$&&I(r,"title",c._v$=f),v!==c._v$2&&n.classList.toggle("la-volume-mute",c._v$2=v),$!==c._v$3&&n.classList.toggle("la-volume-up",c._v$3=$),m!==c._v$4&&I(s,"title",c._v$4=m),p!==c._v$5&&l.classList.toggle("la-deaf",c._v$5=p),B!==c._v$6&&l.classList.toggle("la-assistive-listening-systems",c._v$6=B),k!==c._v$7&&I(d,"title",c._v$7=k),C!==c._v$8&&h.classList.toggle("la-sun",c._v$8=C),g!==c._v$9&&h.classList.toggle("la-moon",c._v$9=g),c},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),e})());z(["click"]);const So=S('<div><div class="scrollable__content"></div></div>'),Q=o=>(()=>{const e=So.cloneNode(!0),t=e.firstChild;return b(t,()=>o.children),P(()=>e.className=`scrollable ${o.class}`),e})();const Co=S('<p class="moves__turn"> to move.</p>'),Bo=S('<div class="move"><span class="move__id">.</span><span class="move__ply"></span><span class="move__ply"></span></div>'),Eo=o=>(ze(()=>{i.mobile||document.querySelector(`[data-ply="${i.ply}"]`)?.scrollIntoView()}),u(Q,{get class(){return"moves"+(o.class?` ${o.class}`:"")},get children(){return[u(L,{get when(){return o.moves.length===0},get children(){const e=Co.cloneNode(!0),t=e.firstChild;return b(e,()=>i.game.getPosition(0).turn==="w"?"White":"Black",t),e}}),u(ie,{get each(){return ke(2,o.moves)},children:(e,t)=>{const[a,r]=e;return(()=>{const n=Bo.cloneNode(!0),s=n.firstChild,l=s.firstChild,d=s.nextSibling,h=d.nextSibling;return b(s,()=>t()+1,l),d.$$click=()=>o.handlers.goto(t()*2+1),b(d,a),h.$$click=()=>o.handlers.goto(t()*2+2),b(h,r),P(c=>{const f=i.ply===t()*2+1,v=t()*2+1,$=i.ply===t()*2+2,m=t()*2+2;return f!==c._v$&&d.classList.toggle("move__ply--current",c._v$=f),v!==c._v$2&&I(d,"data-ply",c._v$2=v),$!==c._v$3&&h.classList.toggle("move__ply--current",c._v$3=$),m!==c._v$4&&I(h,"data-ply",c._v$4=m),c},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),n})()}})]}}));z(["click"]);const Do=S('<i class="las la-play"></i>'),Lo=S('<div class="controls"><button class="controls__button controls__button--first" title="FIRST"><i class="las la-angle-double-left"></i></button><button class="controls__button" title="PREV"><i class="las la-angle-left"></i></button><button class="controls__button"></button><button class="controls__button controls__button--next" title="NEXT"><i class="las la-angle-right"></i></button><button class="controls__button controls__button--last" title="LAST"><i class="las la-angle-double-right"></i></button><button title="FLIP" class="flip__button"><i class="las la-sync rotatable" class="rotatable"></i></button></div>'),Io=S('<i class="las la-pause"></i>'),De=o=>(()=>{const e=Lo.cloneNode(!0),t=e.firstChild,a=t.nextSibling,r=a.nextSibling,n=r.nextSibling,s=n.nextSibling,l=s.nextSibling,d=l.firstChild;return N(t,"click",o.handlers.first,!0),N(a,"click",o.handlers.prev,!0),N(r,"click",o.handlers.togglePlay,!0),b(r,u(L,{get when(){return!i.playing},get fallback(){return Io.cloneNode(!0)},get children(){return Do.cloneNode(!0)}})),N(n,"click",o.handlers.next,!0),N(s,"click",o.handlers.last,!0),N(l,"click",o.handlers.flip,!0),P(h=>{const c=i.playing?"PAUSE":"PLAY",f=i.boardConfig.flipped;return c!==h._v$&&I(r,"title",h._v$=c),f!==h._v$2&&d.classList.toggle("rotated",h._v$2=f),h},{_v$:void 0,_v$2:void 0}),e})();z(["click"]);const Le=o=>{if(o===null)return!1;try{return new URL(o).protocol==="https:"}catch{return!1}},ve=S('<span class="info__rating"> (<!>)</span>'),ne=S("<p></p>"),Po=S("<p>Round </p>"),No=S("<a></a>"),xo=S('<div class="info"><div class="info__header"><div class="info__players"><div class="info__player"><div class="info__left"><button class="info__color info__color--white"></button></div><div class="info__right"><span class="info__score"></span></div></div><div class="info__player"><div class="info__left"><button class="info__color info__color--black"></button></div><div class="info__right"><span class="info__score"></span></div></div></div><div class="info__event"></div><div class="info__site"></div></div><div class="info__analyze"><button><i class="las la-vial"></i> </button></div></div>'),Fo=o=>{const[e,t]=T(!1);return(()=>{const a=xo.cloneNode(!0),r=a.firstChild,n=r.firstChild,s=n.firstChild,l=s.firstChild;l.firstChild;const d=l.nextSibling,h=d.firstChild,c=s.nextSibling,f=c.firstChild;f.firstChild;const v=f.nextSibling,$=v.firstChild,m=n.nextSibling,p=m.nextSibling,B=r.nextSibling,k=B.firstChild;return k.firstChild.nextSibling,b(l,u(L,{get when(){return!i.anonymous},fallback:"Anonymous",get children(){return[ce(()=>i.game.header.WhitePretty)," "]}}),null),b(l,u(L,{get when(){return i.game.header.WhiteElo},get children(){const g=ve.cloneNode(!0),w=g.firstChild,_=w.nextSibling;return _.nextSibling,b(g,()=>i.game.header.WhiteElo,_),g}}),null),b(h,()=>i.game.header.Result==="1-0"?"1":i.game.header.Result==="0-1"?"0":i.game.header.Result==="1/2-1/2"?"1/2":""),b(f,u(L,{get when(){return!i.anonymous},fallback:"Anonymous",get children(){return[ce(()=>i.game.header.BlackPretty)," "]}}),null),b(f,u(L,{get when(){return i.game.header.BlackElo},get children(){const g=ve.cloneNode(!0),w=g.firstChild,_=w.nextSibling;return _.nextSibling,b(g,()=>i.game.header.BlackElo,_),g}}),null),b($,()=>i.game.header.Result==="1-0"?"0":i.game.header.Result==="0-1"?"1":i.game.header.Result==="1/2-1/2"?"1/2":""),b(m,u(L,{get when(){return i.game.header.Event},get children(){const g=ne.cloneNode(!0);return b(g,()=>i.game.header.Event),g}}),null),b(m,u(L,{get when(){return i.game.header.Round},get children(){const g=Po.cloneNode(!0);return g.firstChild,b(g,()=>i.game.header.Round,null),g}}),null),b(p,u(L,{get when(){return i.game.header.Site},get children(){const g=ne.cloneNode(!0);return b(g,u(L,{get when(){return!i.anonymous||!te(i.game.header.Site)},get children(){return u(L,{get when(){return Le(i.game.header.Site)},get fallback(){return i.game.header.Site},get children(){const w=No.cloneNode(!0);return b(w,()=>i.game.header.Site?.replace(/^https:\/\//,"")),P(()=>I(w,"href",i.game.header.Site??"")),w}})}})),g}}),null),b(p,u(L,{get when(){return i.game.header.DatePretty},get children(){const g=ne.cloneNode(!0);return b(g,()=>i.game.header.DatePretty),g}}),null),k.$$click=async()=>{await o.handlers.openOnLichess()||(t(!0),setTimeout(()=>t(!1),1e3))},b(k,()=>e()?"Cannot import to lichess":"Analyze on Lichess",null),P(()=>k.classList.toggle("btn--error",e())),a})()};z(["click"]);const Ie=o=>new Promise((e,t)=>{const a=new FileReader;a.onload=()=>{e(a.result)},a.onerror=t,a.readAsText(o)});const Ao=S('<button class="load__game-btn"><i class="las la-paste"></i> </button>'),_e=S("<hr>"),Mo=S('<textarea class="load__game-input" name="load-game" placeholder="Paste PGN, FEN or Lichess link..."></textarea>'),To=S('<button class="load__game-btn"></button>'),Ro=S('<input type="file" accept="application/vnd.chess-pgn,application/x-chess-pgn,.pgn">'),zo=S('<button class="load__pgn-btn load__pgn-file">Upload PGN file</button>'),Oo=S('<div class="load__pgn-file-info"><p>or</p><p>drop the PGN file anywhere on the page</p></div>'),Wo=o=>{const[e,t]=T(""),[a,r]=T(!1),[n,s]=T(!1);let l;return u(Q,{get class(){return"load"+(o.class?` ${o.class}`:"")},get children(){return[(()=>{const d=Ao.cloneNode(!0);return d.firstChild.nextSibling,d.$$click=async()=>{const c=await navigator.clipboard.readText();await o.handlers.load(c)||(r(!0),setTimeout(()=>r(!1),1e3))},b(d,()=>a()?"Incorrect data":"Load from clipboard",null),P(()=>d.classList.toggle("btn--error",a())),d})(),_e.cloneNode(!0),(()=>{const d=Mo.cloneNode(!0);return d.$$input=h=>t(h.currentTarget.value),I(d,"spellcheck",!1),P(()=>d.value=e()),d})(),(()=>{const d=To.cloneNode(!0);return d.$$click=async()=>{await o.handlers.load(e())||(s(!0),setTimeout(()=>s(!1),1e3)),t("")},b(d,()=>n()?"Incorrect data":"LOAD"),P(()=>d.classList.toggle("btn--error",n())),d})(),_e.cloneNode(!0),(()=>{const d=Ro.cloneNode(!0);d.addEventListener("change",async c=>{const f=c.target;if(f?.files&&f.files.length>0){const v=await Ie(f.files[0]);y("refreshHash",!1),o.handlers.loadPGN(v)}});const h=l;return typeof h=="function"?h(d):l=d,d.style.setProperty("display","none"),d})(),(()=>{const d=zo.cloneNode(!0);return d.$$click=()=>{l&&l.click()},d})(),u(L,{get when(){return!i.mobile},get children(){return Oo.cloneNode(!0)}})]}})};z(["click","input"]);const se=(o,e,t)=>{const a=typeof o=="string"?o:URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=`${e}.${t}`,r.target="_blank",r.click(),URL.revokeObjectURL(a)},Go=S('<div class="share__view"><h2 class="header--first">Board options</h2><button class="options__button"><i class="las la-expand"></i></button><button class="options__button"><i class="las la-info-circle"></i></button><button class="options__button"><i class="las la-heading"></i></button><button class="options__button" title="TOGGLE ANONYMOUS"><i class="las la-user-secret"></i></button><button class="options__button"><i class="las la-cloud"></i></button></div>'),$e=S("<hr>"),jo=S('<div class="share__fen"><h2>Current position</h2><input type="text" name="current_fen" readonly placeholder="Current FEN..."><div class="double"><button class="share__btn share__btn--left"></button><button class="share__btn share__btn--right"></button></div><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__btn"></button></div>'),Ho=S('<div class="share__pgn"><h2>Game</h2><div class="double"><button class="share__btn"></button><button class="share__btn"></button></div><div class="double"><button class="share__btn">Export PGN</button><button class="share__btn"></button></div></div>'),Uo=S('<div class="share__animation"><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__format share__format--first">GIF</button><button class="share__format">MP4</button><button class="share__format share__format--last">WebM</button><button class="share__create-animation"></button></div>'),Pe=o=>{const[e,t]=T(""),[a,r]=T(!1),[n,s]=T(!1),l=d=>{t(d),setTimeout(()=>t(""),1e3)};return u(Q,{get class(){return"share"+(o.class?` ${o.class}`:"")},get children(){return[(()=>{const d=Go.cloneNode(!0),h=d.firstChild,c=h.nextSibling,f=c.nextSibling,v=f.nextSibling,$=v.nextSibling,m=$.nextSibling;return N(c,"click",o.handlers.toggleBorder,!0),N(f,"click",o.handlers.toggleExtraInfo,!0),N(v,"click",o.handlers.toggleTitleScreen,!0),N($,"click",o.handlers.toggleAnonymous,!0),N(m,"click",o.handlers.toggleShadows,!0),P(p=>{const B=i.boardConfig.showBorder,k=i.boardConfig.showBorder?"HIDE BORDER":"SHOW BORDER",C=i.boardConfig.showExtraInfo,g=i.boardConfig.showExtraInfo?"HIDE EXTRA INFO":"SHOW EXTRA INFO",w=i.gameConfig.titleScreen,_=i.gameConfig.titleScreen?"EXCLUDE TITLE SCREEN":"INCLUDE TITLE SCREEN",D=i.anonymous,A=i.boardConfig.showShadows,M=i.boardConfig.showShadows?"HIDE SHADOWS":"SHOW SHADOWS";return B!==p._v$&&c.classList.toggle("options__button--active",p._v$=B),k!==p._v$2&&I(c,"title",p._v$2=k),C!==p._v$3&&f.classList.toggle("options__button--active",p._v$3=C),g!==p._v$4&&I(f,"title",p._v$4=g),w!==p._v$5&&v.classList.toggle("options__button--active",p._v$5=w),_!==p._v$6&&I(v,"title",p._v$6=_),D!==p._v$7&&$.classList.toggle("options__button--active",p._v$7=D),A!==p._v$8&&m.classList.toggle("options__button--active",p._v$8=A),M!==p._v$9&&I(m,"title",p._v$9=M),p},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),d})(),$e.cloneNode(!0),(()=>{const d=jo.cloneNode(!0),h=d.firstChild,c=h.nextSibling,f=c.nextSibling,v=f.firstChild,$=v.nextSibling,m=f.nextSibling,p=m.nextSibling,B=p.nextSibling,k=B.nextSibling,C=k.nextSibling,g=C.nextSibling,w=g.nextSibling;return c.$$click=_=>{_.target.select()},v.$$click=()=>{navigator.clipboard.writeText(i.fen),l("fen")},b(v,()=>e()==="fen"?"Copied!":"Copy FEN"),$.$$click=()=>{const _=`${location.origin}/#fen/${encodeURI(i.fen)}`;navigator.clipboard.writeText(_),l("fen-link")},b($,()=>e()==="fen-link"?"Copied!":"Copy link"),p.$$click=()=>y("gameConfig","picSize","XS"),B.$$click=()=>y("gameConfig","picSize","S"),k.$$click=()=>y("gameConfig","picSize","M"),C.$$click=()=>y("gameConfig","picSize","L"),g.$$click=()=>y("gameConfig","picSize","XL"),w.$$click=async()=>{r(!0),await o.handlers.downloadImage(),r(!1)},b(w,()=>a()?"Please wait...":"Save as image"),P(_=>{const D=i.fen,A=i.gameConfig.picSize==="XS",M=i.gameConfig.picSize==="S",O=i.gameConfig.picSize==="M",X=i.gameConfig.picSize==="L",Y=i.gameConfig.picSize==="XL";return D!==_._v$10&&(c.value=_._v$10=D),A!==_._v$11&&p.classList.toggle("share__size--active",_._v$11=A),M!==_._v$12&&B.classList.toggle("share__size--active",_._v$12=M),O!==_._v$13&&k.classList.toggle("share__size--active",_._v$13=O),X!==_._v$14&&C.classList.toggle("share__size--active",_._v$14=X),Y!==_._v$15&&g.classList.toggle("share__size--active",_._v$15=Y),_},{_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),d})(),u(L,{get when(){return i.pgn},get children(){return[$e.cloneNode(!0),(()=>{const d=Ho.cloneNode(!0),h=d.firstChild,c=h.nextSibling,f=c.firstChild,v=f.nextSibling,$=c.nextSibling,m=$.firstChild,p=m.nextSibling;return f.$$click=()=>{navigator.clipboard.writeText(i.anonymous?i.game.anonymousPGN:i.pgn),l("pgn")},b(f,()=>e()==="pgn"?"Copied!":"Copy PGN"),v.$$click=()=>{navigator.clipboard.writeText(window.location.href),l("pgn-link")},b(v,()=>e()==="pgn-link"?"Copied!":"Copy link"),m.$$click=()=>{const B=new Blob([i.pgn],{type:"application/vnd.chess-pgn;charset=utf-8"}),k=i.game.getFileName(i.anonymous);se(B,k,"pgn")},p.$$click=()=>{const k=`[${i.game.getTitle({anonymous:i.anonymous})}](${window.location.href})`;navigator.clipboard.writeText(k),l("markdown")},b(p,()=>e()==="markdown"?"Copied!":"Copy markdown"),d})(),(()=>{const d=Uo.cloneNode(!0),h=d.firstChild,c=h.nextSibling,f=c.nextSibling,v=f.nextSibling,$=v.nextSibling,m=$.nextSibling,p=m.nextSibling,B=p.nextSibling,k=B.nextSibling,C=k.nextSibling;return c.$$click=()=>y("gameConfig","animationSize","XS"),f.$$click=()=>y("gameConfig","animationSize","S"),v.$$click=()=>y("gameConfig","animationSize","M"),$.$$click=()=>y("gameConfig","animationSize","L"),m.$$click=()=>y("gameConfig","animationSize","XL"),p.$$click=()=>y("gameConfig","format","GIF"),B.$$click=()=>y("gameConfig","format","MP4"),k.$$click=()=>y("gameConfig","format","WebM"),C.$$click=async()=>{s(!0),await o.handlers.downloadAnimation(),s(!1)},b(C,()=>n()?"Please wait...":"Save animation"),P(g=>{const w=i.gameConfig.animationSize==="XS",_=i.gameConfig.animationSize==="S",D=i.gameConfig.animationSize==="M",A=i.gameConfig.animationSize==="L",M=i.gameConfig.animationSize==="XL",O=i.gameConfig.format==="GIF",X=i.gameConfig.format==="MP4",Y=i.gameConfig.format==="WebM";return w!==g._v$16&&c.classList.toggle("share__size--active",g._v$16=w),_!==g._v$17&&f.classList.toggle("share__size--active",g._v$17=_),D!==g._v$18&&v.classList.toggle("share__size--active",g._v$18=D),A!==g._v$19&&$.classList.toggle("share__size--active",g._v$19=A),M!==g._v$20&&m.classList.toggle("share__size--active",g._v$20=M),O!==g._v$21&&p.classList.toggle("share__format--active",g._v$21=O),X!==g._v$22&&B.classList.toggle("share__format--active",g._v$22=X),Y!==g._v$23&&k.classList.toggle("share__format--active",g._v$23=Y),g},{_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0,_v$20:void 0,_v$21:void 0,_v$22:void 0,_v$23:void 0}),d})()]}})]}})};z(["click"]);const Xo=S("<div></div>"),Yo=async()=>{const o=[],e=new oe({size:144,tiles:2,showBorder:!0,showExtraInfo:!1});for(const[t,a]of Object.entries(re)){let r;a.ico?r=a.ico:(await e.updateConfig({boardStyle:t}),await e.frame(null),e.render(),r=e.toImgUrl()),o.push({key:t,name:a.name,category:a.category,img:r})}return o},Ne=o=>{const[e,t]=T([]);return Yo().then(a=>t(a)),u(Q,{get class(){return"boards"+(o.class?` ${o.class}`:"")},get children(){return u(ie,{get each(){return e()},children:a=>(()=>{const r=Xo.cloneNode(!0);return r.$$click=()=>{y("boardConfig","boardStyle",a.key),o.handlers.changeBoardStyle(a.key)},I(r,"draggable",!1),P(n=>{const s="boards__ico"+(i.boardConfig.boardStyle===a.key?" boards__ico--active":""),l=`url(${a.img})`,d=a.name;return s!==n._v$&&(r.className=n._v$=s),l!==n._v$2&&r.style.setProperty("background-image",n._v$2=l),d!==n._v$3&&I(r,"title",n._v$3=d),n},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})()})}})};z(["click"]);const Ko=S("<img>"),qo=ht.map(o=>({key:o,img:`/pieces/${o}/nw.svg`})),xe=o=>u(Q,{get class(){return"pieces"+(o.class?` ${o.class}`:"")},get children(){return u(ie,{each:qo,children:e=>(()=>{const t=Ko.cloneNode(!0);return t.$$click=()=>{y("boardConfig","piecesStyle",e.key),o.handlers.changePiecesStyle(e.key)},I(t,"draggable",!1),P(a=>{const r="pieces__ico"+(i.boardConfig.piecesStyle===e.key?" pieces__ico--active":""),n=e.img,s=e.key;return r!==a._v$&&(t.className=a._v$=r),n!==a._v$2&&I(t,"src",a._v$2=n),s!==a._v$3&&I(t,"title",a._v$3=s),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()})}});z(["click"]);const Jo=S("<button></button>"),G=o=>(()=>{const e=Jo.cloneNode(!0);return e.$$click=()=>o.setTab(o.name),b(e,()=>o.children),P(()=>e.className="tab"+(o.isActive?" tab--active":"")),e})();z(["click"]);const Vo=S('<i class="las la-chess-board"></i>'),Qo=S('<i class="las la-chess"></i>'),Zo=S('<div class="game"><div class="game-tabs"></div></div>'),J=o=>{y("activeTab",o)},ea=o=>(()=>{const e=Zo.cloneNode(!0),t=e.firstChild;return b(t,u(G,{name:"game",setTab:J,get isActive(){return i.activeTab==="game"},children:"GAME"}),null),b(t,u(G,{name:"load",setTab:J,get isActive(){return i.activeTab==="load"},children:"LOAD"}),null),b(t,u(L,{get when(){return i.layout!=="triple"},get children(){return[u(G,{name:"share",setTab:J,get isActive(){return i.activeTab==="share"},children:"SHARE"}),u(G,{name:"boards",setTab:J,get isActive(){return i.activeTab==="boards"},get children(){return Vo.cloneNode(!0)}}),u(G,{name:"pieces",setTab:J,get isActive(){return i.activeTab==="pieces"},get children(){return Qo.cloneNode(!0)}})]}}),null),b(e,u(Se,{get children(){return[u(W,{get when(){return i.activeTab==="game"},get children(){return[u(Fo,{get handlers(){return o.handlers}}),u(Eo,{get moves(){return o.moves},get handlers(){return o.handlers},get class(){return i.layout==="single"?"span2":void 0}}),u(L,{get when(){return i.layout!=="single"},get children(){return u(De,{get handlers(){return o.handlers}})}})]}}),u(W,{get when(){return i.activeTab==="load"},get children(){return u(Wo,{get handlers(){return o.handlers},class:"span3"})}}),u(L,{get when(){return i.layout!=="triple"},get children(){return[u(W,{get when(){return i.activeTab==="share"},get children(){return u(Pe,{get handlers(){return o.handlers},class:"span3"})}}),u(W,{get when(){return i.activeTab==="boards"},get children(){return u(Ne,{get handlers(){return o.handlers},class:"span3"})}}),u(W,{get when(){return i.activeTab==="pieces"},get children(){return u(xe,{get handlers(){return o.handlers},class:"span3"})}})]}})]}}),null),P(()=>t.classList.toggle("game-tabs--condensed",i.layout!=="triple")),e})();const ta=S('<i class="las la-share"></i>'),oa=S('<i class="las la-chess-board"></i>'),aa=S('<i class="las la-chess"></i>'),na=S('<div class="setup"><div class="setup-tabs"></div></div>'),ra=o=>{const[e,t]=T("share");return(()=>{const a=na.cloneNode(!0),r=a.firstChild;return b(r,u(G,{name:"share",setTab:t,get isActive(){return e()==="share"},get children(){return[ta.cloneNode(!0)," SHARE"]}}),null),b(r,u(G,{name:"boards",setTab:t,get isActive(){return e()==="boards"},get children(){return[oa.cloneNode(!0)," BOARDS"]}}),null),b(r,u(G,{name:"pieces",setTab:t,get isActive(){return e()==="pieces"},get children(){return[aa.cloneNode(!0)," PIECES"]}}),null),b(a,u(Se,{get children(){return[u(W,{get when(){return e()==="share"},get children(){return u(Pe,{get handlers(){return o.handlers}})}}),u(W,{get when(){return e()==="boards"},get children(){return u(Ne,{get handlers(){return o.handlers}})}}),u(W,{get when(){return e()==="pieces"},get children(){return u(xe,{get handlers(){return o.handlers}})}})]}}),null),a})()};const sa=S('<div id="setup" class="setup-box"></div>'),ia=S('<div><div class="layout"><div id="board" class="board-box"><canvas class="board" id="canvas"></canvas></div><div id="moves" class="game-box"></div></div></div>'),la=o=>(()=>{const e=ia.cloneNode(!0),t=e.firstChild,a=t.firstChild;a.firstChild;const r=a.nextSibling;return b(e,u(ko,{get handlers(){return o.handlers}}),t),b(t,u(L,{get when(){return i.layout==="triple"},get children(){const n=sa.cloneNode(!0);return b(n,u(ra,{get handlers(){return o.handlers}})),n}}),a),b(a,u(L,{get when(){return i.layout==="single"},get children(){return u(De,{get handlers(){return o.handlers}})}}),null),b(r,u(ea,{get moves(){return o.state.moves},get handlers(){return o.handlers}})),P(n=>{const s=!i.siteConfig.darkMode,l=i.layout==="double";return s!==n._v$&&e.classList.toggle("light",n._v$=s),l!==n._v$2&&a.classList.toggle("board-box--left",n._v$2=l),n},{_v$:void 0,_v$2:void 0}),e})(),F=o=>{switch(o){case"board":localStorage.setItem("boardConfig",JSON.stringify(i.boardConfig));break;case"game":localStorage.setItem("gameConfig",JSON.stringify(i.gameConfig));break;case"site":localStorage.setItem("siteConfig",JSON.stringify(i.siteConfig));break}},Fe={XS:360,S:512,M:720,L:1024,XL:1440},da=async(o,e,t=0,a,r)=>{const n=new U;e?n.loadPGN(e):n.loadFEN(o);const s=new oe({...a,size:Fe[r]}),l=n.getPosition(t);return await s.frame(l,n.header),s.render(),s.toImgUrl()};class Ae{gif;frameTime;constructor(e,t,a,r=1e3){this.gif=new Oe({workers:2,quality:30,width:e,height:t,repeat:a?0:-1}),this.frameTime=r}add(e,t){for(;t--;)this.gif.addFrame(e,{delay:this.frameTime})}render(){return new Promise(e=>{const t=Date.now();this.gif.on("finished",function(a){const r=new File([a],`board_${t}.gif`,{type:"image/gif",lastModified:t});e(r)}),this.gif.render()})}}class ca{constructor(e=1e3){this.frameTime=e,this.video=new We({quality:.8,fileWriter:null,fd:null,frameDuration:1e3,transparent:!1})}video;add(e,t){this.video.addFrame(e,t*this.frameTime)}async render(){const e=await this.video.complete(),t=Date.now();return new File([e],`board_${t}.webm`,{type:"video/webm",lastModified:t})}}class Me{constructor(e,t,a=1e3){this.width=e,this.height=t,this.hme=Ge.createH264MP4Encoder(),this.frameTime=a}hme;encoder=null;frameTime;async setup(e,t){this.encoder=await this.hme,this.encoder.width=e,this.encoder.height=t,this.encoder.frameRate=1e3/this.frameTime,this.encoder.quantizationParameter=10,this.encoder.initialize()}async add(e,t){for(this.encoder===null&&await this.setup(this.width,this.height);t--;)this.encoder?.addFrameRgba(e)}async render(){this.encoder?.finalize();const e=this.encoder?.FS.readFile(this.encoder.outputFilename),t=Date.now(),a=new File([e],`board_${t}.mp4`,{type:"video/mp4",lastModified:t});return this.encoder?.delete(),a}}const we=(o,e)=>e instanceof Ae?o.toImageData():e instanceof Me?o.toClampedArray():o.canvas,ha=async(o,e,t,a,r)=>{const n=new U().loadPGN(o),s=new oe({...e,size:Fe[a]}),l=t==="GIF"?new Ae(s.width,s.height,!0):t==="MP4"?new Me(s.width,s.height):new ca,d=n.header;r&&(await s.titleFrame(d),s.render(),await l.add(we(s,l),4));for(let h=0;h<n.length;h++){const c=n.getPosition(h);await s.frame(c,d),s.render();const f=c.end===0?5:c.ply===0&&!r?2:1;await l.add(we(s,l),f)}return await l.render()},fa=async o=>{const[e,t]=o.pathname.replace(/^\//,"").split("/").map(a=>a.trim());if(/^(([a-z0-9]{8})|([a-z0-9]{12}))$/i.test(e)){const a=e.slice(0,8),r=await fetch(`https://lichess.org/game/export/${a}?evals=0&clocks=0`);if(!String(r.status).startsWith("2"))return{error:!0,errorType:"SERVER_ERROR"};const n=await r.text();return{error:!1,pgn:n,side:String(t).startsWith("black")||o.hash.startsWith("black")?"b":"w"}}return{error:!0,errorType:"INCORRECT_LINK"}},ga=async o=>{let e;try{e=new URL(o)}catch{return{error:!0,errorType:"INCORRECT_LINK"}}return/^(www\.)*lichess\.org/.test(e.hostname)?fa(e):{error:!0,errorType:"INCORRECT_LINK"}},ua=/^([1-8kqrbnp]+\/)+[1-8kqrbnp]+ [wb] ([kq]+|-) ([a-h1-8]{2}|-) [01] \d+$/i,pa=o=>ua.test(o.trim()),ma=/((\[[a-z0-9]+ +"[^"\n\r]+"](\r\n|\r|\n))*(\r\n|\r|\n)+){0,1}\d+\. +[a-h1-8x+#=]+/i,ya=o=>ma.test(o),ee={pgn:"",fen:"",side:"w",ply:0};let E={...ee};const V={set(o){if(o.fen){E={...ee},E.fen=o.fen,location.hash=`fen/${E.fen}`;return}o.pgn&&(E={...ee},E.pgn=Be(o.pgn)),o.side&&(E.side=o.side),o.ply!==void 0&&(E.ply=o.ply),location.hash=`pgn/${E.side}/${E.ply}/${E.pgn}`},get(){return location.href},read(){const[o,...e]=location.hash.split("/");if(/fen/.test(o))E={...ee},E.fen=decodeURI(e.join("/"));else if(/pgn/.test(o)){const[t,a,...r]=e;E.side=t,E.ply=Number(a),E.pgn=r.join("/"),E.fen=""}return{pgn:E.pgn?ot(E.pgn):"",fen:E.fen,side:E.side,ply:E.ply}},entries(){return{...E}}},ba=async(o,e)=>{if(e&&/^https:\/\/lichess\.org\/.{8}/.test(e))return e;const t=new URLSearchParams({pgn:o}).toString();try{const a=await fetch("https://lichess.org/api/import",{headers:{"content-type":"application/x-www-form-urlencoded"},body:t,method:"POST"});if(a.status===200)return(await a.json()).url;throw new Error("Cannot import to lichess")}catch{throw new Error("Cannot import to lichess")}},va=async()=>{const o=new oe(i.boardConfig),e=new $o(o,i.gameConfig);e.watch(n=>y("playing",n)),V.read();const t={prev(){e.pause(),e.prev()},next(){e.pause(),e.next()},first(){e.pause(),e.first()},last(){e.pause(),e.last()},togglePlay(){e.playing?e.pause():e.play()},goto(n){e.pause(),e.goto(n)},toggleBorder(){o.toggleBorder(),y("boardConfig","showBorder",!i.boardConfig.showBorder),F("board")},showBorder(){o.showBorder(),y("boardConfig","showBorder",!0),F("board")},hideBorder(){o.hideBorder(),y("boardConfig","showBorder",!1),F("board")},toggleExtraInfo(){o.toggleExtraInfo(),y("boardConfig","showExtraInfo",!i.boardConfig.showExtraInfo),F("board")},toggleAnonymous(){if(y("anonymous",!i.anonymous),o.anonymous=i.anonymous,i.pgn!==""){const n=i.anonymous?i.game.anonymousPGN:i.game.pgn;window.location.hash=`pgn/${Be(n)}`,y("refreshHash",!1)}},toggleTitleScreen(){y("gameConfig","titleScreen",!i.gameConfig.titleScreen),F("game")},toggleShadows(){o.toggleShadows(),y("boardConfig","showShadows",!i.boardConfig.showShadows),F("board")},flip(){console.log("FLIP"),o.flip(),y("boardConfig","flipped",!i.boardConfig.flipped),y("refreshHash",!1),V.set({side:i.boardConfig.flipped?"b":"w"})},changeBoardStyle(n){o.setStyle(n),y("boardConfig","boardStyle",n),F("board")},changePiecesStyle(n){o.setPiecesStyle(n),y("boardConfig","piecesStyle",n),F("board")},async loadPGN(n,s="w",l=0){const d=new U().loadPGN(n);y({pgn:d.pgn,fen:"",moves:d.getMoves(),ply:0,game:d}),V.set({pgn:d.pgn,side:s,ply:l}),await e.load(d),y("activeTab","game"),s==="w"?o.flipWhite():o.flipBlack(),y("boardConfig","flipped",s==="b"),document.title=`ShareChess - ${d.getTitle({anonymous:!1})}`},async loadFEN(n,s=!0){const l=new U().loadFEN(n);y({pgn:"",fen:n,moves:l.getMoves(),ply:0,game:l}),await e.load(l),s&&(V.set({fen:i.fen}),y("activeTab","game"));const d=l.getPosition(0).turn;d==="w"?o.flipWhite():o.flipBlack(),y("boardConfig","flipped",d==="b"),document.title=`ShareChess - FEN ${n}`},async load(n){return y("refreshHash",!1),pa(n)?(await this.loadFEN(n),!0):ya(n)?(await this.loadPGN(n),!0):Le(n)?(await this.importPGN(n),!0):!1},async importPGN(n){const s=await ga(n);s.error||await this.loadPGN(s.pgn,s.side)},async downloadImage(){await new Promise(s=>setTimeout(s,0));const n=await da(i.fen,i.pgn,i.ply,i.boardConfig,i.gameConfig.picSize);se(n,`fen_${Date.now()}`,"png")},async downloadAnimation(){await new Promise(l=>setTimeout(l,0));const n=await ha(i.pgn,i.boardConfig,i.gameConfig.format,i.gameConfig.animationSize,i.gameConfig.titleScreen),s=i.game.getFileName(i.anonymous);se(n,s,i.gameConfig.format.toLowerCase())},toggleSound(){y("siteConfig","sounds",!i.siteConfig.sounds),F("site")},toggleSpeech(){y("siteConfig","speech",!i.siteConfig.speech),F("site")},toggleDarkMode(){y("siteConfig","darkMode",!i.siteConfig.darkMode),F("site")},async openOnLichess(){if(i.pgn==="")return window.open(`https://lichess.org/analysis/${i.fen.replace(/\s+/g,"_")}`),!0;try{const n=await ba(i.pgn,i.game.header.Site);return window.open(`${n}/${i.boardConfig.flipped?"black":""}`),!0}catch{return!1}}};window.handlers=t,He(()=>u(la,{handlers:t,state:i}),document.getElementById("root"));const a=document.getElementById("canvas");await o.setCanvas(a),await e.init();const r=async(n=!0)=>{y("refreshHash",n);const{pgn:s,fen:l,side:d,ply:h}=V.read();await(s?t.loadPGN(s,d,h):l?t.loadFEN(l):t.loadFEN("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",!1)),h!==0&&t.goto(h),y("refreshHash",!0)};if(await r(!1),document.addEventListener("dblclick",function(n){n.preventDefault()}),window.addEventListener("resize",()=>{y("layout",window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple")}),window.addEventListener("hashchange",()=>{if(!i.refreshHash){y("refreshHash",!0);return}r()}),!i.mobile){const n={ArrowLeft:t.prev,ArrowRight:t.next,ArrowUp:t.first,ArrowDown:t.last," ":t.togglePlay,b:t.toggleBorder,f:t.flip,e:t.toggleExtraInfo};document.addEventListener("keydown",l=>{const d=l.target;n[l.key]&&d?.nodeName!=="INPUT"&&d?.nodeName!=="TEXTAREA"&&(l.preventDefault(),n[l.key]())});const s=l=>{l.preventDefault(),l.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(l=>{document.addEventListener(l,s,!1)}),document.addEventListener("drop",async l=>{if(l.dataTransfer?.files&&l.dataTransfer.files.length>0){const d=await Ie(l.dataTransfer.files[0]);y("refreshHash",!1),t.loadPGN(d)}})}};Promise.all([new Promise(o=>je.load({google:{families:["Ubuntu:500,700","Fira Mono:500"]},custom:{families:["Chess"],urls:["/fonts.css"]},active:()=>o(null)})).catch(()=>null),new Promise(o=>{speechSynthesis.getVoices().length>0?o(null):window.speechSynthesis.onvoiceschanged=o}).catch(()=>null)]).then(()=>va());
