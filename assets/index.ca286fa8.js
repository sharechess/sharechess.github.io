import{_ as Oe,c as U,U as et,i as tt,a as ot,h as L,d as M,b as A,e as N,s as P,t as v,f as m,g as at,j as g,S as D,m as se,F as le,k as W,M as G,l as ze,G as rt,n as nt,o as st,W as it,r as lt}from"./vendor.9523cce0.js";function ln(){import("data:text/javascript,")}const ct=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}};ct();const dt={horizontal:[0,0,1,0],vertical:[0,0,0,1],"diagonal-top":[0,0,1,1],"diagonal-bottom":[0,1,1,0]},ft=(t,e,o,a,r,s)=>{let i;if(e.dir==="radial"){const c=Math.sqrt((o/2)**2+(a/2)**2);i=t.createRadialGradient(r+o/2,s+a/2,c,r+o/2,s+a/2,0)}else{const[c,f,u,d]=dt[e.dir];i=t.createLinearGradient(r+c*o,s+f*a,r+u*o,s+d*a)}const l=e.colors.length-1;return e.colors.forEach((c,f)=>{i.addColorStop(f/l,c)}),i},ce=t=>new Promise(e=>{const o=new Image;o.addEventListener("load",()=>e(o),{once:!0}),o.src=t}),Y=async(t,e,o,a,r,s,i=8)=>{if(s.type==="image"){const c=await ce(s.data.src);i<8?t.drawImage(c,0,0,c.width*(i/8),c.height*(i/8),a,r,e,o):t.drawImage(c,a,r,e,o);return}const l=await(s.type==="solid"?s.data.color:ft(t,s.data,e,o,a,r));if(l===null)throw new Error("Cannot create canvas fill style");t.fillStyle=l,t.fillRect(a,r,e,o)},ht=22,gt="Fira Mono",ge=(t,e,o,a,r=!1,s,i,l,c)=>{const f=i/1024;if(f<=.32)return;const u=ht*f,d=6*f,_=4*f,w="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26".split(",").slice(0,a),b=r?w:w.reverse();t.font=`${u}px ${gt}`,t.textBaseline=l?"middle":"top",b.forEach((C,S)=>{t.fillStyle=s>0?e.onBorder:S%2===0?e.onLight:e.onDark;const h=l?s/2:d,$=(l?o*S+s+o/2:o*S+d)+c;t.textAlign=l?"center":"left",t.fillText(C,h,$)});const p="ABCDEFGHIJKLMNOPQRSTUWVXYZ".split("").slice(0,a),B=r?p.reverse():p;t.textBaseline=l?"middle":"bottom",B.forEach((C,S)=>{t.fillStyle=s>0?e.onBorder:S%2===0?e.onDark:e.onLight;const h=l?o*S+s+o/2:o*S+d,$=(l?i-s/2:i-_)+c;t.textAlign=l?"center":"left",t.fillText(C,h,$)})},ut=(t,e,o)=>{t=t/255,e=e/255,o=o/255;let a=Math.max(t,e,o),r=a-Math.min(t,e,o),s=1-Math.abs(a+a-r-1),i=r&&(a==t?(e-o)/r:a==e?2+(o-t)/r:4+(t-e)/r);return[60*(i<0?i+6:i),s?r/s:0,(a+a-r)/2]};let pt=(t,e,o)=>{const a=e*Math.min(o,1-o),r=(s,i=(s+t/30)%12)=>o-a*Math.max(Math.min(i-3,9-i,1),-1);return"#"+[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)].map(s=>s.toString(16)).join("")};const ue=(t,e,o=0,a=0)=>{const[r,s,i]=Oe(t.length===4?1:2,t.slice(1).split("")).map(d=>parseInt(d.join(""),16));let[l,c,f]=ut(r,s,i);const u=Math.abs(e);return l>=60&&l<240?(l+=e,l<60&&l>60-u?l=60:l>240&&l<240+u&&(l=240)):(l-=e,l>60&&l<60+u?l=60:l<240&&l>240-u&&(l=240)),l=l>360?l-360:l>0?l+360:l,c=Math.min(1,Math.max(0,c+o)),f=Math.min(1,Math.max(0,f+a)),pt(l,c,f)},yt="abcdefghijklmnopqrstuwvxyz",pe=(t,e,o)=>{const a=yt.indexOf(t[0]),r=Number(t[1])-1;return[e?o-a-1:a,e?r:o-r-1]},mt=async(t,e,o,{dark:a,light:r,moveIndicator:s},i,l,c,f)=>{const[u,d]=pe(e.from,c,l),[_,w]=pe(e.to,c,l),[b,p,B,C]=[u,d,_,w].map($=>$*o+i);let S,h;if(s.type==="hueShift"){const $={type:"solid",data:{color:r.data.color?ue(r.data.color,s.data):"#00ff0055"}},k={type:"solid",data:{color:a.data.color?ue(a.data.color,s.data):"#00ff0055"}};S=(u+d)%2===0?$:k,h=(_+w)%2===0?$:k}else S={type:"solid",data:{color:s.data}},h=S;Y(t,o,o,b,p+f,S),Y(t,o,o,B,C+f,h)},de={Event:"E",Site:"S",Round:"N",White:"W",Black:"B",Date:"D",Result:"R",FEN:"F",WhiteElo:"WE",BlackElo:"BE"},We=Object.keys(de),bt=Object.fromEntries(Object.entries(de).map(([t,e])=>[e,t])),He=t=>{const e=new U.Chess;if(e.load_pgn(t),e.delete_comments(),!e.header().Result){const i=(t.trim().match(/(1-0)|(0-1)|(1\/2-1\/2)$/)||[])[0];i&&e.header("Result",i)}const o=Object.entries(e.header()),[a,r]=o.length>0?e.pgn().split(`

`):[void 0,e.pgn()];return[o.filter(([i,l])=>We.includes(i)&&l!=="?").map(([i,l])=>`[${i} "${l}"]`).sort().join(`
`),r].join(`

`)},ye=t=>{const e=new U.Chess;e.load_pgn(t);const o=e.history().join(" "),a=Object.entries(e.header()).filter(([r])=>We.includes(r)).map(([r,s])=>`${de[r]} ${s}`).sort().join(`
`);return btoa([a,o].join(`

`))},vt=t=>{const[e,o]=atob(t).split(`

`);let a;const r=e.split(`
`).map(i=>{const[l,...c]=i.split(" "),f=c.join(" ");return l==="R"&&(a=f),`[${bt[l]} "${f}"]`}).join(`
`),s=o.split(" ").map((i,l)=>l%2===0?`${l/2+1}. ${i}`:i).join(" ")+` ${a}`;return[r,s].join(`

`)},_t=["January","February","March","April","May","June","July","August","September","October","November","December"],$t=t=>{const[e,o,a]=t.split(".").map(Number),r=Number.isNaN(o)?null:_t[o-1],s=Number.isNaN(a)||r===null?null:a,i=Number.isNaN(e)?null:e;return r&&s&&i?`${r} ${s}, ${i}`:r&&i?`${r} ${i}`:i?String(i):""},me=t=>t.split(",").map(e=>e.trim()).reverse().join(" "),ae=t=>{if(t===null)return!1;try{return new URL(t),!0}catch{return!1}},kt=new Map([["q",9],["r",5],["b",3],["n",3],["p",1]]),z=(t,e=null)=>!t||t==="?"?e:t;class q{positions=[];game=new U.Chess;constructor(){}loadPGN(e){const o=new U.Chess,a=new U.Chess;o.load_pgn(He(e)),o.delete_comments();const r=o.history({verbose:!0}),s=o.header().FEN;return s&&a.load(s),this.positions=[{ply:0,move:null,end:r.length,fen:a.fen(),check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(a.fen()),last:r.length===0}],r.forEach((i,l)=>{a.move(i);const c=a.fen();this.positions.push({ply:l+1,move:i,end:r.length-1-l,fen:c,check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(c),last:l===r.length-1})}),this.game=o,this}loadFEN(e){return this.game=new U.Chess(e),this.positions=[{ply:0,move:null,end:0,fen:e,check:this.game.in_check(),mate:this.game.in_checkmate(),turn:this.game.turn(),material:this.materialInfo(this.game.board()),placement:this.getPlacement(this.game.fen()),last:!0}],this}getPlacement(e){const o=new U.Chess(e).board(),a=[];for(let r=0;r<8;r++)for(let s=0;s<8;s++)if(o[r][s]!==null){const{type:i,color:l}=o[r][s];a.push({x:s,y:r,type:i,color:l})}return a}materialInfo(e){const o=e.flat().filter(Boolean),a={w:0,b:0},r={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}},s={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}};for(const i of o)if(i!==null&&i.type!=="k"){a[i.color]+=kt.get(i.type)??0,s[i.color][i.type]+=1;const l=i.color==="b"?"w":"b";r[l][i.type]===0?r[i.color][i.type]+=1:r[l][i.type]-=1}return{sum:a,imbalance:r,count:s,diff:a.w-a.b}}get length(){return this.positions.length}get header(){const e=this.game.header(),o=z(e.White,"Anonymous"),a=z(e.Black,"Anonymous"),r=z(e.Date);return{White:o,Black:a,WhitePretty:me(o),BlackPretty:me(a),WhiteElo:z(e.WhiteElo),BlackElo:z(e.BlackElo),Date:r,DatePretty:r===null?null:$t(r),Event:z(e.Event),Round:z(e.Round),Site:z(e.Site),Result:z(e.Result)}}getTitle({anonymous:e}){const o=this.header,a=e?"Anonymous":o.WhitePretty,r=e?"Anonymous":o.BlackPretty;return`${a} vs ${r}`+(o.Event?` | ${o.Event}`:"")+(o.Round?`, Round ${o.Round}`:"")+(o.DatePretty?` | ${o.DatePretty}`:"")}getFileName(e){const o=this.header,a=e?"Anonymous":o.WhitePretty,r=e?"Anonymous":o.BlackPretty;return((o.Date?`${o.Date.replace(/\?/g,"X").replace(/\./g,"-")}_`:"")+`${a}_${r}`+(o.Event?`_${o.Event}`:"")+(o.Round?`_R${o.Round}`:"")).replace(/\s+/g,"-")}get pgn(){return this.game.pgn()}get anonymousPGN(){const e=this.game.pgn().replace(/\[White .+\]/,'[White "Anonymous"]').replace(/\[Black .+\]/,'[Black "Anonymous"]');return ae(this.header.Site)?e.replace(/\[Site .+\]/,'[Site "?"]'):e}getPosition(e){return this.positions[e]??null}getMoves(){return this.positions.slice(1).map(({move:e})=>e?.san)}}const wt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#00ad88"}},light:{type:"solid",data:{color:"#9EE0BC"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#00735a"}},coords:{onLight:"#00735a",onDark:"#d4fff5",onBorder:"#bbfaec"}},Ct={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#6BB53E"}},light:{type:"solid",data:{color:"#C1D997"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"solid",data:{color:"#40761E"}},coords:{onLight:"#40761E",onDark:"#DBF5AD",onBorder:"#DBF5AD"}},St={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#277ECE"}},light:{type:"solid",data:{color:"#7DD3E2"}},moveIndicator:{type:"color",data:"#ff000044"},border:{type:"solid",data:{color:"#0F508C"}},coords:{onLight:"#0F508C",onDark:"#ACE3EC",onBorder:"#ACE3EC"}},Bt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#BF5344"}},light:{type:"solid",data:{color:"#D9B08F"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#793329"}},coords:{onLight:"#793329",onDark:"#F4C8A3",onBorder:"#F4C8A3"}},Et={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#949494"}},light:{type:"solid",data:{color:"#D4D4D4"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#595959"}},coords:{onLight:"#595959",onDark:"#EAEAEA",onBorder:"#EAEAEA"}},Ft={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#769656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312e2b"}},coords:{onLight:"#40522f",onDark:"#fcfce1",onBorder:"#eeeed2"}},Dt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569666"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#40ff007f"},border:{type:"solid",data:{color:"#2B312B"}},coords:{onLight:"#2F5238",onDark:"#fcfce1",onBorder:"#eeeed2"}},Lt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00ff807f"},border:{type:"solid",data:{color:"#2B3130"}},coords:{onLight:"#2F5152",onDark:"#fcfce1",onBorder:"#eeeed2"}},It={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#566696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00bfff7f"},border:{type:"solid",data:{color:"#2B2E31"}},coords:{onLight:"#2F3752",onDark:"#fcfce1",onBorder:"#eeeed2"}},Pt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#765696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38af7f"},border:{type:"solid",data:{color:"#2D2B31"}},coords:{onLight:"#412F52b",onDark:"#fcfce1",onBorder:"#eeeed2"}},Nt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965686"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38637f"},border:{type:"solid",data:{color:"#312B31"}},coords:{onLight:"#522F49",onDark:"#fcfce1",onBorder:"#eeeed2"}},At={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffaf387f"},border:{type:"solid",data:{color:"#312B2D"}},coords:{onLight:"#522F2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},xt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#968656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312E2B"}},coords:{onLight:"#524A2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},Tt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b58863"}},light:{type:"solid",data:{color:"#f0d9b5"}},moveIndicator:{type:"hueShift",data:-40},border:{type:"solid",data:{color:"#80634d"}},coords:{onLight:"#9c6f49",onDark:"#f9f0e1",onBorder:"#f9f0e1"}},Mt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#919caf"}},light:{type:"solid",data:{color:"#c0c2d0"}},moveIndicator:{type:"hueShift",data:-90},border:{type:"solid",data:{color:"#58606e"}},coords:{onLight:"#58606e",onDark:"#dbe8ff",onBorder:"#dbe8ff"}},Rt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#93b092"}},light:{type:"solid",data:{color:"#becfc2"}},moveIndicator:{type:"hueShift",data:90},border:{type:"solid",data:{color:"#596e59"}},coords:{onLight:"#596e59",onDark:"#e4f5e4",onBorder:"#e4f5e4"}},Ot={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#c0acb5"}},light:{type:"solid",data:{color:"#e5d0cb"}},moveIndicator:{type:"hueShift",data:-120},border:{type:"solid",data:{color:"#735c66"}},coords:{onLight:"#876b77",onDark:"#fff5f2",onBorder:"#e5d0cb"}},zt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#E54B4B"}},light:{type:"solid",data:{color:"#EFB293"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#9E3131"}},coords:{onLight:"#e54b4b",onDark:"#EFB293",onBorder:"#EFB293"}},Wt={category:"solid",background:{type:"solid",data:{color:"#361b52"}},dark:{type:"solid",data:{color:"#7b4fa8"}},light:{type:"solid",data:{color:"#CB95CB"}},moveIndicator:{type:"hueShift",data:-60},border:{type:"solid",data:{color:"#50346e"}},coords:{onLight:"#50346e",onDark:"#eedeff",onBorder:"#e2c7ff"}},Ht={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#4c7399"}},light:{type:"solid",data:{color:"#eae9d2"}},moveIndicator:{type:"color",data:"#00a5ff7f"},border:{type:"solid",data:{color:"#2a4057"}},coords:{onLight:"#2a4057",onDark:"#fffff0",onBorder:"#eae9d2"}},Gt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#8877b6"}},light:{type:"solid",data:{color:"#efefef"}},moveIndicator:{type:"color",data:"#7dacc97f"},border:{type:"solid",data:{color:"#554973"}},coords:{onLight:"#554973",onDark:"#f2f2f2",onBorder:"#efefef"}},jt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b0a392"}},light:{type:"solid",data:{color:"#cfc8be"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#6e6559"}},coords:{onLight:"#6e6559",onDark:"#f5eee5",onBorder:"#f5eee5"}},Ut={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#F04A73"}},light:{type:"solid",data:{color:"#F7A8A1"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#A62444"}},coords:{onLight:"#f04a73",onDark:"#ffb8c9",onBorder:"#ffb8c9"}},Xt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#72a843"}},light:{type:"solid",data:{color:"#ececa4"}},moveIndicator:{type:"hueShift",data:70},border:{type:"solid",data:{color:"#2d3923"}},coords:{onLight:"#4d7a26",onDark:"#ffffc4",onBorder:"#ececa4"}},Yt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#106C73"}},light:{type:"solid",data:{color:"#4C989D"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#106C73"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},qt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#885953"}},light:{type:"solid",data:{color:"#AB8A86"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#885953"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Kt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#468557"}},light:{type:"solid",data:{color:"#7DA989"}},moveIndicator:{type:"hueShift",data:40},border:{type:"solid",data:{color:"#468557"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Jt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#CA3838"}},light:{type:"solid",data:{color:"#DA7373"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#CA3838"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Vt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C95D3B"}},light:{type:"solid",data:{color:"#D98D75"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#C95D3B"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Qt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C24B84"}},light:{type:"solid",data:{color:"#D481A9"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#C24B84"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Zt={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#809D41"}},light:{type:"solid",data:{color:"#A6BA7A"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#809D41"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},eo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#514FAE"}},light:{type:"solid",data:{color:"#8583C6"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#514FAE"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},be="#FF7C44",to="#FFBDA1",oo="#DC4200",ao="#ffffff",ro="#00000088",no={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:be}},light:{type:"solid",data:{color:to}},moveIndicator:{type:"color",data:"#00ffaa55"},border:{type:"solid",data:{color:be}},coords:{onLight:oo,onDark:ao,onBorder:ro}},ve="#F65656",so="#FAAAAA",io="#BC2D2D",lo="#ffffff",co="#00000088",fo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:ve}},light:{type:"solid",data:{color:so}},moveIndicator:{type:"color",data:"#ffff0033"},border:{type:"solid",data:{color:ve}},coords:{onLight:io,onDark:lo,onBorder:co}},_e="#FB6299",ho="#FDB0CC",go="#C8215D",uo="#ffffff",po="#00000088",yo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:_e}},light:{type:"solid",data:{color:ho}},moveIndicator:{type:"color",data:"#ffff0033"},border:{type:"solid",data:{color:_e}},coords:{onLight:go,onDark:uo,onBorder:po}},$e="#C84CF3",mo="#E3A5F9",bo="#881EAC",vo="#ffffff",_o="#00000088",$o={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:$e}},light:{type:"solid",data:{color:mo}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:$e}},coords:{onLight:bo,onDark:vo,onBorder:_o}},ke="#7673FF",ko="#BAB9FF",wo="#3734B0",Co="#ffffff",So="#00000088",Bo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:ke}},light:{type:"solid",data:{color:ko}},moveIndicator:{type:"color",data:"#ff770055"},border:{type:"solid",data:{color:ke}},coords:{onLight:wo,onDark:Co,onBorder:So}},we="#3C85F4",Eo="#9DC2F9",Fo="#1451AE",Do="#ffffff",Lo="#00000088",Io={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:we}},light:{type:"solid",data:{color:Eo}},moveIndicator:{type:"color",data:"#55ff0055"},border:{type:"solid",data:{color:we}},coords:{onLight:Fo,onDark:Do,onBorder:Lo}},Ce="#07C575",Po="#83E2BA",No="#07834F",Ao="#ffffff",xo="#00000088",To={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Ce}},light:{type:"solid",data:{color:Po}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:Ce}},coords:{onLight:No,onDark:Ao,onBorder:xo}},Se="#69C549",Mo="#B4E2A4",Ro="#4C9433",Oo="#ffffff",zo="#00000088",Wo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Se}},light:{type:"solid",data:{color:Mo}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:Se}},coords:{onLight:Ro,onDark:Oo,onBorder:zo}},Be="#AC746D",Ho="#D5B9B6",Go="#704944",jo="#ffffff",Uo="#00000088",Xo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Be}},light:{type:"solid",data:{color:Ho}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:Be}},coords:{onLight:Go,onDark:jo,onBorder:Uo}},Ee="#D47669",Yo="#E9BAB4",qo="#95493F",Ko="#ffffff",Jo="#00000088",Vo={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Ee}},light:{type:"solid",data:{color:Yo}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:Ee}},coords:{onLight:qo,onDark:Ko,onBorder:Jo}},Fe="#DF8F6C",Qo="#EFC7B5",Zo="#A56A51",ea="#ffffff",ta="#00000088",oa={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Fe}},light:{type:"solid",data:{color:Qo}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:Fe}},coords:{onLight:Zo,onDark:ea,onBorder:ta}},De="#EAA464",aa="#F4D1B1",ra="#BD8551",na="#ffffff",sa="#00000088",ia={category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:De}},light:{type:"solid",data:{color:aa}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:De}},coords:{onLight:ra,onDark:na,onBorder:sa}},la={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5B061","#EC366D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC7D47","#C32C73"]}},coords:{onLight:"#CF545D",onDark:"#fff",onBorder:"#fff"}},ca={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5CB61","#F58D61"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#D1AC4F","#D07852"]}},coords:{onLight:"#B2793C",onDark:"#fff",onBorder:"#fff"}},da={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#D9DC5C","#60C945"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#B9BC4E","#50A839"]}},coords:{onLight:"#81A33A",onDark:"#fff",onBorder:"#fff"}},fa={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#96C93D","#00B09B"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#65A32E","#007A80"]}},coords:{onLight:"#328E57",onDark:"#fff",onBorder:"#fff"}},ha={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#00c4a0","#096fe0"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#009c7f","#0052ad"]}},coords:{onLight:"#007795",onDark:"#fff",onBorder:"#fff"}},ga={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#2881E4","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ff00ff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#1863B7","#773DC1"]}},coords:{onLight:"#4750BC",onDark:"#fff",onBorder:"#fff"}},ua={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC3BCC","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#AF2EA2","#8243D3"]}},coords:{onLight:"#9838BA",onDark:"#fff",onBorder:"#fff"}},pa={category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#BFBFBF","#7D7D7D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#A1A1A1","#606060"]}},coords:{onLight:"#818181",onDark:"#fff",onBorder:"#fff"}},ya={category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#ff9b38","#389bff"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#f27f0d","#0d7ff2"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},ma={category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF4DA6","#4D74FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#BB3D7C","#3653BB"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},ba={category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF8D4D","#914DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"vertical",colors:["#E8702C","#6334B0"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},va={category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#61c43f","#864DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#559a3c","#6333cc"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},_a={category:"pic",background:{type:"image",data:{src:"/textures/wood01.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood01_bg.jpg"}},coords:{onLight:"#604939",onDark:"#e1d0b7",onBorder:"#dac4a4"},ico:"/textures/wood01_ico.png"},$a={category:"pic",background:{type:"image",data:{src:"/textures/wood02.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood02_bg.jpg"}},coords:{onLight:"#704642",onDark:"#e1c1b7",onBorder:"#d9b1a5"},ico:"/textures/wood02_ico.png"},ka={category:"pic",background:{type:"image",data:{src:"/textures/wood03.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood03_bg.jpg"}},coords:{onLight:"#986738",onDark:"#e2d3b6",onBorder:"#dac7a0"},ico:"/textures/wood03_ico.png"},wa={category:"pic",background:{type:"image",data:{src:"/textures/wood04.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood04_bg.jpg"}},coords:{onLight:"#9e543b",onDark:"#e3c7b5",onBorder:"#ddbba4"},ico:"/textures/wood04_ico.png"},Ca={category:"pic",background:{type:"image",data:{src:"/textures/wood05.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood05_bg.jpg"}},coords:{onLight:"#8f653d",onDark:"#e3ceb5",onBorder:"#dcc2a3"},ico:"/textures/wood05_ico.png"},Sa={category:"pic",background:{type:"image",data:{src:"/textures/wood06.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood06_bg.jpg"}},coords:{onLight:"#865946",onDark:"#dfc8b9",onBorder:"#d7bba8"},ico:"/textures/wood06_ico.png"},Ba={category:"pic",background:{type:"image",data:{src:"/textures/wood07.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood07_bg.jpg"}},coords:{onLight:"#734926",onDark:"#cab99b",onBorder:"#cab99b"},ico:"/textures/wood07_ico.png"},Ea={category:"pic",background:{type:"image",data:{src:"/textures/wood08.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood08_bg.jpg"}},coords:{onLight:"#723627",onDark:"#cbad9a",onBorder:"#cbad9a"},ico:"/textures/wood08_ico.png"},Q={standard:wt,spring:Ct,azure:St,violet:Wt,rose:Ut,peach:zt,clay:Bt,rock:Et,lila:Ot,leko:Mt,patina:Rt,mud:jt,danny:Ft,danny_green:Dt,danny_cyan:Lt,danny_blue:It,danny_purple:Pt,danny_pink:Nt,danny_red:At,danny_yellow:xt,lichess:Tt,danya:Ht,botez:Gt,avocado:Xt,mono_chico:qt,mono_mojo:Vt,mono_mahogany:Jt,mono_mulberry:Qt,mono_blue:eo,mono_teal:Yt,mono_goblin:Kt,mono_sycamore:Zt,mono_coral:no,mono_flamingo:fo,mono_rose:yo,mono_heliotrope:$o,mono_cornflower:Bo,mono_dodger:Io,mono_meadow:To,mono_mantis:Wo,mono_coper:Xo,mono_contessa:Vo,mono_terracotta:oa,mono_harvest:ia,smooth_sunset:la,smooth_summer:ca,smooth_spring:da,smooth_forest:fa,smooth_laguna:ha,smooth_sea:ga,smooth_violet:ua,smooth_mono:pa,contrast_a:ya,contrast_b:ma,contrast_c:ba,contrast_d:va,wood1:_a,wood2:$a,wood3:ka,wood4:wa,wood5:Ca,wood6:Sa,wood7:Ba,wood8:Ea},Fa=Object.keys(Q),fe=["adventurer","alfonso_x","alpha","anarchy","anarchy_candy","anarchy_sepia","berlin","california","cardinal","cases","cburnett","chess7","chessnut","companion","condal","dubrovny","fantasy","fresca","gioco","governor","harlequin","horsey","icpieces","kingdom","kosal","leipzig","letter","libra","line","lucena","maestro","magnetic","mark","marroquin","maya","mediaeval","merida","millennia","motif","pirat","pirouetti","pixel","regular","reillycraig","riohacha","shapes","smart","spatial","staunty","symmetric","tatiana","tfb","traveller","utrecht","wisdom"],Da=["bb","bw","kb","kw","nb","nw","pb","pw","qb","qw","rb","rw"],La=t=>(Fa.includes(t.boardStyle)||delete t.boardStyle,fe.includes(t.piecesStyle)||delete t.piecesStyle,t),Ia=()=>{const t=localStorage.getItem("boardConfig"),e=localStorage.getItem("gameConfig"),o=localStorage.getItem("siteConfig"),a=localStorage.getItem("recent");return{boardConfig:t===null?{}:La(JSON.parse(t)),gameConfig:e===null?{}:JSON.parse(e),siteConfig:o===null?{}:JSON.parse(o),recent:a===null?[]:JSON.parse(a)}},Le=et(),Pa=tt(),ee=Ia(),Na={size:1024,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!1,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},Aa={titleScreen:!0,format:"GIF",picSize:"M",animationSize:"M"},xa={darkMode:!0,sounds:!0,speech:!1,wrongBrowserPopup:!0,androidAppPopup:!0,iOSAppPopup:!0},Ta={boardConfig:{...Na,...ee.boardConfig},gameConfig:{...Aa,...ee.gameConfig},siteConfig:{...xa,...ee.siteConfig},game:new q,pgn:"",fen:"",moves:[],ply:0,mobile:Pa,layout:window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple",activeTab:"load",playing:!1,anonymous:!1,refreshHash:!0,browser:Le.browser.name,os:Le.os.name,about:!1,recent:ee.recent},[n,y]=ot(Ta);console.log(n);let Ie=null,Pe=new Map;const Ma={async load(t){await Promise.all(Da.map(e=>{const o=`/pieces/${t}/${e}.svg`;return ce(o).then(a=>{Pe.set(e,a)})}))},async get(t,e,o){Ie!==t&&(await this.load(t),Ie=t);const a=`${e}${o}`;return Pe.get(a)}},Ra=async(t,e,o,a,r,s,i,l=!0)=>{const{placement:c,check:f,mate:u,turn:d}=e;t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;for(const{x:_,y:w,type:b,color:p}of c){const B=await Ma.get(i,b,p),C=r?8-1-w:w,S=r?8-1-_:_;if((f||u)&&b==="k"&&p===d){const h=u?"#ff002f":"#ffa600";t.shadowColor=h,t.shadowBlur=o*(n.mobile,.15),t.shadowOffsetX=0,t.shadowOffsetY=0,t.drawImage(B,a+S*o,a+C*o+s,o,o)}else l&&(t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowOffsetX=o*.07,t.shadowOffsetY=o*.07,t.shadowBlur=o*.1);t.drawImage(B,a+S*o,a+C*o+s,o,o),t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}},T=(t,e,o,a,r,s,i,l,c)=>(t.font=`${r} ${a}px ${o}`,t.textAlign=l,t.textBaseline="middle",t.fillText(e,s,i,c),Math.ceil(t.measureText(e).width)),Oa=async(t,e,o,a,r,s)=>{t.clearRect(0,0,e,e),await Y(t,e,e+a*2,0,0,r.border);const i="Ubuntu",l=[{key:"WhitePretty",line:60*o,fontSize:42*o,n:0},{key:"BlackPretty",line:60*o,fontSize:42*o,n:2},{key:"Event",line:30*o,fontSize:20*o,n:4},{key:"Round",line:30*o,fontSize:20*o,n:5},{key:"DatePretty",line:30*o,fontSize:20*o,n:7},{key:"Site",line:30*o,fontSize:20*o,n:8}],c=new Set(Object.keys(s)),f=l.filter(({key:b})=>c.has(b));if(s.WhitePretty&&s.BlackPretty&&f.push({key:"vs",line:50*o,fontSize:20*o,n:1}),(s.Event||s.Round)&&f.push({key:"margin",line:100*o,fontSize:0,n:3}),s.Date||s.Site){const b=s.Event||s.Round?20*o:100*o;f.push({key:"margin",line:b,fontSize:0,n:6})}const u=f.reduce((b,p)=>b+p.line,0);let d=(e+a*2-u)/2;t.fillStyle=r.coords.onBorder,f.sort((b,p)=>b.n-p.n).forEach(({key:b,line:p,fontSize:B})=>{if(b==="vs"){const S=d+p/2;T(t,"vs",i,B,700,e/2,S,"center"),d+=p;return}if(b==="margin"){d+=p;return}const C=s[b];if(C){const S=b==="Round"?`Round ${C}`:C,h=d+p/2;T(t,S,i,B,700,e/2,h,"center",e*.9)}d+=p});const _=await ce("/img/logo-full.svg"),w=e*.114*.5;t.shadowColor="rgba(0, 0, 0, 1)",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=10*o,t.drawImage(_,e/4,a+e+a-w*2,e/2,w),t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0},Ne={k:"l",q:"w",r:"t",b:"n",n:"j",p:"o"},za=async(t,e,o,a,r,s,i,l,c)=>{const f=Math.round(20*a);let u=(r-f)/2,d=r/2;const _=u;t.fillStyle=s.coords.onBorder;{const h=T(t,i.White==="Anonymous"?"White":i.White,"Ubuntu",f,700,_,l?d:o-d,"left"),$=i.WhiteElo?` ${i.WhiteElo}`:"";T(t,$,"Fira Mono",f,500,_+h,l?d:o-d,"left")}{const h=T(t,i.Black==="Anonymous"?"Black":i.Black,"Ubuntu",f,700,_,l?o-d:d,"left"),$=i.BlackElo?` ${i.BlackElo}`:"";T(t,$,"Fira Mono",f,500,_+h,l?o-d:d,"left")}let w=0,b=0;if(c.last&&i.Result){const[h,$]=i.Result.split("-"),k=h==="0"?"Lost":h==="1"?"Won":"Draw",I=$==="0"?"Lost":$==="1"?"Won":"Draw",R=T(t,k,"Ubuntu",f,700,e-u,l?d:o-d,"right"),O=T(t,I,"Ubuntu",f,700,e-u,l?o-d:d,"right"),H=Math.max(R,O);w=H+20*a,b=H+20*a}const{diff:p,imbalance:B}=c.material,C=p>0?`+${Math.abs(p)}`:"";w+=T(t,C,"Fira Mono",f,500,e-u-w,l?d:o-d,"right");const S=p<0?`+${Math.abs(p)}`:"";b+=T(t,S,"Fira Mono",f,500,e-u-b,l?o-d:d,"right");for(const[h,$]of Object.entries(B.w))for(let k=0;k<$;k++){const I=T(t,Ne[h],"Chess",f,500,e-u-w,(l?d:o-d)-2*a,"right");w+=k===$-1?I*.85:h==="p"?I*.4:I*.6}for(const[h,$]of Object.entries(B.b))for(let k=0;k<$;k++){const I=T(t,Ne[h],"Chess",f,500,e-u-b,(l?o-d:d)-2*a,"right");b+=k===$-1?I*.85:h==="p"?I*.4:I*.6}},Wa={size:720,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!0,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},Ha={White:"White",Black:"Black",WhitePretty:"White",BlackPretty:"Black",WhiteElo:null,BlackElo:null,Date:null,DatePretty:null,Event:null,Round:null,Site:null,Result:null};class re{cfg=Wa;_anonymous=!1;scale=1;borderScale=1;size=0;squareSize=0;innerSize=0;borderWidth=0;margin=0;style=Q.standard;header=Ha;lastPosition=null;background=null;currentScreen="move";ctx;tempCtx;tempCanvas=document.createElement("canvas");canvas=document.createElement("canvas");constructor(e={}){const o=this.canvas.getContext("2d"),a=this.tempCanvas.getContext("2d");if(this.canvas.classList.add("board"),o===null||a===null)throw new Error("Cannot create canvas 2D context");this.ctx=o,this.tempCtx=a,this.updateConfig(e,!1)}async setCanvas(e){this.canvas=e,this.ctx=e.getContext("2d"),this.setSize(this.cfg.size),await this.refresh()}async updateConfig(e,o=!0){const a={...this.cfg,...e};this.cfg=a,this.setSize(a.size),this.setStyle(a.boardStyle),o&&await this.refresh()}set anonymous(e){this._anonymous=e,this.refresh()}async refresh(){await this.renderBackground(),this.currentScreen==="title"?await this.titleFrame(this.header):this.lastPosition!==null&&await this.frame(this.lastPosition,this.header),this.render()}setSize(e){this.size=e,this.scale=e/720,this.margin=this.cfg.showExtraInfo?Math.round(50*this.scale):0;const o=e+this.margin*2;(this.canvas.width!==e||this.canvas.height!==o)&&(this.canvas.width=e,this.canvas.height=o,this.tempCanvas.width=e,this.tempCanvas.height=o);const a=this.cfg.showBorder?this.size/32*this.borderScale:0,r=this.size-a*2;return this.squareSize=Math.floor(r/this.cfg.tiles),this.innerSize=this.squareSize*this.cfg.tiles,this.borderWidth=(this.size-this.innerSize)/2,this}getSize(){return this.size}setBorderScale(e){this.borderScale=e}setStyle(e){return this.style=Q[e],this.cfg.boardStyle=e,this.refresh(),this}setPiecesStyle(e){return this.cfg.piecesStyle=e,this.refresh(),this}flip(){return this.cfg.flipped=!this.cfg.flipped,this.refresh(),this}flipWhite(){if(!!this.cfg.flipped)return this.cfg.flipped=!1,this.refresh(),this}flipBlack(){if(!this.cfg.flipped)return this.cfg.flipped=!0,this.refresh(),this}hideBorder(){return this.cfg.showBorder=!1,this.setSize(this.size),this.refresh(),this}showBorder(){return this.cfg.showBorder=!0,this.setSize(this.size),this.refresh(),this}toggleBorder(){return this.cfg.showBorder=!this.cfg.showBorder,this.setSize(this.size),this.refresh(),this}toggleExtraInfo(){return this.cfg.showExtraInfo=!this.cfg.showExtraInfo,this.setSize(this.size),this.refresh(),this}toggleShadows(){return this.cfg.showShadows=!this.cfg.showShadows,this.refresh(),this}getFinalHeader(){return this._anonymous?{...this.header,White:"Anonymous",Black:"Anonymous",WhitePretty:"Anonymous",BlackPretty:"Anonymous",Site:ae(this.header.Site)?null:this.header.Site}:{...this.header,Site:ae(this.header.Site)?this.header.Site.replace(/^http[s]*:\/\//,""):this.header.Site}}async titleFrame(e){this.currentScreen="title",this.header=e,await Oa(this.tempCtx,this.size,this.scale,this.margin,this.style,this.getFinalHeader())}async renderBackground(){const e=document.createElement("canvas"),o=e.getContext("2d");e.width=this.size,e.height=this.size+this.margin*2;const{background:a,dark:r,light:s,border:i,coords:l}=this.style;await Y(o,this.width,this.height,0,0,i),await Y(o,this.innerSize,this.innerSize,this.cfg.showBorder?this.borderWidth:0,(this.cfg.showBorder?this.borderWidth:0)+this.margin,a,this.cfg.tiles);for(let c=0;c<this.cfg.tiles;c++)for(let f=0;f<this.cfg.tiles;f++){const u=f%2===0&&c%2===0||f%2!==0&&c%2!==0?s:r,d=f*this.squareSize+this.borderWidth,_=c*this.squareSize+this.borderWidth+this.margin;await Y(o,this.squareSize,this.squareSize,d,_,u)}this.cfg.showBorder&&this.cfg.showCoords&&ge(o,l,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.background=e}async frame(e,o){this.currentScreen="move",this.lastPosition=e,this.header=o??this.header,this.tempCtx.clearRect(0,0,this.size,this.size),this.background===null&&await this.renderBackground(),this.tempCtx.drawImage(await this.background,0,0),this.lastPosition?.move&&this.cfg.showMoveIndicator&&await mt(this.tempCtx,this.lastPosition.move,this.squareSize,this.style,this.borderWidth,this.cfg.tiles,this.cfg.flipped,this.margin),!this.cfg.showBorder&&this.cfg.showCoords&&ge(this.tempCtx,this.style.coords,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.lastPosition&&(await Ra(this.tempCtx,this.lastPosition,this.squareSize,this.borderWidth,this.cfg.flipped,this.margin,this.cfg.piecesStyle,this.cfg.showShadows),this.cfg.showExtraInfo&&o&&await za(this.tempCtx,this.width,this.height,this.scale,this.margin,this.style,this.getFinalHeader(),this.cfg.flipped,this.lastPosition))}render(){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.drawImage(this.tempCanvas,0,0)}toImgUrl(){return this.canvas.toDataURL()}toImageData(){return this.ctx.getImageData(0,0,this.width,this.height)}toClampedArray(){return this.ctx.getImageData(0,0,this.width,this.height).data}toImgElement(){const e=this.toImgUrl(),o=new Image;return o.classList.add("board"),o.src=e,o}get width(){return this.size}get height(){return this.size+this.margin*2}toGIF(){}}const F={move:new L.Howl({src:["/sfx/move.mp3"],volume:.3}),take:new L.Howl({src:["/sfx/take.mp3"],volume:.9}),swap:new L.Howl({src:["/sfx/swap.mp3"],volume:.6}),snap:new L.Howl({src:["/sfx/snap.mp3"],volume:.6}),rewind:new L.Howl({src:["/sfx/rewind.mp3"],volume:.2}),enPassant:new L.Howl({src:["/sfx/anarchy/en-passant.mp3"],volume:.2}),horsyMove:new L.Howl({src:["/sfx/anarchy/horsy-move.mp3"],volume:.5}),horsyTake:new L.Howl({src:["/sfx/anarchy/horsy-take.mp3"],volume:.5}),brickMove:new L.Howl({src:["/sfx/anarchy/brick-move.mp3"],volume:.3}),brickTake:new L.Howl({src:["/sfx/anarchy/brick-take.mp3"],volume:.2}),brickCastle:new L.Howl({src:["/sfx/anarchy/brick-castle.mp3"],volume:.3}),coneMove:new L.Howl({src:["/sfx/anarchy/cone-move.mp3"],volume:1}),coneTake:new L.Howl({src:["/sfx/anarchy/cone-take.mp3"],volume:.3}),pipiMove:new L.Howl({src:["/sfx/anarchy/pipi-move.mp3"],volume:.2}),pipiTake:new L.Howl({src:["/sfx/anarchy/pipi-take.mp3"],volume:.4}),toyMove:new L.Howl({src:["/sfx/anarchy/toy-move.mp3"],volume:.9}),toyTake:new L.Howl({src:["/sfx/anarchy/toy-take.mp3"],volume:.8}),deathMove:new L.Howl({src:["/sfx/anarchy/death-move.mp3"],volume:.4}),deathTake:new L.Howl({src:["/sfx/anarchy/death-take.mp3"],volume:.25}),death:new L.Howl({src:["/sfx/anarchy/checkmate.mp3"],volume:1}),hit:new L.Howl({src:["/sfx/anarchy/hit.mp3"],volume:.25})},Ae={x:" takes ","+":" check!","#":" mate!","=":" promotes to a ",P:"pawn ",R:"rook ",B:"bishop ",N:"knight ",Q:"queen ",K:"king ","O-O":"short castle","O-O-O":"long castle"},te={volume:50,rate:1,lang:"en-US"},Ga=t=>{if(t==="O-O"||t==="O-O-O")t=Ae[t];else{const e=t.match(/[a-h1-8][a-h][1-8]/);e&&(t=t.replace(e[0],`${e[0][0]} ${e[0][1]}${e[0][2]}`)),t=t.split("").map(o=>Ae[o]??o).join("").replace(/\s{2,}/g," ")}return t};class ja{voice;constructor(){if(!window.speechSynthesis)this.voice=void 0;else{const e=speechSynthesis.getVoices();this.voice=e.find(o=>o.lang===te.lang)}}say(e){const o=new SpeechSynthesisUtterance(e);o.volume=te.volume/100,o.lang=te.lang,this.voice&&(o.voice=this.voice),o.rate=1+te.rate/10,speechSynthesis.speak(o)}}const Ua=t=>new Promise(e=>setTimeout(e,t));class Xa{constructor(e,o){this.board=e,this.config=o,this.speech=new ja}interval=1e3;game=new q;ply=0;callback=()=>{};speech;playing=!1;async init(){await this.board.frame(this.game.getPosition(0),this.game.header).then(e=>this.board.render())}watch(e){this.callback=e}updateConfig(e){this.config={...this.config,...e}}getPosition(){const e=this.game.getPosition(this.ply);return y({ply:e.ply}),y({fen:e.fen}),e}async load(e){this.pause(),this.game=e,this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async play(){for(this.playing=!0,this.callback(this.playing,this.ply),this.ply===this.game.getMoves().length&&this.first();await Ua(this.interval),!!this.playing;)this.next()}pause(){this.playing=!1,this.callback(this.playing,this.ply)}async prev(){const e=this.ply-1;if(!(e<-1||e<0&&this.config.titleScreen===!1)){if(this.ply=e,e===-1){await this.board.titleFrame(this.game.header),this.board.render();return}await this.board.frame(this.getPosition(),this.game.header),this.board.render(),n.siteConfig.sounds&&F.rewind.play()}}playSFX(e){e.mate?F.snap.play():/[ce]/.test(e.move?.flags)?F.take.play():/[kqp]/.test(e.move?.flags)?F.swap.play():F.move.play()}playAnarchySFX(e){if(e.mate&&F.death.play(),e.move?.flags&&e.move.flags.includes("e")&&F.enPassant.play(),e.move?.flags&&e.move.flags.includes("p")&&F.brickCastle.play(),e.move?.flags&&e.move.flags.includes("c"))switch(e.move.piece){case"p":F.coneTake.play();break;case"r":F.brickTake.play();break;case"n":F.hit.play(),F.horsyTake.play();break;case"k":F.pipiTake.play();break;case"q":F.deathTake.play();break;case"b":F.toyTake.play();break;default:F.take.play()}else if(/[kq]/.test(e.move?.flags))F.brickCastle.play();else switch(e.move?.piece){case"p":F.coneMove.play();break;case"r":F.brickMove.play();break;case"n":F.horsyMove.play();break;case"k":F.pipiMove.play();break;case"q":F.deathMove.play();break;case"b":F.toyMove.play();break;default:F.move.play()}}async next(){const e=this.ply+1;if(e>=this.game.length){this.pause();return}this.ply=e;const o=this.getPosition();if(await this.board.frame(o,this.game.header),this.board.render(),window.speechSynthesis&&(this.ply>0&&n.siteConfig.speech&&this.speech.say(Ga(o.move?.san)),this.ply>0&&n.siteConfig.sounds&&(n.boardConfig.piecesStyle.includes("anarchy")?this.playAnarchySFX(o):this.playSFX(o)),o.end===0&&n.siteConfig.speech)){const a=this.game.header.Result;a&&this.speech.say(a==="1-0"?"White wins!":a==="0-1"?"Black wins!":"Draw!")}}async first(){this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async last(){this.ply=this.game.length-1,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async goto(e){this.ply=e,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}}const Ya=v('<header class="header-box"><div class="header__logo"><a href="/"><div class="header__logo-pic"></div></a></div><div class="header__options"><div class="header__options-ico" title="ABOUT"><i class="las la-question-circle"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico" title="SOURCE CODE"><a href="https://github.com/sharechess/sharechess" target="_blank"><i class="lab la-github"></i></a></div></div></header>'),qa=t=>(()=>{const e=Ya.cloneNode(!0),o=e.firstChild,a=o.nextSibling,r=a.firstChild,s=r.nextSibling,i=s.firstChild,l=s.nextSibling,c=l.firstChild,f=l.nextSibling,u=f.firstChild;return r.$$click=()=>y("about",!n.about),A(s,"click",t.handlers.toggleSound,!0),A(l,"click",t.handlers.toggleSpeech,!0),A(f,"click",t.handlers.toggleDarkMode,!0),N(d=>{const _=n.siteConfig.sounds?"MUTE":"SOUND ON",w=!n.siteConfig.sounds,b=n.siteConfig.sounds,p=n.siteConfig.speech?"SPEECH OFF":"SPEECH ON",B=!n.siteConfig.speech,C=n.siteConfig.speech,S=n.siteConfig.darkMode?"SWITCH TO LIGHT MODE":"SWITCH TO DARK MODE",h=n.siteConfig.darkMode,$=!n.siteConfig.darkMode;return _!==d._v$&&P(s,"title",d._v$=_),w!==d._v$2&&i.classList.toggle("la-volume-mute",d._v$2=w),b!==d._v$3&&i.classList.toggle("la-volume-up",d._v$3=b),p!==d._v$4&&P(l,"title",d._v$4=p),B!==d._v$5&&c.classList.toggle("la-deaf",d._v$5=B),C!==d._v$6&&c.classList.toggle("la-assistive-listening-systems",d._v$6=C),S!==d._v$7&&P(f,"title",d._v$7=S),h!==d._v$8&&u.classList.toggle("la-sun",d._v$8=h),$!==d._v$9&&u.classList.toggle("la-moon",d._v$9=$),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),e})();M(["click"]);const Ka=v('<div><div class="scrollable__content"></div></div>'),Z=t=>(()=>{const e=Ka.cloneNode(!0),o=e.firstChild;return m(o,()=>t.children),N(()=>e.className=`scrollable ${t.class}`),e})();const Ja=v('<p class="moves__turn"></p>'),Va=v('<div class="move"><span class="move__id">.</span><span class="move__ply"></span><span class="move__ply"></span></div>'),Qa=t=>(at(()=>{n.mobile||document.querySelector(`[data-ply="${n.ply}"]`)?.scrollIntoView()}),g(Z,{get class(){return"moves"+(t.class?` ${t.class}`:"")},get children(){return[g(D,{get when(){return t.moves.length===0},get children(){const e=Ja.cloneNode(!0);return m(e,(()=>{const o=se(()=>!!n.game.getPosition(0).mate,!0);return()=>o()?"Checkmate.":n.game.getPosition(0).turn==="w"?"White to move.":"Black to move."})()),e}}),g(le,{get each(){return Oe(2,t.moves)},children:(e,o)=>{const[a,r]=e;return(()=>{const s=Va.cloneNode(!0),i=s.firstChild,l=i.firstChild,c=i.nextSibling,f=c.nextSibling;return m(i,()=>o()+1,l),c.$$click=()=>t.handlers.goto(o()*2+1),m(c,a),f.$$click=()=>t.handlers.goto(o()*2+2),m(f,r),N(u=>{const d=n.ply===o()*2+1,_=o()*2+1,w=n.ply===o()*2+2,b=o()*2+2;return d!==u._v$&&c.classList.toggle("move__ply--current",u._v$=d),_!==u._v$2&&P(c,"data-ply",u._v$2=_),w!==u._v$3&&f.classList.toggle("move__ply--current",u._v$3=w),b!==u._v$4&&P(f,"data-ply",u._v$4=b),u},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),s})()}})]}}));M(["click"]);const Za=v('<i class="las la-play"></i>'),er=v('<div class="controls"><button class="controls__button controls__button--first" title="FIRST"><i class="las la-angle-double-left"></i></button><button class="controls__button" title="PREV"><i class="las la-angle-left"></i></button><button class="controls__button"></button><button class="controls__button controls__button--next" title="NEXT"><i class="las la-angle-right"></i></button><button class="controls__button controls__button--last" title="LAST"><i class="las la-angle-double-right"></i></button><button title="FLIP" class="flip__button"><i class="las la-sync rotatable" class="rotatable"></i></button></div>'),tr=v('<i class="las la-pause"></i>'),Ge=t=>(()=>{const e=er.cloneNode(!0),o=e.firstChild,a=o.nextSibling,r=a.nextSibling,s=r.nextSibling,i=s.nextSibling,l=i.nextSibling,c=l.firstChild;return A(o,"click",t.handlers.first,!0),A(a,"click",t.handlers.prev,!0),A(r,"click",t.handlers.togglePlay,!0),m(r,g(D,{get when(){return!n.playing},get fallback(){return tr.cloneNode(!0)},get children(){return Za.cloneNode(!0)}})),A(s,"click",t.handlers.next,!0),A(i,"click",t.handlers.last,!0),A(l,"click",t.handlers.flip,!0),N(f=>{const u=n.playing?"PAUSE":"PLAY",d=n.boardConfig.flipped;return u!==f._v$&&P(r,"title",f._v$=u),d!==f._v$2&&c.classList.toggle("rotated",f._v$2=d),f},{_v$:void 0,_v$2:void 0}),e})();M(["click"]);const je=t=>{if(t===null)return!1;try{return new URL(t).protocol==="https:"}catch{return!1}},xe=v('<span class="info__rating"> (<!>)</span>'),ne=v("<p></p>"),or=v("<p>Round </p>"),ar=v("<a></a>"),rr=v('<div class="info"><div class="info__header"><div class="info__players"><div class="info__player"><div class="info__left"><button class="info__color info__color--white"></button></div><div class="info__right"><span class="info__score"></span></div></div><div class="info__player"><div class="info__left"><button class="info__color info__color--black"></button></div><div class="info__right"><span class="info__score"></span></div></div></div><div class="info__event"></div><div class="info__site"></div></div><div class="info__analyze"><button><i class="las la-vial"></i> </button></div></div>'),nr=t=>{const[e,o]=W(!1);return(()=>{const a=rr.cloneNode(!0),r=a.firstChild,s=r.firstChild,i=s.firstChild,l=i.firstChild;l.firstChild;const c=l.nextSibling,f=c.firstChild,u=i.nextSibling,d=u.firstChild;d.firstChild;const _=d.nextSibling,w=_.firstChild,b=s.nextSibling,p=b.nextSibling,B=r.nextSibling,C=B.firstChild;return C.firstChild.nextSibling,m(l,g(D,{get when(){return!n.anonymous},fallback:"Anonymous",get children(){return[se(()=>n.game.header.WhitePretty)," "]}}),null),m(l,g(D,{get when(){return n.game.header.WhiteElo},get children(){const h=xe.cloneNode(!0),$=h.firstChild,k=$.nextSibling;return k.nextSibling,m(h,()=>n.game.header.WhiteElo,k),h}}),null),m(f,()=>n.game.header.Result==="1-0"?"1":n.game.header.Result==="0-1"?"0":n.game.header.Result==="1/2-1/2"?"1/2":""),m(d,g(D,{get when(){return!n.anonymous},fallback:"Anonymous",get children(){return[se(()=>n.game.header.BlackPretty)," "]}}),null),m(d,g(D,{get when(){return n.game.header.BlackElo},get children(){const h=xe.cloneNode(!0),$=h.firstChild,k=$.nextSibling;return k.nextSibling,m(h,()=>n.game.header.BlackElo,k),h}}),null),m(w,()=>n.game.header.Result==="1-0"?"0":n.game.header.Result==="0-1"?"1":n.game.header.Result==="1/2-1/2"?"1/2":""),m(b,g(D,{get when(){return n.game.header.Event},get children(){const h=ne.cloneNode(!0);return m(h,()=>n.game.header.Event),h}}),null),m(b,g(D,{get when(){return n.game.header.Round},get children(){const h=or.cloneNode(!0);return h.firstChild,m(h,()=>n.game.header.Round,null),h}}),null),m(p,g(D,{get when(){return n.game.header.Site},get children(){const h=ne.cloneNode(!0);return m(h,g(D,{get when(){return!n.anonymous||!ae(n.game.header.Site)},get children(){return g(D,{get when(){return je(n.game.header.Site)},get fallback(){return n.game.header.Site},get children(){const $=ar.cloneNode(!0);return m($,()=>n.game.header.Site?.replace(/^https:\/\//,"")),N(()=>P($,"href",n.game.header.Site??"")),$}})}})),h}}),null),m(p,g(D,{get when(){return n.game.header.DatePretty},get children(){const h=ne.cloneNode(!0);return m(h,()=>n.game.header.DatePretty),h}}),null),C.$$click=async()=>{await t.handlers.openOnLichess()||(o(!0),setTimeout(()=>o(!1),1e3))},m(C,()=>e()?"Cannot import to lichess":"Analyze on Lichess",null),N(()=>C.classList.toggle("btn--error",e())),a})()};M(["click"]);const Ue=t=>new Promise((e,o)=>{const a=new FileReader;a.onload=()=>{e(a.result)},a.onerror=o,a.readAsText(t)});const sr=v('<button class="load__game-btn"><i class="las la-paste"></i> </button>'),Te=v("<hr>"),ir=v('<textarea class="load__game-input" name="load-game" placeholder="Paste PGN, FEN or Lichess link..."></textarea>'),lr=v('<button class="load__game-btn"></button>'),cr=v('<input type="file" accept="application/vnd.chess-pgn,application/x-chess-pgn,.pgn">'),dr=v('<button class="load__pgn-btn load__pgn-file">Upload PGN file</button>'),fr=v('<div class="load__pgn-file-info"><p>or</p><p>drop the PGN file anywhere on the page</p></div>'),hr=t=>{const[e,o]=W(""),[a,r]=W(!1),[s,i]=W(!1);let l;return g(Z,{get class(){return"load"+(t.class?` ${t.class}`:"")},get children(){return[(()=>{const c=sr.cloneNode(!0);return c.firstChild.nextSibling,c.$$click=async()=>{await t.handlers.loadFromClipboard()||(r(!0),setTimeout(()=>r(!1),1e3))},m(c,()=>a()?"Incorrect data":"Load from clipboard",null),N(()=>c.classList.toggle("btn--error",a())),c})(),Te.cloneNode(!0),(()=>{const c=ir.cloneNode(!0);return c.$$input=f=>o(f.currentTarget.value),P(c,"spellcheck",!1),N(()=>c.value=e()),c})(),(()=>{const c=lr.cloneNode(!0);return c.$$click=async()=>{await t.handlers.load(e())||(i(!0),setTimeout(()=>i(!1),1e3)),o("")},m(c,()=>s()?"Incorrect data":"LOAD"),N(()=>c.classList.toggle("btn--error",s())),c})(),Te.cloneNode(!0),(()=>{const c=cr.cloneNode(!0);c.addEventListener("change",async u=>{const d=u.target;if(d?.files&&d.files.length>0){const _=await Ue(d.files[0]);y("refreshHash",!1),t.handlers.loadPGN(_)}});const f=l;return typeof f=="function"?f(c):l=c,c.style.setProperty("display","none"),c})(),(()=>{const c=dr.cloneNode(!0);return c.$$click=()=>{l&&l.click()},c})(),g(D,{get when(){return!n.mobile},get children(){return fr.cloneNode(!0)}})]}})};M(["click","input"]);const ie=(t,e,o)=>{const a=typeof t=="string"?t:URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`${e}.${o}`,r.target="_blank",r.click(),URL.revokeObjectURL(a)},Xe=async t=>{const[e,o]=t.pathname.replace(/^\//,"").split("/").map(a=>a.trim());if(/^(([a-z0-9]{8})|([a-z0-9]{12}))$/i.test(e)){const a=e.slice(0,8),r=await fetch(`https://lichess.org/game/export/${a}?evals=0&clocks=0`);if(!String(r.status).startsWith("2"))return{error:!0,errorType:"SERVER_ERROR"};const s=await r.text();return{error:!1,pgn:s,side:String(o).startsWith("black")||t.hash.startsWith("black")?"b":"w"}}return{error:!0,errorType:"INCORRECT_LINK"}},gr=async t=>{let e;try{e=new URL(t)}catch{return{error:!0,errorType:"INCORRECT_LINK"}}return/^(www\.)*lichess\.org/.test(e.hostname)?Xe(e):{error:!0,errorType:"INCORRECT_LINK"}},oe={pgn:"",fen:"",side:"w",ply:0};let E={...oe};const X={set(t){if(t.fen){E={...oe},E.fen=t.fen,location.hash=`fen/${E.fen.replace(/ /g,"_")}`;return}t.pgn&&(E={...oe},E.pgn=ye(t.pgn)),t.side&&(E.side=t.side),t.ply!==void 0&&(E.ply=t.ply),location.hash=`pgn/${E.side}/${E.ply}/${E.pgn}`},get(){return location.href},getFENLink(t){return`${location.origin}/#fen/${t.replace(/ /g,"_")}`},async read(){const t=new URL(location.href),[e,...o]=location.hash.split("/");if(/fen/.test(e))E={...oe},E.fen=decodeURI(o.join("/")).replace(/_/g," ");else if(/pgn/.test(e)){const[a,r,...s]=o;E.side=a,E.ply=Number(r),E.pgn=s.join("/"),E.fen=""}else if(/lid/.test(e)){const[a,r,...s]=o;E.side=a,E.ply=Number(r);const i=await Xe(new URL(`https://lichess.org/${s[0]}`));i.error?(E.pgn="",E.fen=""):(E.pgn=ye(He(i.pgn)),E.fen="")}return{pgn:E.pgn?vt(E.pgn):"",fen:E.fen,side:E.side,ply:E.ply,boardStyle:t.searchParams.get("b"),piecesStyle:t.searchParams.get("p")}},entries(){return{...E}}},ur=v('<div class="share__view"><h2 class="header--first">Board options</h2><button class="options__button" title="TOGGLE ANONYMOUS"><i class="las la-user-secret"></i></button><button class="options__button"><i class="las la-expand"></i></button><button class="options__button"><i class="las la-info-circle"></i></button><button class="options__button"><i class="las la-heading"></i></button><button class="options__button"><i class="las la-cloud"></i></button></div>'),Me=v("<hr>"),pr=v('<div class="share__fen"><h2>Current position</h2><input type="text" name="current_fen" readonly placeholder="Current FEN..."><div class="double"><button class="share__btn share__btn--left"></button><button class="share__btn share__btn--right"></button></div><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__btn"></button></div>'),yr=v('<div class="share__pgn"><h2>Game</h2><div class="double"><button class="share__btn"></button><button class="share__btn"></button></div><div class="double"><button class="share__btn">Export PGN</button><button class="share__btn"></button></div></div>'),mr=v('<div class="share__animation"><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__format share__format--first">GIF</button><button class="share__format">MP4</button><button class="share__format share__format--last">WebM</button><button class="share__create-animation"></button></div>'),Ye=t=>{const[e,o]=W(""),[a,r]=W(!1),[s,i]=W(!1),l=c=>{o(c),setTimeout(()=>o(""),1e3)};return g(Z,{get class(){return"share"+(t.class?` ${t.class}`:"")},get children(){return[(()=>{const c=ur.cloneNode(!0),f=c.firstChild,u=f.nextSibling,d=u.nextSibling,_=d.nextSibling,w=_.nextSibling,b=w.nextSibling;return A(u,"click",t.handlers.toggleAnonymous,!0),A(d,"click",t.handlers.toggleBorder,!0),A(_,"click",t.handlers.toggleExtraInfo,!0),A(w,"click",t.handlers.toggleTitleScreen,!0),A(b,"click",t.handlers.toggleShadows,!0),N(p=>{const B=n.anonymous,C=n.boardConfig.showBorder,S=n.boardConfig.showBorder?"HIDE BORDER":"SHOW BORDER",h=n.boardConfig.showExtraInfo,$=n.boardConfig.showExtraInfo?"HIDE EXTRA INFO":"SHOW EXTRA INFO",k=n.gameConfig.titleScreen,I=n.gameConfig.titleScreen?"EXCLUDE TITLE SCREEN":"INCLUDE TITLE SCREEN",R=n.boardConfig.showShadows,O=n.boardConfig.showShadows?"HIDE SHADOWS":"SHOW SHADOWS";return B!==p._v$&&u.classList.toggle("options__button--active",p._v$=B),C!==p._v$2&&d.classList.toggle("options__button--active",p._v$2=C),S!==p._v$3&&P(d,"title",p._v$3=S),h!==p._v$4&&_.classList.toggle("options__button--active",p._v$4=h),$!==p._v$5&&P(_,"title",p._v$5=$),k!==p._v$6&&w.classList.toggle("options__button--active",p._v$6=k),I!==p._v$7&&P(w,"title",p._v$7=I),R!==p._v$8&&b.classList.toggle("options__button--active",p._v$8=R),O!==p._v$9&&P(b,"title",p._v$9=O),p},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),c})(),Me.cloneNode(!0),(()=>{const c=pr.cloneNode(!0),f=c.firstChild,u=f.nextSibling,d=u.nextSibling,_=d.firstChild,w=_.nextSibling,b=d.nextSibling,p=b.nextSibling,B=p.nextSibling,C=B.nextSibling,S=C.nextSibling,h=S.nextSibling,$=h.nextSibling;return u.$$click=k=>{k.target.select()},_.$$click=()=>{navigator.clipboard.writeText(n.fen),l("fen")},m(_,()=>e()==="fen"?"Copied!":"Copy FEN"),w.$$click=()=>{navigator.clipboard.writeText(X.getFENLink(n.fen)),l("fen-link")},m(w,()=>e()==="fen-link"?"Copied!":"Copy link"),p.$$click=()=>y("gameConfig","picSize","XS"),B.$$click=()=>y("gameConfig","picSize","S"),C.$$click=()=>y("gameConfig","picSize","M"),S.$$click=()=>y("gameConfig","picSize","L"),h.$$click=()=>y("gameConfig","picSize","XL"),$.$$click=async()=>{r(!0),await t.handlers.downloadImage(),r(!1)},m($,()=>a()?"Please wait...":"Save as image"),N(k=>{const I=n.fen,R=n.gameConfig.picSize==="XS",O=n.gameConfig.picSize==="S",H=n.gameConfig.picSize==="M",K=n.gameConfig.picSize==="L",J=n.gameConfig.picSize==="XL";return I!==k._v$10&&(u.value=k._v$10=I),R!==k._v$11&&p.classList.toggle("share__size--active",k._v$11=R),O!==k._v$12&&B.classList.toggle("share__size--active",k._v$12=O),H!==k._v$13&&C.classList.toggle("share__size--active",k._v$13=H),K!==k._v$14&&S.classList.toggle("share__size--active",k._v$14=K),J!==k._v$15&&h.classList.toggle("share__size--active",k._v$15=J),k},{_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),c})(),g(D,{get when(){return n.pgn},get children(){return[Me.cloneNode(!0),(()=>{const c=yr.cloneNode(!0),f=c.firstChild,u=f.nextSibling,d=u.firstChild,_=d.nextSibling,w=u.nextSibling,b=w.firstChild,p=b.nextSibling;return d.$$click=()=>{navigator.clipboard.writeText(n.anonymous?n.game.anonymousPGN:n.pgn),l("pgn")},m(d,()=>e()==="pgn"?"Copied!":"Copy PGN"),_.$$click=()=>{navigator.clipboard.writeText(window.location.href),l("pgn-link")},m(_,()=>e()==="pgn-link"?"Copied!":"Copy link"),b.$$click=()=>{const B=new Blob([n.pgn],{type:"application/vnd.chess-pgn;charset=utf-8"}),C=n.game.getFileName(n.anonymous);ie(B,C,"pgn")},p.$$click=()=>{const C=`[${n.game.getTitle({anonymous:n.anonymous})}](${window.location.href})`;navigator.clipboard.writeText(C),l("markdown")},m(p,()=>e()==="markdown"?"Copied!":"Copy markdown"),c})(),(()=>{const c=mr.cloneNode(!0),f=c.firstChild,u=f.nextSibling,d=u.nextSibling,_=d.nextSibling,w=_.nextSibling,b=w.nextSibling,p=b.nextSibling,B=p.nextSibling,C=B.nextSibling,S=C.nextSibling;return u.$$click=()=>y("gameConfig","animationSize","XS"),d.$$click=()=>y("gameConfig","animationSize","S"),_.$$click=()=>y("gameConfig","animationSize","M"),w.$$click=()=>y("gameConfig","animationSize","L"),b.$$click=()=>y("gameConfig","animationSize","XL"),p.$$click=()=>y("gameConfig","format","GIF"),B.$$click=()=>y("gameConfig","format","MP4"),C.$$click=()=>y("gameConfig","format","WebM"),S.$$click=async()=>{i(!0),await t.handlers.downloadAnimation(),i(!1)},m(S,()=>s()?"Please wait...":"Save animation"),N(h=>{const $=n.gameConfig.animationSize==="XS",k=n.gameConfig.animationSize==="S",I=n.gameConfig.animationSize==="M",R=n.gameConfig.animationSize==="L",O=n.gameConfig.animationSize==="XL",H=n.gameConfig.format==="GIF",K=n.gameConfig.format==="MP4",J=n.gameConfig.format==="WebM";return $!==h._v$16&&u.classList.toggle("share__size--active",h._v$16=$),k!==h._v$17&&d.classList.toggle("share__size--active",h._v$17=k),I!==h._v$18&&_.classList.toggle("share__size--active",h._v$18=I),R!==h._v$19&&w.classList.toggle("share__size--active",h._v$19=R),O!==h._v$20&&b.classList.toggle("share__size--active",h._v$20=O),H!==h._v$21&&p.classList.toggle("share__format--active",h._v$21=H),K!==h._v$22&&B.classList.toggle("share__format--active",h._v$22=K),J!==h._v$23&&C.classList.toggle("share__format--active",h._v$23=J),h},{_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0,_v$20:void 0,_v$21:void 0,_v$22:void 0,_v$23:void 0}),c})()]}})]}})};M(["click"]);const br=v("<div></div>"),vr=async()=>{const t=[],e=new re({size:144,tiles:2,showBorder:!0,showExtraInfo:!1});e.setBorderScale(3);for(const[o,a]of Object.entries(Q)){let r;a.ico?r=a.ico:(await e.updateConfig({boardStyle:o}),await e.frame(null),e.render(),r=e.toImgUrl()),t.push({key:o,img:r})}return t},qe=t=>{const[e,o]=W([]);return vr().then(a=>o(a)),g(Z,{get class(){return"boards"+(t.class?` ${t.class}`:"")},get children(){return g(le,{get each(){return e()},children:a=>(()=>{const r=br.cloneNode(!0);return r.$$click=()=>{y("boardConfig","boardStyle",a.key),t.handlers.changeBoardStyle(a.key)},P(r,"draggable",!1),N(s=>{const i="boards__ico"+(n.boardConfig.boardStyle===a.key?" boards__ico--active":""),l=`url(${a.img})`,c=a.key;return i!==s._v$&&(r.className=s._v$=i),l!==s._v$2&&r.style.setProperty("background-image",s._v$2=l),c!==s._v$3&&P(r,"title",s._v$3=c),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})()})}})};M(["click"]);const _r=v("<img>"),$r=fe.map(t=>({key:t,img:`/pieces/${t}/nw.svg`})),Ke=t=>g(Z,{get class(){return"pieces"+(t.class?` ${t.class}`:"")},get children(){return g(le,{each:$r,children:e=>(()=>{const o=_r.cloneNode(!0);return o.$$click=()=>{y("boardConfig","piecesStyle",e.key),t.handlers.changePiecesStyle(e.key)},P(o,"draggable",!1),N(a=>{const r="pieces__ico"+(n.boardConfig.piecesStyle===e.key?" pieces__ico--active":""),s=e.img,i=e.key;return r!==a._v$&&(o.className=a._v$=r),s!==a._v$2&&P(o,"src",a._v$2=s),i!==a._v$3&&P(o,"title",a._v$3=i),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),o})()})}});M(["click"]);const kr=v("<button></button>"),j=t=>(()=>{const e=kr.cloneNode(!0);return e.$$click=()=>t.setTab(t.name),m(e,()=>t.children),N(()=>e.className="tab"+(t.isActive?" tab--active":"")),e})();M(["click"]);const wr=v('<i class="las la-chess-board"></i>'),Cr=v('<i class="las la-chess"></i>'),Sr=v('<div class="game"><div class="game-tabs"></div></div>'),V=t=>{y("activeTab",t)},Br=t=>(()=>{const e=Sr.cloneNode(!0),o=e.firstChild;return m(o,g(j,{name:"game",setTab:V,get isActive(){return n.activeTab==="game"},children:"GAME"}),null),m(o,g(j,{name:"load",setTab:V,get isActive(){return n.activeTab==="load"},children:"LOAD"}),null),m(o,g(D,{get when(){return n.layout!=="triple"},get children(){return[g(j,{name:"share",setTab:V,get isActive(){return n.activeTab==="share"},children:"SHARE"}),g(j,{name:"boards",setTab:V,get isActive(){return n.activeTab==="boards"},get children(){return wr.cloneNode(!0)}}),g(j,{name:"pieces",setTab:V,get isActive(){return n.activeTab==="pieces"},get children(){return Cr.cloneNode(!0)}})]}}),null),m(e,g(ze,{get children(){return[g(G,{get when(){return n.activeTab==="game"},get children(){return[g(nr,{get handlers(){return t.handlers}}),g(Qa,{get moves(){return t.moves},get handlers(){return t.handlers},get class(){return n.layout==="single"?"span2":void 0}}),g(D,{get when(){return n.layout!=="single"},get children(){return g(Ge,{get handlers(){return t.handlers}})}})]}}),g(G,{get when(){return n.activeTab==="load"},get children(){return g(hr,{get handlers(){return t.handlers},class:"span3"})}}),g(D,{get when(){return n.layout!=="triple"},get children(){return[g(G,{get when(){return n.activeTab==="share"},get children(){return g(Ye,{get handlers(){return t.handlers},class:"span3"})}}),g(G,{get when(){return n.activeTab==="boards"},get children(){return g(qe,{get handlers(){return t.handlers},class:"span3"})}}),g(G,{get when(){return n.activeTab==="pieces"},get children(){return g(Ke,{get handlers(){return t.handlers},class:"span3"})}})]}})]}}),null),N(()=>o.classList.toggle("game-tabs--condensed",n.layout!=="triple")),e})();const Er=v('<i class="las la-share"></i>'),Fr=v('<i class="las la-chess-board"></i>'),Dr=v('<i class="las la-chess"></i>'),Lr=v('<div class="setup"><div class="setup-tabs"></div></div>'),Ir=t=>{const[e,o]=W("share");return(()=>{const a=Lr.cloneNode(!0),r=a.firstChild;return m(r,g(j,{name:"share",setTab:o,get isActive(){return e()==="share"},get children(){return[Er.cloneNode(!0)," SHARE"]}}),null),m(r,g(j,{name:"boards",setTab:o,get isActive(){return e()==="boards"},get children(){return[Fr.cloneNode(!0)," BOARDS"]}}),null),m(r,g(j,{name:"pieces",setTab:o,get isActive(){return e()==="pieces"},get children(){return[Dr.cloneNode(!0)," PIECES"]}}),null),m(a,g(ze,{get children(){return[g(G,{get when(){return e()==="share"},get children(){return g(Ye,{get handlers(){return t.handlers}})}}),g(G,{get when(){return e()==="boards"},get children(){return g(qe,{get handlers(){return t.handlers}})}}),g(G,{get when(){return e()==="pieces"},get children(){return g(Ke,{get handlers(){return t.handlers}})}})]}}),null),a})()};const Pr=v('<div class="popup"><div class="popup__box"><button class="popup__close"><i class="las la-times"></i></button><h2 class="popup__title"></h2><div class="popup__content"></div></div></div>'),he=t=>(()=>{const e=Pr.cloneNode(!0),o=e.firstChild,a=o.firstChild,r=a.nextSibling,s=r.nextSibling;return A(a,"click",t.onClose,!0),m(r,()=>t.title),m(s,()=>t.children),e})();M(["click"]);const x=t=>{switch(t){case"board":localStorage.setItem("boardConfig",JSON.stringify(n.boardConfig));break;case"game":localStorage.setItem("gameConfig",JSON.stringify(n.gameConfig));break;case"site":localStorage.setItem("siteConfig",JSON.stringify(n.siteConfig));break;case"recent":localStorage.setItem("recent",JSON.stringify(n.recent));break}},Nr=v("<p>Saving files may not work correctly in this browser.</p>"),Ar=v("<p>To enjoy the full functionality of the website, please open it in <u><b>Safari</b></u>.</p>"),xr=()=>g(D,{get when(){return!n.siteConfig.iOSAppPopup&&n.siteConfig.wrongBrowserPopup&&n.os==="iOS"&&!n.browser?.includes("Safari")},get children(){return g(he,{onClose:()=>{y("siteConfig","wrongBrowserPopup",!1),x("site")},title:"Note",get children(){return[Nr.cloneNode(!0),Ar.cloneNode(!0)]}})}}),Tr=v("<p>For easy access, you can install this website as a standalone app.</p>"),Mr=v("<ul>To do that:<li>open the website in Chrome,</li><li>tap the menu icon (3 dots in the corner),</li><li>tap <u><b>Add to Home screen</b></u>.</li></ul>"),Rr=()=>g(D,{get when(){return n.siteConfig.androidAppPopup&&n.os?.includes("Android")},get children(){return g(he,{onClose:()=>{y("siteConfig","androidAppPopup",!1),x("site")},title:"Tip",get children(){return[Tr.cloneNode(!0),Mr.cloneNode(!0)]}})}}),Or=v("<p>For easy access, you can install this website as a standalone app.</p>"),zr=v("<ul>To do that:<li>open the website in Safari,</li><li>tap the Share icon,</li><li>tap <u><b>Add to Home Screen</b></u>.</li></ul>"),Wr=()=>g(D,{get when(){return n.siteConfig.iOSAppPopup&&n.os?.includes("iOS")},get children(){return g(he,{onClose:()=>{y("siteConfig","iOSAppPopup",!1),x("site")},title:"Tip",get children(){return[Or.cloneNode(!0),zr.cloneNode(!0)]}})}});const Hr=v("<hr>"),Gr=v("<h2>Keyboard Shortcuts</h2>"),jr=v('<div class="about__shortcuts"><ul><li><kbd>\u2192</kbd> Next move</li><li><kbd>\u2190</kbd> Previous move</li><li><kbd>\u2191</kbd> Start position</li><li><kbd>\u2193</kbd> Final position</li><li><kbd>f</kbd> Flip the board</li><li><kbd>Space</kbd> Play / Pause</li><li><kbd>Enter</kbd> Analyze on Lichess</li></ul><ul><li><kbd>l</kbd> Load from clipboard</li><li><kbd>a</kbd> Toggle anonymous</li><li><kbd>b</kbd> Toggle border</li><li><kbd>i</kbd> Toggle extra info</li><li><kbd>h</kbd> Toggle header (title screen)</li><li><kbd>s</kbd> Toggle shadows</li></ul></div>'),Ur=v('<div class="about"><div class="about__box"><button class="about__close"><i class="las la-times"></i></button><div class="about__content"><h2>About</h2><p><b>ShareChess</b> is a free, open source website that allows you to share chess games as self-contained replay links (the whole game is stored in the url without the need for a database), PNG images, or GIF / MP4 / WebM animations.</p><p>The website provides a high variety of chessboard and piece designs to serve as an open alternative for commercial chess GIF makers.</p><p>You can find the complete source code on our <a href="https://github.com/sharechess/sharechess">GitHub page</a>.</p></div></div></div>'),Xr=()=>g(D,{get when(){return n.about},get children(){const t=Ur.cloneNode(!0),e=t.firstChild,o=e.firstChild,a=o.nextSibling;return a.firstChild.nextSibling.nextSibling.nextSibling,o.$$click=()=>y("about",!n.about),m(a,g(D,{get when(){return!n.mobile},get children(){return[Hr.cloneNode(!0),Gr.cloneNode(!0),jr.cloneNode(!0)]}}),null),t}});M(["click"]);const Yr=v('<div id="setup" class="setup-box"></div>'),qr=v('<div><div class="layout"><div id="board" class="board-box"><canvas class="board" id="canvas"></canvas></div><div id="moves" class="game-box"></div></div></div>'),Kr=t=>(()=>{const e=qr.cloneNode(!0),o=e.firstChild,a=o.firstChild;a.firstChild;const r=a.nextSibling;return m(e,g(qa,{get handlers(){return t.handlers}}),o),m(o,g(D,{get when(){return n.layout==="triple"},get children(){const s=Yr.cloneNode(!0);return m(s,g(Ir,{get handlers(){return t.handlers}})),s}}),a),m(a,g(D,{get when(){return n.layout==="single"},get children(){return g(Ge,{get handlers(){return t.handlers}})}}),null),m(r,g(Br,{get moves(){return t.state.moves},get handlers(){return t.handlers}})),m(e,g(Xr,{}),null),m(e,g(xr,{}),null),m(e,g(Rr,{}),null),m(e,g(Wr,{}),null),N(s=>{const i=!n.siteConfig.darkMode,l=n.layout==="double";return i!==s._v$&&e.classList.toggle("light",s._v$=i),l!==s._v$2&&a.classList.toggle("board-box--left",s._v$2=l),s},{_v$:void 0,_v$2:void 0}),e})(),Je={XS:360,S:512,M:720,L:1024,XL:1440},Jr=async(t,e,o=0,a,r)=>{const s=new q;e?s.loadPGN(e):s.loadFEN(t);const i=new re({...a,size:Je[r]}),l=s.getPosition(o);return await i.frame(l,s.header),i.render(),i.toImgUrl()};class Ve{gif;frameTime;constructor(e,o,a,r=1e3){this.gif=new rt({workers:2,quality:30,width:e,height:o,repeat:a?0:-1}),this.frameTime=r}add(e,o){for(;o--;)this.gif.addFrame(e,{delay:this.frameTime})}render(){return new Promise(e=>{const o=Date.now();this.gif.on("finished",function(a){const r=new File([a],`board_${o}.gif`,{type:"image/gif",lastModified:o});e(r)}),this.gif.render()})}}class Vr{constructor(e=1e3){this.frameTime=e,this.video=new nt({quality:.8,fileWriter:null,fd:null,frameDuration:1e3,transparent:!1})}video;add(e,o){this.video.addFrame(e,o*this.frameTime)}async render(){const e=await this.video.complete(),o=Date.now();return new File([e],`board_${o}.webm`,{type:"video/webm",lastModified:o})}}class Qe{constructor(e,o,a=1e3){this.width=e,this.height=o,this.hme=st.createH264MP4Encoder(),this.frameTime=a}hme;encoder=null;frameTime;async setup(e,o){this.encoder=await this.hme,this.encoder.width=e,this.encoder.height=o,this.encoder.frameRate=1e3/this.frameTime,this.encoder.quantizationParameter=10,this.encoder.initialize()}async add(e,o){for(this.encoder===null&&await this.setup(this.width,this.height);o--;)this.encoder?.addFrameRgba(e)}async render(){this.encoder?.finalize();const e=this.encoder?.FS.readFile(this.encoder.outputFilename),o=Date.now(),a=new File([e],`board_${o}.mp4`,{type:"video/mp4",lastModified:o});return this.encoder?.delete(),a}}const Re=(t,e)=>e instanceof Ve?t.toImageData():e instanceof Qe?t.toClampedArray():t.canvas,Qr=async(t,e,o,a,r)=>{const s=new q().loadPGN(t),i=new re({...e,size:Je[a]}),l=o==="GIF"?new Ve(i.width,i.height,!0):o==="MP4"?new Qe(i.width,i.height):new Vr,c=s.header;r&&(await i.titleFrame(c),i.render(),await l.add(Re(i,l),4));for(let f=0;f<s.length;f++){const u=s.getPosition(f);await i.frame(u,c),i.render();const d=u.end===0?5:u.ply===0&&!r?2:1;await l.add(Re(i,l),d)}return await l.render()},Zr=/^([1-8kqrbnp]+\/)+[1-8kqrbnp]+ [wb] ([kq]+|-) ([a-h1-8]{2}|-) \d+ \d+$/i,en=t=>Zr.test(t.trim()),tn=/((\[[a-z0-9]+ +"[^"\n\r]+"](\r\n|\r|\n))*(\r\n|\r|\n)+){0,1}\d+\. *[a-h1-8x+#=]+/i,on=t=>tn.test(t),an=async(t,e)=>{if(e&&/^https:\/\/lichess\.org\/.{8}/.test(e))return e;const o=new URLSearchParams({pgn:t}).toString();try{const a=await fetch("https://lichess.org/api/import",{headers:{"content-type":"application/x-www-form-urlencoded"},body:o,method:"POST"});if(a.status===200)return(await a.json()).url;throw new Error("Cannot import to lichess")}catch{throw new Error("Cannot import to lichess")}},rn=(t,e)=>({prev(){t.pause(),t.prev()},next(){t.pause(),t.next()},first(){t.pause(),t.first()},last(){t.pause(),t.last()},togglePlay(){t.playing?t.pause():t.play()},goto(o){t.pause(),t.goto(o)},toggleBorder(){e.toggleBorder(),y("boardConfig","showBorder",!n.boardConfig.showBorder),x("board")},showBorder(){e.showBorder(),y("boardConfig","showBorder",!0),x("board")},hideBorder(){e.hideBorder(),y("boardConfig","showBorder",!1),x("board")},toggleExtraInfo(){e.toggleExtraInfo(),y("boardConfig","showExtraInfo",!n.boardConfig.showExtraInfo),x("board")},toggleAnonymous(){if(y("anonymous",!n.anonymous),e.anonymous=n.anonymous,n.pgn!==""){const o=n.anonymous?n.game.anonymousPGN:n.game.pgn;X.set({pgn:o}),y("refreshHash",!1)}},toggleTitleScreen(){y("gameConfig","titleScreen",!n.gameConfig.titleScreen),x("game")},toggleShadows(){e.toggleShadows(),y("boardConfig","showShadows",!n.boardConfig.showShadows),x("board")},flip(){e.flip(),y("boardConfig","flipped",!n.boardConfig.flipped),y("refreshHash",!1),X.set({side:n.boardConfig.flipped?"b":"w"})},changeBoardStyle(o){e.setStyle(o),y("boardConfig","boardStyle",o),x("board")},changePiecesStyle(o){e.setPiecesStyle(o),y("boardConfig","piecesStyle",o),x("board")},async loadPGN(o,a="w",r=0){const s=new q().loadPGN(o);y({pgn:s.pgn,fen:"",moves:s.getMoves(),ply:0,game:s}),X.set({pgn:s.pgn,side:a,ply:r}),await t.load(s),y("activeTab","game"),a==="w"?e.flipWhite():e.flipBlack(),y("boardConfig","flipped",a==="b"),document.title=`ShareChess - ${s.getTitle({anonymous:!1})}`},async loadFEN(o,a=!0){const r=new q().loadFEN(o);y({pgn:"",fen:o,moves:r.getMoves(),ply:0,game:r}),await t.load(r),a&&(X.set({fen:n.fen}),y("activeTab","game"));const s=r.getPosition(0).turn;s==="w"?e.flipWhite():e.flipBlack(),y("boardConfig","flipped",s==="b"),document.title=`ShareChess - FEN ${o}`},async load(o){return y("refreshHash",!1),en(o)?(await this.loadFEN(o),!0):on(o)?(await this.loadPGN(o),!0):je(o)?(await this.importPGN(o),!0):!1},async loadFromClipboard(){const o=await navigator.clipboard.readText();return this.load(o)},async importPGN(o){const a=await gr(o);a.error||await this.loadPGN(a.pgn,a.side)},async downloadImage(){await new Promise(a=>setTimeout(a,0));const o=await Jr(n.fen,n.pgn,n.ply,n.boardConfig,n.gameConfig.picSize);ie(o,`fen_${Date.now()}`,"png")},async downloadAnimation(){await new Promise(r=>setTimeout(r,0));const o=await Qr(n.pgn,n.boardConfig,n.gameConfig.format,n.gameConfig.animationSize,n.gameConfig.titleScreen),a=n.game.getFileName(n.anonymous);ie(o,a,n.gameConfig.format.toLowerCase())},toggleSound(){y("siteConfig","sounds",!n.siteConfig.sounds),x("site")},toggleSpeech(){y("siteConfig","speech",!n.siteConfig.speech),x("site")},toggleDarkMode(){y("siteConfig","darkMode",!n.siteConfig.darkMode),x("site")},async openOnLichess(){if(n.pgn==="")return window.open(`https://lichess.org/analysis/${n.fen.replace(/\s+/g,"_")}`),!0;try{const o=await an(n.pgn,n.game.header.Site);return window.open(`${o}/${n.boardConfig.flipped?"black":""}`),!0}catch{return!1}}}),Ze=async(t,e,o)=>{y("refreshHash",t);const{pgn:a,fen:r,side:s,ply:i,boardStyle:l,piecesStyle:c}=await X.read();await(a?e.loadPGN(a,s,i):r?e.loadFEN(r):e.loadFEN("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",!1)),i!==0&&e.goto(i),l&&Object.keys(Q).includes(l)&&(y("boardConfig","boardStyle",l),o.setStyle(l)),c&&fe.includes(c)&&(y("boardConfig","piecesStyle",c),o.setPiecesStyle(c)),y("refreshHash",!0)},nn=(t,e)=>{if(document.addEventListener("dblclick",function(o){o.preventDefault()}),window.addEventListener("resize",()=>{y("layout",window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple")}),window.addEventListener("hashchange",()=>{if(!n.refreshHash){y("refreshHash",!0);return}Ze(!0,t,e)}),!n.mobile){const o={ArrowLeft:t.prev,ArrowRight:t.next,ArrowUp:t.first,ArrowDown:t.last,f:t.flip," ":t.togglePlay,Enter:t.openOnLichess,l:t.loadFromClipboard.bind(t),a:t.toggleAnonymous,b:t.toggleBorder,i:t.toggleExtraInfo,h:t.toggleTitleScreen,s:t.toggleShadows};document.addEventListener("keydown",r=>{const s=r.target;o[r.key]&&s?.nodeName!=="INPUT"&&s?.nodeName!=="TEXTAREA"&&(r.preventDefault(),o[r.key]())});const a=r=>{r.preventDefault(),r.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(r=>{document.addEventListener(r,a,!1)}),document.addEventListener("drop",async r=>{if(r.dataTransfer?.files&&r.dataTransfer.files.length>0){const s=await Ue(r.dataTransfer.files[0]);y("refreshHash",!1),t.loadPGN(s)}})}},sn=async()=>{const t=new re(n.boardConfig),e=new Xa(t,n.gameConfig);e.watch(r=>y("playing",r));const o=rn(e,t);lt(()=>g(Kr,{handlers:o,state:n}),document.getElementById("root"));const a=document.getElementById("canvas");await t.setCanvas(a),await e.init(),await Ze(!1,o,t),nn(o,t)};Promise.all([new Promise(t=>it.load({google:{families:["Ubuntu:500,700","Fira Mono:500"]},custom:{families:["Chess"],urls:["/fonts.css"]},active:()=>t(null)})).catch(()=>null),new Promise(t=>{window.speechSynthesis||t(null),speechSynthesis.getVoices().length>0?t(null):window.speechSynthesis.onvoiceschanged=t}).catch(()=>null)]).then(()=>sn());export{ln as __vite_legacy_guard};
