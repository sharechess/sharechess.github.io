!function(){function e(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var t=document.createElement("style");t.innerHTML='.header-box{height:var(--header-height);background-color:var(--color-bg-block);position:absolute;top:0;width:100%;display:grid;grid-template-columns:1fr 1fr;font-size:1.8rem}.header__logo{padding:1rem;text-align:left;color:var(--color-text-dimmed)}.header__logo-pic{height:2rem;max-width:200px;background-image:var(--logo-url);background-repeat:no-repeat;background-size:contain}.header__options{padding:0 1rem;text-align:right}.header__options-ico{display:inline-block;font-size:2.4rem;position:relative;top:-.2rem;padding-top:1rem;height:100%;margin-left:.5rem;text-align:center}.header__options-ico,.header__options-ico>a,.header__options-ico>a:visited{color:var(--color-text)}.header__options-ico:hover,.header__options-ico>a:hover{color:var(--color-btn);cursor:pointer}.scrollable{background:var(--color-bg-block);padding:2rem 1rem 2rem 2rem;height:100%;display:flex;overflow:auto}.scrollable__content{overflow-y:auto;overflow-x:hidden;padding:0;padding-right:1rem;width:100%}.scrollable__content::-webkit-scrollbar{width:.7rem;cursor:pointer}.scrollable__content::-webkit-scrollbar-track{background-color:var(--color-scrollbar-track)}.scrollable__content::-webkit-scrollbar-thumb{background-color:var(--color-scrollbar);outline:1px solid var(--color-scrollbar)}@media (orientation: portrait){.scrollable{height:auto;display:block}}.moves{font-size:1.4rem;font-family:Fira Mono;text-align:left;background-color:var(--color-bg-input)}.moves__turn{text-align:center}.move{padding:3px}.move__id{display:inline-block;width:4rem;text-align:right;margin-right:2rem;color:var(--color-text)}.move__ply{display:inline-block;width:7rem;color:var(--color-btn)}.move__ply--current{color:var(--color-text);background-color:var(--color-highlight)}.move__ply:hover{text-decoration:underline;cursor:pointer}@media (orientation: portrait){.moves{text-align:left}.move{display:inline-block}.move__id,.move__ply{display:inline-block;margin-right:.6rem;width:auto}}@media (orientation: landscape) and (max-height: 400px){.moves{display:none}}.controls-box{grid-area:controls;padding:0 2rem 2rem}.controls{background:var(--color-bg-block);padding:2rem 1rem;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.controls__button{margin:0;padding:.5rem;font-size:3rem;text-align:center;width:4.4rem;height:4.4rem;border-radius:0}.flip__button{margin-left:3px;padding:.5rem;font-size:3rem;text-align:center;border-radius:5px;width:4.4rem;height:4.4rem}.controls__button:hover{background:var(--color-btn-light);cursor:pointer}.controls__button--last{margin-right:3px;border-top-right-radius:5px;border-bottom-right-radius:5px}.controls__button--first{margin-left:0;border-top-left-radius:5px;border-bottom-left-radius:5px}@media (orientation: portrait){.controls-box{padding:0}.controls{background:var(--color-bg-block);padding:1.5rem 0;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.controls__button{margin:0 .8vw;padding:.5rem;font-size:3rem;text-align:center;width:12.8vw;height:12.8vw;max-height:6rem;border-radius:5px}.controls__button--next{width:23vw}.flip__button{margin:0 .8vw;padding:.5rem;font-size:3rem;text-align:center;border-radius:5px;width:12.8vw;height:12.8vw;max-height:6rem}}@media (orientation: landscape) and (max-height: 400px){.controls{padding-top:0}}.info-box{grid-area:controls;padding:0 2rem 2rem}.info{background:var(--color-bg-block);padding:2rem;font-size:1.4rem;text-align:left;position:relative}.info__players{position:relative;line-height:2rem;margin-bottom:2rem;padding:0 1rem}.info__player{display:grid;grid-template-columns:auto 40px}.info__right{text-align:right}.info__rating{font-family:Fira Code,monospace;color:var(--color-text-dimmed)}.info__score{font-family:Fira Code,monospace;color:var(--color-score);margin-left:1rem}.info__color{border-radius:1rem;padding:0;border:solid 2px var(--color-tab);width:1.4rem;height:1.4rem;margin-right:.8rem}.info__color--white{background-color:#eee}.info__color--black{background-color:#111}.info__event{margin-bottom:1rem}.info__event,.info__site{font-size:1.3rem;line-height:1.5rem;color:var(--color-text);padding:0 1rem}.info__header{height:13.1rem}.info__analyze{margin-top:2rem}@media (orientation: portrait){.info__header{height:auto}}.load{background:var(--color-bg-block);border-bottom-left-radius:5px;border-bottom-right-radius:5px}.load__game-input{height:40vh;margin-top:2rem}.load__game-input::-webkit-scrollbar{width:.7rem;cursor:pointer}.load__game-input::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.5)}.load__game-input::-webkit-scrollbar-thumb{background-color:#003b2f;outline:1px solid rgb(0,59,47)}.load__game-btn{width:100%}.load__pgn-file{margin-top:2rem}.load__pgn-file-info{font-size:1.3rem}.load__pgn-file-info p{margin-top:1rem;color:var(--color-text-dimmed)}.load__link-input{margin-top:2rem}@media (orientation: portrait){.load__game-input{height:20vh}}@media (orientation: landscape) and (max-height: 400px){.load__game-input{height:30vh}}.share{border-bottom-left-radius:5px;border-bottom-right-radius:5px}.share__format,.share__size{padding:.8rem;border-radius:0;margin-bottom:1rem;opacity:.5}.share__format{width:33.33%}.share__size{width:20%}.share__format--first,.share__size--first{border-top-left-radius:5px;border-bottom-left-radius:5px}.share__format--last,.share__size--last{border-top-right-radius:5px;border-bottom-right-radius:5px}.share__format--active,.share__size--active{opacity:1}.share__format--active:hover,.share__size--active:hover{cursor:default}.share__btn{margin-bottom:1rem}.header--first{margin-top:0;margin-bottom:2.5rem}.options__button{margin:3px;padding:.5rem;font-size:3rem;text-align:center;border-radius:5px;width:4.4rem;height:4.4rem;opacity:.5}.options__button--active{opacity:1}.options__button:hover{background:var(--color-btn-light);cursor:pointer}.options__button--last{margin-right:0}.options__button--first{margin-left:0}.rotatable{transition:transform .3s}.rotated{transform:rotate(180deg)}.boards{text-align:center;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.boards__ico{cursor:pointer;width:8.2rem;height:8.2rem;padding:0;display:inline-block;background-size:contain;background-repeat:no-repeat;border:solid .5rem transparent}.boards__ico--active{cursor:default;border:solid 5px var(--color-frame-marker-active)}.pieces{text-align:center;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.pieces__ico{border:solid 5px transparent;margin:5px;cursor:pointer;width:7.2rem;height:7.2rem;background-color:var(--color-highlight);border-radius:.5rem}.pieces__ico--active{border-color:var(--color-frame-marker-active);cursor:default}.tab{border-bottom-left-radius:0;border-bottom-right-radius:0;height:3.8rem;background:var(--color-tab);min-width:4rem}.tab:hover{background:var(--color-tab-light)}.tab--active{background:var(--color-bg-block);color:var(--color-text);cursor:default}.tab--active:hover{background:var(--color-bg-block)}.game-box{grid-area:moves;padding:2rem;padding-top:var(--header-margin);min-width:35rem;height:100vh}.game{height:100%;display:grid;grid-template-rows:3.8rem 22rem auto 8.4rem}.game-tabs{display:grid;grid-auto-flow:column;grid-template-columns:1fr 1fr;column-gap:.5rem}.game-tabs--condensed{grid-template-columns:1fr 1fr 1fr}.span2{grid-row-end:span 2}.span3{grid-row-end:span 3}@media (orientation: portrait){.game-box{padding:0;height:auto;min-height:100vh}.game{display:block}}@media (orientation: landscape) and (max-height: 400px){.game{grid-template-rows:3.8rem 1fr 6.4rem}}.setup-box{height:100vh;grid-area:setup;padding:2rem;padding-top:var(--header-margin);min-width:35rem}.setup{font-size:1.6rem;height:100%;display:grid;grid-template-rows:3.8rem 1fr}.setup-tabs{display:grid;grid-auto-flow:column;grid-template-columns:1fr 1fr 1fr;column-gap:.5rem}@font-face{font-family:Chess;font-weight:400;font-display:swap;src:url(/fonts/Chess.ttf) format("truetype")}@font-face{font-family:Ubuntu;font-weight:500;font-display:swap;src:url(/fonts/Ubuntu-Medium.ttf) format("truetype")}@font-face{font-family:Ubuntu;font-weight:700;font-display:swap;src:url(/fonts/Ubuntu-Bold.ttf) format("truetype")}@font-face{font-family:Fira Mono;font-display:swap;src:url(/fonts/FiraMono-Medium.ttf) format("truetype")}*{border:0;margin:0;padding:0;box-sizing:border-box;outline:none}html{font-size:10px}body{background-repeat:repeat;background-position:center;text-align:center;font-family:Ubuntu,sans-serif;--header-height: 4rem;--header-margin: 6rem}.invisible{font-size:0;height:0}.ubuntu-font-init{font-family:Ubuntu;font-weight:500}.ubuntu-bold-font-init{font-family:Ubuntu;font-weight:700}.fira-font-init{font-family:Fira Mono;font-weight:500}.chess-font-init{font-family:Chess;font-weight:400}.dark{background-color:#313742;background-image:url(/img/pattern.png);background-size:12rem;color:#d4dde0;--logo-url: url(/img/logo.svg);--color--score: #ffffff;--color-btn: rgb(0, 173, 136);--color-btn-light: rgb(0, 207, 162);--color-tab: #899399;--color-tab-light: #a9b4bd;--color-bg-block: #17171f;--color-bg-input: #20242a;--color-border-input: #2d323a;--color-highlight: #ffffff22;--color-text: #aaa;--color-text-contrast: #0e0e13;--color-text-input: #acbddb;--color-text-dimmed: #677794;--color-scrollbar: rgb(0, 59, 47);--color-scrollbar-track: #ffffff22;--color-frame-marker-active: #fff}.light{background-color:#959ea1;background-image:url(/img/pattern-light.png);background-size:12rem;color:#1d1f20;--logo-url: url(/img/logo-dark.svg);--color-btn: rgb(0, 148, 116);--color-btn-light: rgb(0, 114, 89);--color-tab: #5d6468;--color-tab-light: #3e4346;--color-bg-block: #dddddd;--color-bg-input: #eeeeee;--color-border-input: #7f8999;--color-highlight: #00000022;--color-text: rgb(46, 54, 58);--color-text-contrast: #fff;--color-text-input: #46494e;--color-text-dimmed: #767980;--color-scrollbar: rgb(133, 184, 173);--color-scrollbar-track: #00000022;--color-frame-marker-active: #000}button,.upload:before{padding:.8rem;font-family:Ubuntu;font-size:1.5rem;background:var(--color-btn);color:var(--color-text-contrast);border-radius:5px;width:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none}button:hover,.upload:hover:before{background:var(--color-btn-light);cursor:pointer}.btn--error,.btn--error:hover{background-color:#fc4444}input,textarea{width:100%;padding:.8rem;font-family:Fira Mono;font-size:1.4rem;margin-bottom:1rem;background:var(--color-bg-input);border:solid 1px var(--color-border-input);color:var(--color-text-input);outline:none;resize:none}input:focus,textarea:focus{border-color:#005744}h2{color:var(--color-text);text-align:left;font-size:1.5rem;margin:2.5rem 0 1.5rem;font-weight:500}h3{color:var(--color-text);text-align:left;font-size:1.6rem;margin:1.5rem 0 1rem;font-weight:500}hr{margin-top:2rem;border-top:solid 1px var(--color-highlight)}a,a:visited,a:active{color:var(--color-btn);text-decoration:none}a:hover{text-decoration:underline}.invisible{opacity:0}.board-box{height:100vh;grid-area:board;padding:var(--header-margin) 0 2rem 0}.board-box--left{padding-left:2rem}.board{box-shadow:0 0 2rem rgba(0,0,0,.6);border-radius:5px;max-width:100%;max-height:100%}.double{display:grid;grid-template-columns:1fr 1fr;column-gap:1rem}.layout{display:grid;grid-template-columns:1fr 2fr 1fr;grid-template-rows:1fr;grid-template-areas:"setup board moves" "setup board moves";height:100vh}@media (orientation: landscape) and (max-width: 1536px){html{font-size:9px}}@media (orientation: landscape) and (max-width: 1365px){.layout{grid-template-columns:2fr 1fr;grid-template-areas:"board moves" "board moves"}}@media (orientation: portrait){html{font-size:10px}.layout{grid-template-columns:1fr;grid-template-areas:"board" "moves" "setup"}.moves-box{height:auto}.board-box{height:auto;max-height:100vh;padding:var(--header-height) 0 1rem 0;font-size:0}.board{border-radius:0}.setup-box{height:auto}}::placeholder{color:var(--color-text-dimmed)}.popup{width:100vw;height:100vh;position:absolute;top:0;background-color:rgba(0,0,0,.7);padding:2rem;display:grid;vertical-align:middle}.popup__box{background-color:var(--color-bg-block);max-width:300px;width:100%;margin:auto;padding:2rem;border-radius:.5rem;box-shadow:0 0 2rem rgba(0,0,0,.6);position:relative;border:solid 1px var(--color-highlight)}.popup__close{width:3.2rem;position:absolute;top:1rem;right:1rem}.popup__title{text-align:left;margin:0 4.2rem 3rem 0}.popup__content{text-align:left;font-size:1.2rem}.popup__content p,.popup__content ul{margin-top:2rem}.popup__content li{margin-top:.5rem;margin-left:2rem}.about{width:100vw;height:100vh;position:absolute;top:0;display:grid;vertical-align:middle;padding-top:var(--header-height);pointer-events:none}.about__box{background-color:var(--color-bg-input);min-height:100%;width:100%;margin:auto;padding:6rem 2rem 2rem;position:relative;pointer-events:all}.about__close{width:3.2rem;position:absolute;top:1rem;right:1rem}.about__title{text-align:left;margin:0 4.2rem 3rem 0}.about__content{text-align:left;font-size:1.2rem;max-width:800px;margin:auto}.about__content p{margin-top:2rem;font-size:1.4rem;line-height:2rem}.about__content ul{margin-top:2rem;list-style:none;font-size:1.4rem;line-height:3rem}.about__content li{margin-top:.5rem;margin-left:2rem}.about__content kbd{margin-top:.5rem;margin-left:2rem;background-color:var(--color-tab);color:var(--color-text-contrast);padding:.5rem 1rem;margin-right:1rem;border-radius:.5rem;box-shadow:.5rem .5rem 1rem rgba(0,0,0,.2);font-family:Fira Mono,monospace;font-weight:500}.about__shortcuts{display:grid;grid-template-columns:1fr 1fr}\n',document.head.appendChild(t),System.register(["./vendor-legacy.5b4eaa91.js"],(function(){"use strict";var t,o,a,r,i,n,s,l,d,c,h,g,p,f,u,m,b,y,v,_,w,k,S,x;return{setters:[function(e){t=e._,o=e.c,a=e.U,r=e.i,i=e.a,n=e.h,s=e.d,l=e.b,d=e.e,c=e.f,h=e.g,g=e.s,p=e.S,f=e.t,u=e.j,m=e.m,b=e.F,y=e.k,v=e.M,_=e.l,w=e.G,k=e.n,S=e.o,x=e.r}],execute:function(){const C={horizontal:[0,0,1,0],vertical:[0,0,0,1],"diagonal-top":[0,0,1,1],"diagonal-bottom":[0,1,1,0]},$=e=>new Promise((t=>{const o=new Image;o.addEventListener("load",(()=>t(o)),{once:!0}),o.src=e})),B=async(e,t,o,a,r,i,n=8)=>{if("image"===i.type){const s=await $(i.data.src);return void(n<8?e.drawImage(s,0,0,s.width*(n/8),s.height*(n/8),a,r,t,o):e.drawImage(s,a,r,t,o))}const s=await("solid"===i.type?i.data.color:((e,t,o,a,r,i)=>{let n;if("radial"===t.dir){const t=Math.sqrt((o/2)**2+(a/2)**2);n=e.createRadialGradient(r+o/2,i+a/2,t,r+o/2,i+a/2,0)}else{const[s,l,d,c]=C[t.dir];n=e.createLinearGradient(r+s*o,i+l*a,r+d*o,i+c*a)}const s=t.colors.length-1;return t.colors.forEach(((e,t)=>{n.addColorStop(t/s,e)})),n})(e,i.data,t,o,a,r));if(null===s)throw new Error("Cannot create canvas fill style");e.fillStyle=s,e.fillRect(a,r,t,o)},E=(e,t,o,a,r=!1,i,n,s,l)=>{const d=n/1024;if(d<=.32)return;const c=22*d,h=6*d,g=4*d,p="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26".split(",").slice(0,a),f=r?p:p.reverse();e.font=`${c}px Fira Mono`,e.textBaseline=s?"middle":"top",f.forEach(((a,r)=>{e.fillStyle=i>0?t.onBorder:r%2==0?t.onLight:t.onDark;const n=s?i/2:h,d=(s?o*r+i+o/2:o*r+h)+l;e.textAlign=s?"center":"left",e.fillText(a,n,d)}));const u="ABCDEFGHIJKLMNOPQRSTUWVXYZ".split("").slice(0,a),m=r?u.reverse():u;e.textBaseline=s?"middle":"bottom",m.forEach(((a,r)=>{e.fillStyle=i>0?t.onBorder:r%2==0?t.onDark:t.onLight;const d=s?o*r+i+o/2:o*r+h,c=(s?n-i/2:n-g)+l;e.textAlign=s?"center":"left",e.fillText(a,d,c)}))};const D=(e,o,a=0,r=0)=>{const[i,n,s]=t(4===e.length?1:2,e.slice(1).split("")).map((e=>parseInt(e.join(""),16)));let[l,d,c]=((e,t,o)=>{e/=255,t/=255,o/=255;let a=Math.max(e,t,o),r=a-Math.min(e,t,o),i=1-Math.abs(a+a-r-1),n=r&&(a==e?(t-o)/r:a==t?2+(o-e)/r:4+(e-t)/r);return[60*(n<0?n+6:n),i?r/i:0,(a+a-r)/2]})(i,n,s);const h=Math.abs(o);return l>=60&&l<240?(l+=o,l<60&&l>60-h?l=60:l>240&&l<240+h&&(l=240)):(l-=o,l>60&&l<60+h?l=60:l<240&&l>240-h&&(l=240)),l=l>360?l-360:l>0?l+360:l,d=Math.min(1,Math.max(0,d+a)),c=Math.min(1,Math.max(0,c+r)),((e,t,o)=>{const a=t*Math.min(o,1-o),r=(t,r=(t+e/30)%12)=>o-a*Math.max(Math.min(r-3,9-r,1),-1);return"#"+[Math.round(255*r(0)),Math.round(255*r(8)),Math.round(255*r(4))].map((e=>e.toString(16))).join("")})(l,d,c)},L=(e,t,o)=>{const a="abcdefghijklmnopqrstuwvxyz".indexOf(e[0]),r=Number(e[1])-1;return[t?o-a-1:a,t?r:o-r-1]},z={Event:"E",Site:"S",Round:"N",White:"W",Black:"B",Date:"D",Result:"R",FEN:"F",WhiteElo:"WE",BlackElo:"BE"},I=Object.keys(z),F=Object.fromEntries(Object.entries(z).map((([e,t])=>[t,e]))),N=e=>{const t=new o.Chess;if(t.load_pgn(e),t.delete_comments(),!t.header().Result){const o=(e.trim().match(/(1-0)|(0-1)|(1\/2-1\/2)$/)||[])[0];o&&t.header("Result",o)}const a=Object.entries(t.header()),[r,i]=a.length>0?t.pgn().split("\n\n"):[void 0,t.pgn()];return[a.filter((([e,t])=>I.includes(e)&&"?"!==t)).map((([e,t])=>`[${e} "${t}"]`)).sort().join("\n"),i].join("\n\n")},P=e=>{const t=new o.Chess;t.load_pgn(e);const a=t.history().join(" "),r=Object.entries(t.header()).filter((([e])=>I.includes(e))).map((([e,t])=>`${z[e]} ${t}`)).sort().join("\n");return btoa([r,a].join("\n\n"))},A=e=>{const[t,o]=atob(e).split("\n\n");let a;return[t.split("\n").map((e=>{const[t,...o]=e.split(" "),r=o.join(" ");return"R"===t&&(a=r),`[${F[t]} "${r}"]`})).join("\n"),o.split(" ").map(((e,t)=>t%2==0?`${t/2+1}. ${e}`:e)).join(" ")+` ${a}`].join("\n\n")},T=["January","February","March","April","May","June","July","August","September","October","November","December"],M=e=>{const[t,o,a]=e.split(".").map(Number),r=Number.isNaN(o)?null:T[o-1],i=Number.isNaN(a)||null===r?null:a,n=Number.isNaN(t)?null:t;return r&&i&&n?`${r} ${i}, ${n}`:r&&n?`${r} ${n}`:n?String(n):""},O=e=>e.split(",").map((e=>e.trim())).reverse().join(" "),R=e=>{if(null===e)return!1;try{return new URL(e),!0}catch{return!1}},W=new Map([["q",9],["r",5],["b",3],["n",3],["p",1]]),H=(e,t=null)=>e&&"?"!==e?e:t;class j{constructor(){e(this,"positions",[]),e(this,"game",new o.Chess)}loadPGN(e){const t=new o.Chess,a=new o.Chess;t.load_pgn(N(e)),t.delete_comments();const r=t.history({verbose:!0}),i=t.header().FEN;return i&&a.load(i),this.positions=[{ply:0,move:null,end:r.length,fen:a.fen(),check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(a.fen()),last:0===r.length}],r.forEach(((e,t)=>{a.move(e);const o=a.fen();this.positions.push({ply:t+1,move:e,end:r.length-1-t,fen:o,check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(o),last:t===r.length-1})})),this.game=t,this}loadFEN(e){return this.game=new o.Chess(e),this.positions=[{ply:0,move:null,end:0,fen:e,check:this.game.in_check(),mate:this.game.in_checkmate(),turn:this.game.turn(),material:this.materialInfo(this.game.board()),placement:this.getPlacement(this.game.fen()),last:!0}],this}getPlacement(e){const t=new o.Chess(e).board(),a=[];for(let o=0;o<8;o++)for(let e=0;e<8;e++)if(null!==t[o][e]){const{type:r,color:i}=t[o][e];a.push({x:e,y:o,type:r,color:i})}return a}materialInfo(e){const t=e.flat().filter(Boolean),o={w:0,b:0},a={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}},r={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}};for(const n of t)if(null!==n&&"k"!==n.type){var i;o[n.color]+=null!==(i=W.get(n.type))&&void 0!==i?i:0,r[n.color][n.type]+=1;const e="b"===n.color?"w":"b";0===a[e][n.type]?a[n.color][n.type]+=1:a[e][n.type]-=1}return{sum:o,imbalance:a,count:r,diff:o.w-o.b}}get length(){return this.positions.length}get header(){const e=this.game.header(),t=H(e.White,"Anonymous"),o=H(e.Black,"Anonymous"),a=H(e.Date);return{White:t,Black:o,WhitePretty:O(t),BlackPretty:O(o),WhiteElo:H(e.WhiteElo),BlackElo:H(e.BlackElo),Date:a,DatePretty:null===a?null:M(a),Event:H(e.Event),Round:H(e.Round),Site:H(e.Site),Result:H(e.Result)}}getTitle({anonymous:e}){const t=this.header;return`${e?"Anonymous":t.WhitePretty} vs ${e?"Anonymous":t.BlackPretty}`+(t.Event?` | ${t.Event}`:"")+(t.Round?`, Round ${t.Round}`:"")+(t.DatePretty?` | ${t.DatePretty}`:"")}getFileName(e){const t=this.header,o=e?"Anonymous":t.WhitePretty,a=e?"Anonymous":t.BlackPretty;return((t.Date?`${t.Date.replace(/\?/g,"X").replace(/\./g,"-")}_`:"")+`${o}_${a}`+(t.Event?`_${t.Event}`:"")+(t.Round?`_R${t.Round}`:"")).replace(/\s+/g,"-")}get pgn(){return this.game.pgn()}get anonymousPGN(){const e=this.game.pgn().replace(/\[White .+\]/,'[White "Anonymous"]').replace(/\[Black .+\]/,'[Black "Anonymous"]');return R(this.header.Site)?e.replace(/\[Site .+\]/,'[Site "?"]'):e}getPosition(e){const t=this.positions[e];return null!=t?t:null}getMoves(){return this.positions.slice(1).map((({move:e})=>null==e?void 0:e.san))}}const U="#FF7C44",G="#F65656",q="#FB6299",X="#C84CF3",J="#7673FF",Y="#3C85F4",K="#07C575",V="#69C549",Q="#AC746D",Z="#D47669",ee="#DF8F6C",te="#EAA464",oe={standard:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#00ad88"}},light:{type:"solid",data:{color:"#9EE0BC"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#00735a"}},coords:{onLight:"#00735a",onDark:"#d4fff5",onBorder:"#bbfaec"}},spring:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#6BB53E"}},light:{type:"solid",data:{color:"#C1D997"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"solid",data:{color:"#40761E"}},coords:{onLight:"#40761E",onDark:"#DBF5AD",onBorder:"#DBF5AD"}},azure:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#277ECE"}},light:{type:"solid",data:{color:"#7DD3E2"}},moveIndicator:{type:"color",data:"#ff000044"},border:{type:"solid",data:{color:"#0F508C"}},coords:{onLight:"#0F508C",onDark:"#ACE3EC",onBorder:"#ACE3EC"}},violet:{category:"solid",background:{type:"solid",data:{color:"#361b52"}},dark:{type:"solid",data:{color:"#7b4fa8"}},light:{type:"solid",data:{color:"#CB95CB"}},moveIndicator:{type:"hueShift",data:-60},border:{type:"solid",data:{color:"#50346e"}},coords:{onLight:"#50346e",onDark:"#eedeff",onBorder:"#e2c7ff"}},rose:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#F04A73"}},light:{type:"solid",data:{color:"#F7A8A1"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#A62444"}},coords:{onLight:"#f04a73",onDark:"#ffb8c9",onBorder:"#ffb8c9"}},peach:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#E54B4B"}},light:{type:"solid",data:{color:"#EFB293"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#9E3131"}},coords:{onLight:"#e54b4b",onDark:"#EFB293",onBorder:"#EFB293"}},clay:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#BF5344"}},light:{type:"solid",data:{color:"#D9B08F"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#793329"}},coords:{onLight:"#793329",onDark:"#F4C8A3",onBorder:"#F4C8A3"}},rock:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#949494"}},light:{type:"solid",data:{color:"#D4D4D4"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#595959"}},coords:{onLight:"#595959",onDark:"#EAEAEA",onBorder:"#EAEAEA"}},lila:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#c0acb5"}},light:{type:"solid",data:{color:"#e5d0cb"}},moveIndicator:{type:"hueShift",data:-120},border:{type:"solid",data:{color:"#735c66"}},coords:{onLight:"#876b77",onDark:"#fff5f2",onBorder:"#e5d0cb"}},leko:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#919caf"}},light:{type:"solid",data:{color:"#c0c2d0"}},moveIndicator:{type:"hueShift",data:-90},border:{type:"solid",data:{color:"#58606e"}},coords:{onLight:"#58606e",onDark:"#dbe8ff",onBorder:"#dbe8ff"}},patina:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#93b092"}},light:{type:"solid",data:{color:"#becfc2"}},moveIndicator:{type:"hueShift",data:90},border:{type:"solid",data:{color:"#596e59"}},coords:{onLight:"#596e59",onDark:"#e4f5e4",onBorder:"#e4f5e4"}},mud:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b0a392"}},light:{type:"solid",data:{color:"#cfc8be"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#6e6559"}},coords:{onLight:"#6e6559",onDark:"#f5eee5",onBorder:"#f5eee5"}},danny:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#769656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312e2b"}},coords:{onLight:"#40522f",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_green:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569666"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#40ff007f"},border:{type:"solid",data:{color:"#2B312B"}},coords:{onLight:"#2F5238",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_cyan:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00ff807f"},border:{type:"solid",data:{color:"#2B3130"}},coords:{onLight:"#2F5152",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_blue:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#566696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00bfff7f"},border:{type:"solid",data:{color:"#2B2E31"}},coords:{onLight:"#2F3752",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_purple:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#765696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38af7f"},border:{type:"solid",data:{color:"#2D2B31"}},coords:{onLight:"#412F52b",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_pink:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965686"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38637f"},border:{type:"solid",data:{color:"#312B31"}},coords:{onLight:"#522F49",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_red:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffaf387f"},border:{type:"solid",data:{color:"#312B2D"}},coords:{onLight:"#522F2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},danny_yellow:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#968656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312E2B"}},coords:{onLight:"#524A2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},lichess:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b58863"}},light:{type:"solid",data:{color:"#f0d9b5"}},moveIndicator:{type:"hueShift",data:-40},border:{type:"solid",data:{color:"#80634d"}},coords:{onLight:"#9c6f49",onDark:"#f9f0e1",onBorder:"#f9f0e1"}},danya:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#4c7399"}},light:{type:"solid",data:{color:"#eae9d2"}},moveIndicator:{type:"color",data:"#00a5ff7f"},border:{type:"solid",data:{color:"#2a4057"}},coords:{onLight:"#2a4057",onDark:"#fffff0",onBorder:"#eae9d2"}},botez:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#8877b6"}},light:{type:"solid",data:{color:"#efefef"}},moveIndicator:{type:"color",data:"#7dacc97f"},border:{type:"solid",data:{color:"#554973"}},coords:{onLight:"#554973",onDark:"#f2f2f2",onBorder:"#efefef"}},avocado:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#72a843"}},light:{type:"solid",data:{color:"#ececa4"}},moveIndicator:{type:"hueShift",data:70},border:{type:"solid",data:{color:"#2d3923"}},coords:{onLight:"#4d7a26",onDark:"#ffffc4",onBorder:"#ececa4"}},mono_chico:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#885953"}},light:{type:"solid",data:{color:"#AB8A86"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#885953"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_mojo:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C95D3B"}},light:{type:"solid",data:{color:"#D98D75"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#C95D3B"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_mahogany:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#CA3838"}},light:{type:"solid",data:{color:"#DA7373"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#CA3838"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_mulberry:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C24B84"}},light:{type:"solid",data:{color:"#D481A9"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#C24B84"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_blue:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#514FAE"}},light:{type:"solid",data:{color:"#8583C6"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#514FAE"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_teal:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#106C73"}},light:{type:"solid",data:{color:"#4C989D"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#106C73"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_goblin:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#468557"}},light:{type:"solid",data:{color:"#7DA989"}},moveIndicator:{type:"hueShift",data:40},border:{type:"solid",data:{color:"#468557"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_sycamore:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#809D41"}},light:{type:"solid",data:{color:"#A6BA7A"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#809D41"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},mono_coral:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:U}},light:{type:"solid",data:{color:"#FFBDA1"}},moveIndicator:{type:"color",data:"#00ffaa55"},border:{type:"solid",data:{color:U}},coords:{onLight:"#DC4200",onDark:"#ffffff",onBorder:"#00000088"}},mono_flamingo:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:G}},light:{type:"solid",data:{color:"#FAAAAA"}},moveIndicator:{type:"color",data:"#ffff0033"},border:{type:"solid",data:{color:G}},coords:{onLight:"#BC2D2D",onDark:"#ffffff",onBorder:"#00000088"}},mono_rose:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:q}},light:{type:"solid",data:{color:"#FDB0CC"}},moveIndicator:{type:"color",data:"#ffff0033"},border:{type:"solid",data:{color:q}},coords:{onLight:"#C8215D",onDark:"#ffffff",onBorder:"#00000088"}},mono_heliotrope:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:X}},light:{type:"solid",data:{color:"#E3A5F9"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:X}},coords:{onLight:"#881EAC",onDark:"#ffffff",onBorder:"#00000088"}},mono_cornflower:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:J}},light:{type:"solid",data:{color:"#BAB9FF"}},moveIndicator:{type:"color",data:"#ff770055"},border:{type:"solid",data:{color:J}},coords:{onLight:"#3734B0",onDark:"#ffffff",onBorder:"#00000088"}},mono_dodger:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Y}},light:{type:"solid",data:{color:"#9DC2F9"}},moveIndicator:{type:"color",data:"#55ff0055"},border:{type:"solid",data:{color:Y}},coords:{onLight:"#1451AE",onDark:"#ffffff",onBorder:"#00000088"}},mono_meadow:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:K}},light:{type:"solid",data:{color:"#83E2BA"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:K}},coords:{onLight:"#07834F",onDark:"#ffffff",onBorder:"#00000088"}},mono_mantis:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:V}},light:{type:"solid",data:{color:"#B4E2A4"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:V}},coords:{onLight:"#4C9433",onDark:"#ffffff",onBorder:"#00000088"}},mono_coper:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Q}},light:{type:"solid",data:{color:"#D5B9B6"}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:Q}},coords:{onLight:"#704944",onDark:"#ffffff",onBorder:"#00000088"}},mono_contessa:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:Z}},light:{type:"solid",data:{color:"#E9BAB4"}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:Z}},coords:{onLight:"#95493F",onDark:"#ffffff",onBorder:"#00000088"}},mono_terracotta:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:ee}},light:{type:"solid",data:{color:"#EFC7B5"}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:ee}},coords:{onLight:"#A56A51",onDark:"#ffffff",onBorder:"#00000088"}},mono_harvest:{category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:te}},light:{type:"solid",data:{color:"#F4D1B1"}},moveIndicator:{type:"color",data:"#00ff0033"},border:{type:"solid",data:{color:te}},coords:{onLight:"#BD8551",onDark:"#ffffff",onBorder:"#00000088"}},smooth_sunset:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5B061","#EC366D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC7D47","#C32C73"]}},coords:{onLight:"#CF545D",onDark:"#fff",onBorder:"#fff"}},smooth_summer:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5CB61","#F58D61"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#D1AC4F","#D07852"]}},coords:{onLight:"#B2793C",onDark:"#fff",onBorder:"#fff"}},smooth_spring:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#D9DC5C","#60C945"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#B9BC4E","#50A839"]}},coords:{onLight:"#81A33A",onDark:"#fff",onBorder:"#fff"}},smooth_forest:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#96C93D","#00B09B"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#65A32E","#007A80"]}},coords:{onLight:"#328E57",onDark:"#fff",onBorder:"#fff"}},smooth_laguna:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#00c4a0","#096fe0"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#009c7f","#0052ad"]}},coords:{onLight:"#007795",onDark:"#fff",onBorder:"#fff"}},smooth_sea:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#2881E4","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ff00ff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#1863B7","#773DC1"]}},coords:{onLight:"#4750BC",onDark:"#fff",onBorder:"#fff"}},smooth_violet:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC3BCC","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#AF2EA2","#8243D3"]}},coords:{onLight:"#9838BA",onDark:"#fff",onBorder:"#fff"}},smooth_mono:{category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#BFBFBF","#7D7D7D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#A1A1A1","#606060"]}},coords:{onLight:"#818181",onDark:"#fff",onBorder:"#fff"}},contrast_a:{category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#ff9b38","#389bff"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#f27f0d","#0d7ff2"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},contrast_b:{category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF4DA6","#4D74FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#BB3D7C","#3653BB"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},contrast_c:{category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF8D4D","#914DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"vertical",colors:["#E8702C","#6334B0"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},contrast_d:{category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#61c43f","#864DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#559a3c","#6333cc"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},wood1:{category:"pic",background:{type:"image",data:{src:"/textures/wood01.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood01_bg.jpg"}},coords:{onLight:"#604939",onDark:"#e1d0b7",onBorder:"#dac4a4"},ico:"/textures/wood01_ico.png"},wood2:{category:"pic",background:{type:"image",data:{src:"/textures/wood02.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood02_bg.jpg"}},coords:{onLight:"#704642",onDark:"#e1c1b7",onBorder:"#d9b1a5"},ico:"/textures/wood02_ico.png"},wood3:{category:"pic",background:{type:"image",data:{src:"/textures/wood03.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood03_bg.jpg"}},coords:{onLight:"#986738",onDark:"#e2d3b6",onBorder:"#dac7a0"},ico:"/textures/wood03_ico.png"},wood4:{category:"pic",background:{type:"image",data:{src:"/textures/wood04.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood04_bg.jpg"}},coords:{onLight:"#9e543b",onDark:"#e3c7b5",onBorder:"#ddbba4"},ico:"/textures/wood04_ico.png"},wood5:{category:"pic",background:{type:"image",data:{src:"/textures/wood05.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood05_bg.jpg"}},coords:{onLight:"#8f653d",onDark:"#e3ceb5",onBorder:"#dcc2a3"},ico:"/textures/wood05_ico.png"},wood6:{category:"pic",background:{type:"image",data:{src:"/textures/wood06.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood06_bg.jpg"}},coords:{onLight:"#865946",onDark:"#dfc8b9",onBorder:"#d7bba8"},ico:"/textures/wood06_ico.png"},wood7:{category:"pic",background:{type:"image",data:{src:"/textures/wood07.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood07_bg.jpg"}},coords:{onLight:"#734926",onDark:"#cab99b",onBorder:"#cab99b"},ico:"/textures/wood07_ico.png"},wood8:{category:"pic",background:{type:"image",data:{src:"/textures/wood08.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood08_bg.jpg"}},coords:{onLight:"#723627",onDark:"#cbad9a",onBorder:"#cbad9a"},ico:"/textures/wood08_ico.png"}},ae=Object.keys(oe),re=["adventurer","alfonso_x","alpha","anarchy","anarchy_candy","anarchy_sepia","berlin","california","cardinal","cases","cburnett","chess7","chessnut","companion","condal","dubrovny","fantasy","fresca","gioco","governor","harlequin","horsey","icpieces","kingdom","kosal","leipzig","letter","libra","line","lucena","maestro","magnetic","mark","marroquin","maya","mediaeval","merida","millennia","motif","pirat","pirouetti","pixel","regular","reillycraig","riohacha","shapes","smart","spatial","staunty","symmetric","tatiana","tfb","traveller","utrecht","wisdom"],ie=["bb","bw","kb","kw","nb","nw","pb","pw","qb","qw","rb","rw"],ne=e=>(ae.includes(e.boardStyle)||delete e.boardStyle,re.includes(e.piecesStyle)||delete e.piecesStyle,e),se=a(),le=r(),de=(()=>{const e=localStorage.getItem("boardConfig"),t=localStorage.getItem("gameConfig"),o=localStorage.getItem("siteConfig"),a=localStorage.getItem("recent");return{boardConfig:null===e?{}:ne(JSON.parse(e)),gameConfig:null===t?{}:JSON.parse(t),siteConfig:null===o?{}:JSON.parse(o),recent:null===a?[]:JSON.parse(a)}})(),ce={boardConfig:{size:1024,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!1,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1,...de.boardConfig},gameConfig:{titleScreen:!0,format:"GIF",picSize:"M",animationSize:"M",...de.gameConfig},siteConfig:{darkMode:!0,sounds:!0,speech:!1,wrongBrowserPopup:!0,androidAppPopup:!0,iOSAppPopup:!0,...de.siteConfig},game:new j,pgn:"",fen:"",moves:[],ply:0,mobile:le,layout:window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple",activeTab:"load",playing:!1,anonymous:!1,refreshHash:!0,browser:se.browser.name,os:se.os.name,about:!1,recent:de.recent},[he,ge]=i(ce);let pe=null,fe=new Map;const ue={async load(e){await Promise.all(ie.map((t=>$(`/pieces/${e}/${t}.svg`).then((e=>{fe.set(t,e)})))))},async get(e,t,o){pe!==e&&(await this.load(e),pe=e);const a=`${t}${o}`;return fe.get(a)}},me=(e,t,o,a,r,i,n,s,l)=>(e.font=`${r} ${a}px ${o}`,e.textAlign=s,e.textBaseline="middle",e.fillText(t,i,n,l),Math.ceil(e.measureText(t).width)),be={k:"l",q:"w",r:"t",b:"n",n:"j",p:"o"},ye={size:720,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!0,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},ve={White:"White",Black:"Black",WhitePretty:"White",BlackPretty:"Black",WhiteElo:null,BlackElo:null,Date:null,DatePretty:null,Event:null,Round:null,Site:null,Result:null};class _e{constructor(t={}){e(this,"cfg",ye),e(this,"_anonymous",!1),e(this,"scale",1),e(this,"borderScale",1),e(this,"size",0),e(this,"squareSize",0),e(this,"innerSize",0),e(this,"borderWidth",0),e(this,"margin",0),e(this,"style",oe.standard),e(this,"header",ve),e(this,"lastPosition",null),e(this,"background",null),e(this,"currentScreen","move"),e(this,"ctx",void 0),e(this,"tempCtx",void 0),e(this,"tempCanvas",document.createElement("canvas")),e(this,"canvas",document.createElement("canvas"));const o=this.canvas.getContext("2d"),a=this.tempCanvas.getContext("2d");if(this.canvas.classList.add("board"),null===o||null===a)throw new Error("Cannot create canvas 2D context");this.ctx=o,this.tempCtx=a,this.updateConfig(t,!1)}async setCanvas(e){this.canvas=e,this.ctx=e.getContext("2d"),this.setSize(this.cfg.size),await this.refresh()}async updateConfig(e,t=!0){const o={...this.cfg,...e};this.cfg=o,this.setSize(o.size),this.setStyle(o.boardStyle),t&&await this.refresh()}set anonymous(e){this._anonymous=e,this.refresh()}async refresh(){await this.renderBackground(),"title"===this.currentScreen?await this.titleFrame(this.header):null!==this.lastPosition&&await this.frame(this.lastPosition,this.header),this.render()}setSize(e){this.size=e,this.scale=e/720,this.margin=this.cfg.showExtraInfo?Math.round(50*this.scale):0;const t=e+2*this.margin;this.canvas.width===e&&this.canvas.height===t||(this.canvas.width=e,this.canvas.height=t,this.tempCanvas.width=e,this.tempCanvas.height=t);const o=this.cfg.showBorder?this.size/32*this.borderScale:0,a=this.size-2*o;return this.squareSize=Math.floor(a/this.cfg.tiles),this.innerSize=this.squareSize*this.cfg.tiles,this.borderWidth=(this.size-this.innerSize)/2,this}getSize(){return this.size}setBorderScale(e){this.borderScale=e}setStyle(e){return this.style=oe[e],this.cfg.boardStyle=e,this.refresh(),this}setPiecesStyle(e){return this.cfg.piecesStyle=e,this.refresh(),this}flip(){return this.cfg.flipped=!this.cfg.flipped,this.refresh(),this}flipWhite(){if(this.cfg.flipped)return this.cfg.flipped=!1,this.refresh(),this}flipBlack(){if(!this.cfg.flipped)return this.cfg.flipped=!0,this.refresh(),this}hideBorder(){return this.cfg.showBorder=!1,this.setSize(this.size),this.refresh(),this}showBorder(){return this.cfg.showBorder=!0,this.setSize(this.size),this.refresh(),this}toggleBorder(){return this.cfg.showBorder=!this.cfg.showBorder,this.setSize(this.size),this.refresh(),this}toggleExtraInfo(){return this.cfg.showExtraInfo=!this.cfg.showExtraInfo,this.setSize(this.size),this.refresh(),this}toggleShadows(){return this.cfg.showShadows=!this.cfg.showShadows,this.refresh(),this}getFinalHeader(){return this._anonymous?{...this.header,White:"Anonymous",Black:"Anonymous",WhitePretty:"Anonymous",BlackPretty:"Anonymous",Site:R(this.header.Site)?null:this.header.Site}:{...this.header,Site:R(this.header.Site)?this.header.Site.replace(/^http[s]*:\/\//,""):this.header.Site}}async titleFrame(e){this.currentScreen="title",this.header=e,await(async(e,t,o,a,r,i)=>{e.clearRect(0,0,t,t),await B(e,t,t+2*a,0,0,r.border);const n="Ubuntu",s=[{key:"WhitePretty",line:60*o,fontSize:42*o,n:0},{key:"BlackPretty",line:60*o,fontSize:42*o,n:2},{key:"Event",line:30*o,fontSize:20*o,n:4},{key:"Round",line:30*o,fontSize:20*o,n:5},{key:"DatePretty",line:30*o,fontSize:20*o,n:7},{key:"Site",line:30*o,fontSize:20*o,n:8}],l=new Set(Object.keys(i)),d=s.filter((({key:e})=>l.has(e)));if(i.WhitePretty&&i.BlackPretty&&d.push({key:"vs",line:50*o,fontSize:20*o,n:1}),(i.Event||i.Round)&&d.push({key:"margin",line:100*o,fontSize:0,n:3}),i.Date||i.Site){const e=i.Event||i.Round?20*o:100*o;d.push({key:"margin",line:e,fontSize:0,n:6})}const c=d.reduce(((e,t)=>e+t.line),0);let h=(t+2*a-c)/2;e.fillStyle=r.coords.onBorder,d.sort(((e,t)=>e.n-t.n)).forEach((({key:o,line:a,fontSize:r})=>{if("vs"===o)return me(e,"vs",n,r,700,t/2,h+a/2,"center"),void(h+=a);if("margin"===o)return void(h+=a);const s=i[o];s&&me(e,"Round"===o?`Round ${s}`:s,n,r,700,t/2,h+a/2,"center",.9*t),h+=a}));const g=await $("/img/logo-full.svg"),p=.114*t*.5;e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=10*o,e.drawImage(g,t/4,a+t+a-2*p,t/2,p),e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0})(this.tempCtx,this.size,this.scale,this.margin,this.style,this.getFinalHeader())}async renderBackground(){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.size,e.height=this.size+2*this.margin;const{background:o,dark:a,light:r,border:i,coords:n}=this.style;await B(t,this.width,this.height,0,0,i),await B(t,this.innerSize,this.innerSize,this.cfg.showBorder?this.borderWidth:0,(this.cfg.showBorder?this.borderWidth:0)+this.margin,o,this.cfg.tiles);for(let s=0;s<this.cfg.tiles;s++)for(let e=0;e<this.cfg.tiles;e++){const o=e%2==0&&s%2==0||e%2!=0&&s%2!=0?r:a,i=e*this.squareSize+this.borderWidth,n=s*this.squareSize+this.borderWidth+this.margin;await B(t,this.squareSize,this.squareSize,i,n,o)}this.cfg.showBorder&&this.cfg.showCoords&&E(t,n,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.background=e}async frame(e,t){var o;this.currentScreen="move",this.lastPosition=e,this.header=null!=t?t:this.header,this.tempCtx.clearRect(0,0,this.size,this.size),null===this.background&&await this.renderBackground(),this.tempCtx.drawImage(await this.background,0,0),null!==(o=this.lastPosition)&&void 0!==o&&o.move&&this.cfg.showMoveIndicator&&await(async(e,t,o,{dark:a,light:r,moveIndicator:i},n,s,l,d)=>{const[c,h]=L(t.from,l,s),[g,p]=L(t.to,l,s),[f,u,m,b]=[c,h,g,p].map((e=>e*o+n));let y,v;if("hueShift"===i.type){const e={type:"solid",data:{color:r.data.color?D(r.data.color,i.data):"#00ff0055"}},t={type:"solid",data:{color:a.data.color?D(a.data.color,i.data):"#00ff0055"}};y=(c+h)%2==0?e:t,v=(g+p)%2==0?e:t}else y={type:"solid",data:{color:i.data}},v=y;B(e,o,o,f,u+d,y),B(e,o,o,m,b+d,v)})(this.tempCtx,this.lastPosition.move,this.squareSize,this.style,this.borderWidth,this.cfg.tiles,this.cfg.flipped,this.margin),!this.cfg.showBorder&&this.cfg.showCoords&&E(this.tempCtx,this.style.coords,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.lastPosition&&(await(async(e,t,o,a,r,i,n,s=!0)=>{const{placement:l,check:d,mate:c,turn:h}=t;e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;for(const{x:g,y:p,type:f,color:u}of l){const t=await ue.get(n,f,u),l=r?7-p:p,m=r?7-g:g;if((d||c)&&"k"===f&&u===h){const r=c?"#ff002f":"#ffa600";e.shadowColor=r,e.shadowBlur=o*(he.mobile,.15),e.shadowOffsetX=0,e.shadowOffsetY=0,e.drawImage(t,a+m*o,a+l*o+i,o,o)}else s&&(e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=.07*o,e.shadowOffsetY=.07*o,e.shadowBlur=.1*o);e.drawImage(t,a+m*o,a+l*o+i,o,o),e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}})(this.tempCtx,this.lastPosition,this.squareSize,this.borderWidth,this.cfg.flipped,this.margin,this.cfg.piecesStyle,this.cfg.showShadows),this.cfg.showExtraInfo&&t&&await(async(e,t,o,a,r,i,n,s,l)=>{const d=Math.round(20*a);let c=(r-d)/2,h=r/2;const g=c;e.fillStyle=i.coords.onBorder;{const t=me(e,"Anonymous"===n.White?"White":n.White,"Ubuntu",d,700,g,s?h:o-h,"left"),a=n.WhiteElo?` ${n.WhiteElo}`:"";me(e,a,"Fira Mono",d,500,g+t,s?h:o-h,"left")}{const t=me(e,"Anonymous"===n.Black?"Black":n.Black,"Ubuntu",d,700,g,s?o-h:h,"left"),a=n.BlackElo?` ${n.BlackElo}`:"";me(e,a,"Fira Mono",d,500,g+t,s?o-h:h,"left")}let p=0,f=0;if(l.last&&n.Result){const[r,i]=n.Result.split("-"),l="0"===i?"Lost":"1"===i?"Won":"Draw",g=me(e,"0"===r?"Lost":"1"===r?"Won":"Draw","Ubuntu",d,700,t-c,s?h:o-h,"right"),u=me(e,l,"Ubuntu",d,700,t-c,s?o-h:h,"right"),m=Math.max(g,u);p=m+20*a,f=m+20*a}const{diff:u,imbalance:m}=l.material,b=u>0?`+${Math.abs(u)}`:"";p+=me(e,b,"Fira Mono",d,500,t-c-p,s?h:o-h,"right");const y=u<0?`+${Math.abs(u)}`:"";f+=me(e,y,"Fira Mono",d,500,t-c-f,s?o-h:h,"right");for(const[v,_]of Object.entries(m.w))for(let r=0;r<_;r++){const i=me(e,be[v],"Chess",d,500,t-c-p,(s?h:o-h)-2*a,"right");p+=r===_-1?.85*i:"p"===v?.4*i:.6*i}for(const[v,_]of Object.entries(m.b))for(let r=0;r<_;r++){const i=me(e,be[v],"Chess",d,500,t-c-f,(s?o-h:h)-2*a,"right");f+=r===_-1?.85*i:"p"===v?.4*i:.6*i}})(this.tempCtx,this.width,this.height,this.scale,this.margin,this.style,this.getFinalHeader(),this.cfg.flipped,this.lastPosition))}render(){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.drawImage(this.tempCanvas,0,0)}toImgUrl(){return this.canvas.toDataURL()}toImageData(){return this.ctx.getImageData(0,0,this.width,this.height)}toClampedArray(){return this.ctx.getImageData(0,0,this.width,this.height).data}toImgElement(){const e=this.toImgUrl(),t=new Image;return t.classList.add("board"),t.src=e,t}get width(){return this.size}get height(){return this.size+2*this.margin}toGIF(){}}const we={move:new n.Howl({src:["/sfx/move.mp3"],volume:.3}),take:new n.Howl({src:["/sfx/take.mp3"],volume:.9}),swap:new n.Howl({src:["/sfx/swap.mp3"],volume:.6}),snap:new n.Howl({src:["/sfx/snap.mp3"],volume:.6}),rewind:new n.Howl({src:["/sfx/rewind.mp3"],volume:.2}),enPassant:new n.Howl({src:["/sfx/anarchy/en-passant.mp3"],volume:.2}),horsyMove:new n.Howl({src:["/sfx/anarchy/horsy-move.mp3"],volume:.5}),horsyTake:new n.Howl({src:["/sfx/anarchy/horsy-take.mp3"],volume:.5}),brickMove:new n.Howl({src:["/sfx/anarchy/brick-move.mp3"],volume:.3}),brickTake:new n.Howl({src:["/sfx/anarchy/brick-take.mp3"],volume:.2}),brickCastle:new n.Howl({src:["/sfx/anarchy/brick-castle.mp3"],volume:.3}),coneMove:new n.Howl({src:["/sfx/anarchy/cone-move.mp3"],volume:1}),coneTake:new n.Howl({src:["/sfx/anarchy/cone-take.mp3"],volume:.3}),pipiMove:new n.Howl({src:["/sfx/anarchy/pipi-move.mp3"],volume:.2}),pipiTake:new n.Howl({src:["/sfx/anarchy/pipi-take.mp3"],volume:.4}),toyMove:new n.Howl({src:["/sfx/anarchy/toy-move.mp3"],volume:.9}),toyTake:new n.Howl({src:["/sfx/anarchy/toy-take.mp3"],volume:.8}),deathMove:new n.Howl({src:["/sfx/anarchy/death-move.mp3"],volume:.4}),deathTake:new n.Howl({src:["/sfx/anarchy/death-take.mp3"],volume:.25}),death:new n.Howl({src:["/sfx/anarchy/checkmate.mp3"],volume:1}),hit:new n.Howl({src:["/sfx/anarchy/hit.mp3"],volume:.25})},ke={x:" takes ","+":" check!","#":" mate!","=":" promotes to a ",P:"pawn ",R:"rook ",B:"bishop ",N:"knight ",Q:"queen ",K:"king ","O-O":"short castle","O-O-O":"long castle"},Se=50,xe=1,Ce="en-US";class $e{constructor(){if(e(this,"voice",void 0),window.speechSynthesis){const e=speechSynthesis.getVoices();this.voice=e.find((e=>e.lang===Ce))}else this.voice=void 0}say(e){const t=new SpeechSynthesisUtterance(e);t.volume=Se/100,t.lang=Ce,this.voice&&(t.voice=this.voice),t.rate=1+xe/10,speechSynthesis.speak(t)}}const Be=e=>new Promise((t=>setTimeout(t,e)));class Ee{constructor(t,o){e(this,"interval",1e3),e(this,"game",new j),e(this,"ply",0),e(this,"callback",(()=>{})),e(this,"speech",void 0),e(this,"playing",!1),this.board=t,this.config=o,this.speech=new $e}async init(){await this.board.frame(this.game.getPosition(0),this.game.header).then((e=>this.board.render()))}watch(e){this.callback=e}updateConfig(e){this.config={...this.config,...e}}getPosition(){const e=this.game.getPosition(this.ply);return ge({ply:e.ply}),ge({fen:e.fen}),e}async load(e){this.pause(),this.game=e,this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async play(){for(this.playing=!0,this.callback(this.playing,this.ply),this.ply===this.game.getMoves().length&&this.first();await Be(this.interval),this.playing;)this.next()}pause(){this.playing=!1,this.callback(this.playing,this.ply)}async prev(){const e=this.ply-1;if(!(e<-1||e<0&&!1===this.config.titleScreen)){if(this.ply=e,-1===e)return await this.board.titleFrame(this.game.header),void this.board.render();await this.board.frame(this.getPosition(),this.game.header),this.board.render(),he.siteConfig.sounds&&we.rewind.play()}}playSFX(e){var t,o;e.mate?we.snap.play():/[ce]/.test(null===(t=e.move)||void 0===t?void 0:t.flags)?we.take.play():/[kqp]/.test(null===(o=e.move)||void 0===o?void 0:o.flags)?we.swap.play():we.move.play()}playAnarchySFX(e){var t,o,a,r,i;if(e.mate&&we.death.play(),null!==(t=e.move)&&void 0!==t&&t.flags&&e.move.flags.includes("e")&&we.enPassant.play(),null!==(o=e.move)&&void 0!==o&&o.flags&&e.move.flags.includes("p")&&we.brickCastle.play(),null!==(a=e.move)&&void 0!==a&&a.flags&&e.move.flags.includes("c"))switch(e.move.piece){case"p":we.coneTake.play();break;case"r":we.brickTake.play();break;case"n":we.hit.play(),we.horsyTake.play();break;case"k":we.pipiTake.play();break;case"q":we.deathTake.play();break;case"b":we.toyTake.play();break;default:we.take.play()}else if(/[kq]/.test(null===(r=e.move)||void 0===r?void 0:r.flags))we.brickCastle.play();else switch(null===(i=e.move)||void 0===i?void 0:i.piece){case"p":we.coneMove.play();break;case"r":we.brickMove.play();break;case"n":we.horsyMove.play();break;case"k":we.pipiMove.play();break;case"q":we.deathMove.play();break;case"b":we.toyMove.play();break;default:we.move.play()}}async next(){const e=this.ply+1;if(e>=this.game.length)return void this.pause();this.ply=e;const t=this.getPosition();if(await this.board.frame(t,this.game.header),this.board.render(),window.speechSynthesis){var o;if(this.ply>0&&he.siteConfig.speech)this.speech.say((e=>{if("O-O"===e||"O-O-O"===e)e=ke[e];else{const t=e.match(/[a-h1-8][a-h][1-8]/);t&&(e=e.replace(t[0],`${t[0][0]} ${t[0][1]}${t[0][2]}`)),e=e.split("").map((e=>{var t;return null!==(t=ke[e])&&void 0!==t?t:e})).join("").replace(/\s{2,}/g," ")}return e})(null===(o=t.move)||void 0===o?void 0:o.san));if(this.ply>0&&he.siteConfig.sounds&&(he.boardConfig.piecesStyle.includes("anarchy")?this.playAnarchySFX(t):this.playSFX(t)),0===t.end&&he.siteConfig.speech){const e=this.game.header.Result;e&&this.speech.say("1-0"===e?"White wins!":"0-1"===e?"Black wins!":"Draw!")}}}async first(){this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async last(){this.ply=this.game.length-1,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async goto(e){this.ply=e,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}}const De=f('<div class="header__options-ico"><i class="las"></i></div>'),Le=f('<header class="header-box"><div class="header__logo"><a href="/"><div class="header__logo-pic"></div></a></div><div class="header__options"><div class="header__options-ico" title="ABOUT"><i class="las la-question-circle"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico" title="SOURCE CODE"><a href="https://github.com/sharechess/sharechess" target="_blank"><i class="lab la-github"></i></a></div></div></header>'),ze=e=>(()=>{const t=Le.cloneNode(!0),o=t.firstChild.nextSibling,a=o.firstChild,r=a.nextSibling,i=r.firstChild,n=r.nextSibling,s=n.firstChild;return a.$$click=()=>ge("about",!he.about),l(r,"click",e.handlers.toggleSound,!0),d(o,c(p,{get when(){return window.speechSynthesis},get children(){const t=De.cloneNode(!0),o=t.firstChild;return l(t,"click",e.handlers.toggleSpeech,!0),h((e=>{const a=he.siteConfig.speech?"SPEECH OFF":"SPEECH ON",r=!he.siteConfig.speech,i=he.siteConfig.speech;return a!==e._v$&&g(t,"title",e._v$=a),r!==e._v$2&&o.classList.toggle("la-deaf",e._v$2=r),i!==e._v$3&&o.classList.toggle("la-assistive-listening-systems",e._v$3=i),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),t}}),n),l(n,"click",e.handlers.toggleDarkMode,!0),h((e=>{const t=he.siteConfig.sounds?"MUTE":"SOUND ON",o=!he.siteConfig.sounds,a=he.siteConfig.sounds,l=he.siteConfig.darkMode?"SWITCH TO LIGHT MODE":"SWITCH TO DARK MODE",d=he.siteConfig.darkMode,c=!he.siteConfig.darkMode;return t!==e._v$4&&g(r,"title",e._v$4=t),o!==e._v$5&&i.classList.toggle("la-volume-mute",e._v$5=o),a!==e._v$6&&i.classList.toggle("la-volume-up",e._v$6=a),l!==e._v$7&&g(n,"title",e._v$7=l),d!==e._v$8&&s.classList.toggle("la-sun",e._v$8=d),c!==e._v$9&&s.classList.toggle("la-moon",e._v$9=c),e}),{_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),t})();s(["click"]);const Ie=f('<div><div class="scrollable__content"></div></div>'),Fe=e=>(()=>{const t=Ie.cloneNode(!0),o=t.firstChild;return d(o,(()=>e.children)),h((()=>t.className=`scrollable ${e.class}`)),t})();const Ne=f('<p class="moves__turn"></p>'),Pe=f('<div class="move"><span class="move__id">.</span><span class="move__ply"></span><span class="move__ply"></span></div>'),Ae=e=>(u((()=>{var e;he.mobile||(null===(e=document.querySelector(`[data-ply="${he.ply}"]`))||void 0===e||e.scrollIntoView())})),c(Fe,{get class(){return"moves"+(e.class?` ${e.class}`:"")},get children(){return[c(p,{get when(){return 0===e.moves.length},get children(){const e=Ne.cloneNode(!0);return d(e,(()=>{const e=m((()=>!!he.game.getPosition(0).mate),!0);return()=>e()?"Checkmate.":"w"===he.game.getPosition(0).turn?"White to move.":"Black to move."})()),e}}),c(b,{get each(){return t(2,e.moves)},children:(t,o)=>{const[a,r]=t;return(()=>{const t=Pe.cloneNode(!0),i=t.firstChild,n=i.firstChild,s=i.nextSibling,l=s.nextSibling;return d(i,(()=>o()+1),n),s.$$click=()=>e.handlers.goto(2*o()+1),d(s,a),l.$$click=()=>e.handlers.goto(2*o()+2),d(l,r),h((e=>{const t=he.ply===2*o()+1,a=2*o()+1,r=he.ply===2*o()+2,i=2*o()+2;return t!==e._v$&&s.classList.toggle("move__ply--current",e._v$=t),a!==e._v$2&&g(s,"data-ply",e._v$2=a),r!==e._v$3&&l.classList.toggle("move__ply--current",e._v$3=r),i!==e._v$4&&g(l,"data-ply",e._v$4=i),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),t})()}})]}}));s(["click"]);const Te=f('<i class="las la-play"></i>'),Me=f('<div class="controls"><button class="controls__button controls__button--first" title="FIRST"><i class="las la-angle-double-left"></i></button><button class="controls__button" title="PREV"><i class="las la-angle-left"></i></button><button class="controls__button"></button><button class="controls__button controls__button--next" title="NEXT"><i class="las la-angle-right"></i></button><button class="controls__button controls__button--last" title="LAST"><i class="las la-angle-double-right"></i></button><button title="FLIP" class="flip__button"><i class="las la-sync rotatable" class="rotatable"></i></button></div>'),Oe=f('<i class="las la-pause"></i>'),Re=e=>(()=>{const t=Me.cloneNode(!0),o=t.firstChild,a=o.nextSibling,r=a.nextSibling,i=r.nextSibling,n=i.nextSibling,s=n.nextSibling,f=s.firstChild;return l(o,"click",e.handlers.first,!0),l(a,"click",e.handlers.prev,!0),l(r,"click",e.handlers.togglePlay,!0),d(r,c(p,{get when(){return!he.playing},get fallback(){return Oe.cloneNode(!0)},get children(){return Te.cloneNode(!0)}})),l(i,"click",e.handlers.next,!0),l(n,"click",e.handlers.last,!0),l(s,"click",e.handlers.flip,!0),h((e=>{const t=he.playing?"PAUSE":"PLAY",o=he.boardConfig.flipped;return t!==e._v$&&g(r,"title",e._v$=t),o!==e._v$2&&f.classList.toggle("rotated",e._v$2=o),e}),{_v$:void 0,_v$2:void 0}),t})();s(["click"]);const We=e=>{if(null===e)return!1;try{return"https:"===new URL(e).protocol}catch{return!1}},He=f('<span class="info__rating"> (<!>)</span>'),je=f("<p></p>"),Ue=f("<p>Round </p>"),Ge=f("<a></a>"),qe=f('<div class="info"><div class="info__header"><div class="info__players"><div class="info__player"><div class="info__left"><button class="info__color info__color--white"></button></div><div class="info__right"><span class="info__score"></span></div></div><div class="info__player"><div class="info__left"><button class="info__color info__color--black"></button></div><div class="info__right"><span class="info__score"></span></div></div></div><div class="info__event"></div><div class="info__site"></div></div><div class="info__analyze"><button><i class="las la-vial"></i> </button></div></div>'),Xe=e=>{const[t,o]=y(!1);return(()=>{const a=qe.cloneNode(!0),r=a.firstChild,i=r.firstChild,n=i.firstChild,s=n.firstChild;s.firstChild;const l=s.nextSibling.firstChild,f=n.nextSibling.firstChild;f.firstChild;const u=f.nextSibling.firstChild,b=i.nextSibling,y=b.nextSibling,v=r.nextSibling.firstChild;return v.firstChild.nextSibling,d(s,c(p,{get when(){return!he.anonymous},fallback:"Anonymous",get children(){return[m((()=>he.game.header.WhitePretty))," "]}}),null),d(s,c(p,{get when(){return he.game.header.WhiteElo},get children(){const e=He.cloneNode(!0),t=e.firstChild.nextSibling;return t.nextSibling,d(e,(()=>he.game.header.WhiteElo),t),e}}),null),d(l,(()=>"1-0"===he.game.header.Result?"1":"0-1"===he.game.header.Result?"0":"1/2-1/2"===he.game.header.Result?"1/2":"")),d(f,c(p,{get when(){return!he.anonymous},fallback:"Anonymous",get children(){return[m((()=>he.game.header.BlackPretty))," "]}}),null),d(f,c(p,{get when(){return he.game.header.BlackElo},get children(){const e=He.cloneNode(!0),t=e.firstChild.nextSibling;return t.nextSibling,d(e,(()=>he.game.header.BlackElo),t),e}}),null),d(u,(()=>"1-0"===he.game.header.Result?"0":"0-1"===he.game.header.Result?"1":"1/2-1/2"===he.game.header.Result?"1/2":"")),d(b,c(p,{get when(){return he.game.header.Event},get children(){const e=je.cloneNode(!0);return d(e,(()=>he.game.header.Event)),e}}),null),d(b,c(p,{get when(){return he.game.header.Round},get children(){const e=Ue.cloneNode(!0);return e.firstChild,d(e,(()=>he.game.header.Round),null),e}}),null),d(y,c(p,{get when(){return he.game.header.Site},get children(){const e=je.cloneNode(!0);return d(e,c(p,{get when(){return!he.anonymous||!R(he.game.header.Site)},get children(){return c(p,{get when(){return We(he.game.header.Site)},get fallback(){return he.game.header.Site},get children(){const e=Ge.cloneNode(!0);return d(e,(()=>{var e;return null===(e=he.game.header.Site)||void 0===e?void 0:e.replace(/^https:\/\//,"")})),h((()=>{var t;return g(e,"href",null!==(t=he.game.header.Site)&&void 0!==t?t:"")})),e}})}})),e}}),null),d(y,c(p,{get when(){return he.game.header.DatePretty},get children(){const e=je.cloneNode(!0);return d(e,(()=>he.game.header.DatePretty)),e}}),null),v.$$click=async()=>{await e.handlers.openOnLichess()||(o(!0),setTimeout((()=>o(!1)),1e3))},d(v,(()=>t()?"Cannot import to lichess":"Analyze on Lichess"),null),h((()=>v.classList.toggle("btn--error",t()))),a})()};s(["click"]);const Je=e=>new Promise(((t,o)=>{const a=new FileReader;a.onload=()=>{t(a.result)},a.onerror=o,a.readAsText(e)}));const Ye=f('<button class="load__game-btn"><i class="las la-paste"></i> </button>'),Ke=f("<hr>"),Ve=f('<textarea class="load__game-input" name="load-game" placeholder="Paste PGN, FEN or Lichess link..."></textarea>'),Qe=f('<button class="load__game-btn"></button>'),Ze=f('<input type="file" accept="application/vnd.chess-pgn,application/x-chess-pgn,.pgn">'),et=f('<button class="load__pgn-btn load__pgn-file">Upload PGN file</button>'),tt=f('<div class="load__pgn-file-info"><p>or</p><p>drop the PGN file anywhere on the page</p></div>'),ot=e=>{const[t,o]=y(""),[a,r]=y(!1),[i,n]=y(!1);let s;return c(Fe,{get class(){return"load"+(e.class?` ${e.class}`:"")},get children(){return[(()=>{const t=Ye.cloneNode(!0);return t.firstChild.nextSibling,t.$$click=async()=>{await e.handlers.loadFromClipboard()||(r(!0),setTimeout((()=>r(!1)),1e3))},d(t,(()=>a()?"Incorrect data":"Load from clipboard"),null),h((()=>t.classList.toggle("btn--error",a()))),t})(),Ke.cloneNode(!0),(()=>{const e=Ve.cloneNode(!0);return e.$$input=e=>o(e.currentTarget.value),g(e,"spellcheck",!1),h((()=>e.value=t())),e})(),(()=>{const a=Qe.cloneNode(!0);return a.$$click=async()=>{await e.handlers.load(t())||(n(!0),setTimeout((()=>n(!1)),1e3)),o("")},d(a,(()=>i()?"Incorrect data":"LOAD")),h((()=>a.classList.toggle("btn--error",i()))),a})(),Ke.cloneNode(!0),(()=>{const t=Ze.cloneNode(!0);t.addEventListener("change",(async t=>{const o=t.target;if(null!=o&&o.files&&o.files.length>0){const t=await Je(o.files[0]);ge("refreshHash",!1),e.handlers.loadPGN(t)}}));return"function"==typeof s?s(t):s=t,t.style.setProperty("display","none"),t})(),(()=>{const e=et.cloneNode(!0);return e.$$click=()=>{s&&s.click()},e})(),c(p,{get when(){return!he.mobile},get children(){return tt.cloneNode(!0)}})]}})};s(["click","input"]);const at=(e,t,o)=>{const a="string"==typeof e?e:URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=`${t}.${o}`,r.target="_blank",r.click(),URL.revokeObjectURL(a)},rt=async e=>{const[t,o]=e.pathname.replace(/^\//,"").split("/").map((e=>e.trim()));if(/^(([a-z0-9]{8})|([a-z0-9]{12}))$/i.test(t)){const a=t.slice(0,8),r=await fetch(`https://lichess.org/game/export/${a}?evals=0&clocks=0`);if(!String(r.status).startsWith("2"))return{error:!0,errorType:"SERVER_ERROR"};return{error:!1,pgn:await r.text(),side:String(o).startsWith("black")||e.hash.startsWith("black")?"b":"w"}}return{error:!0,errorType:"INCORRECT_LINK"}},it={pgn:"",fen:"",side:"w",ply:0};let nt={...it};const st={set(e){if(e.fen)return nt={...it},nt.fen=e.fen,void(location.hash=`fen/${nt.fen.replace(/ /g,"_")}`);e.pgn&&(nt={...it},nt.pgn=P(e.pgn)),e.side&&(nt.side=e.side),void 0!==e.ply&&(nt.ply=e.ply),location.hash=`pgn/${nt.side}/${nt.ply}/${nt.pgn}`},get:()=>location.href,getFENLink:e=>`${location.origin}/#fen/${e.replace(/ /g,"_")}`,async read(){const e=new URL(location.href),[t,...o]=location.hash.split("/");if(/fen/.test(t))nt={...it},nt.fen=decodeURI(o.join("/")).replace(/_/g," ");else if(/pgn/.test(t)){const[e,t,...a]=o;nt.side=e,nt.ply=Number(t),nt.pgn=a.join("/"),nt.fen=""}else if(/lid/.test(t)){const[e,t,...a]=o;nt.side=e,nt.ply=Number(t);const r=await rt(new URL(`https://lichess.org/${a[0]}`));r.error?(nt.pgn="",nt.fen=""):(nt.pgn=P(N(r.pgn)),nt.fen="")}return{pgn:nt.pgn?A(nt.pgn):"",fen:nt.fen,side:nt.side,ply:nt.ply,boardStyle:e.searchParams.get("b"),piecesStyle:e.searchParams.get("p")}},entries:()=>({...nt})},lt=f('<div class="share__view"><h2 class="header--first">Board options</h2><button class="options__button" title="TOGGLE ANONYMOUS"><i class="las la-user-secret"></i></button><button class="options__button"><i class="las la-expand"></i></button><button class="options__button"><i class="las la-info-circle"></i></button><button class="options__button"><i class="las la-heading"></i></button><button class="options__button"><i class="las la-cloud"></i></button></div>'),dt=f("<hr>"),ct=f('<div class="share__fen"><h2>Current position</h2><input type="text" name="current_fen" readonly placeholder="Current FEN..."><div class="double"><button class="share__btn share__btn--left"></button><button class="share__btn share__btn--right"></button></div><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__btn"></button></div>'),ht=f('<div class="share__pgn"><h2>Game</h2><div class="double"><button class="share__btn"></button><button class="share__btn"></button></div><div class="double"><button class="share__btn">Export PGN</button><button class="share__btn"></button></div></div>'),gt=f('<div class="share__animation"><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__format share__format--first">GIF</button><button class="share__format">MP4</button><button class="share__format share__format--last">WebM</button><button class="share__create-animation"></button></div>'),pt=e=>{const[t,o]=y(""),[a,r]=y(!1),[i,n]=y(!1),s=e=>{o(e),setTimeout((()=>o("")),1e3)};return c(Fe,{get class(){return"share"+(e.class?` ${e.class}`:"")},get children(){return[(()=>{const t=lt.cloneNode(!0),o=t.firstChild.nextSibling,a=o.nextSibling,r=a.nextSibling,i=r.nextSibling,n=i.nextSibling;return l(o,"click",e.handlers.toggleAnonymous,!0),l(a,"click",e.handlers.toggleBorder,!0),l(r,"click",e.handlers.toggleExtraInfo,!0),l(i,"click",e.handlers.toggleTitleScreen,!0),l(n,"click",e.handlers.toggleShadows,!0),h((e=>{const t=he.anonymous,s=he.boardConfig.showBorder,l=he.boardConfig.showBorder?"HIDE BORDER":"SHOW BORDER",d=he.boardConfig.showExtraInfo,c=he.boardConfig.showExtraInfo?"HIDE EXTRA INFO":"SHOW EXTRA INFO",h=he.gameConfig.titleScreen,p=he.gameConfig.titleScreen?"EXCLUDE TITLE SCREEN":"INCLUDE TITLE SCREEN",f=he.boardConfig.showShadows,u=he.boardConfig.showShadows?"HIDE SHADOWS":"SHOW SHADOWS";return t!==e._v$&&o.classList.toggle("options__button--active",e._v$=t),s!==e._v$2&&a.classList.toggle("options__button--active",e._v$2=s),l!==e._v$3&&g(a,"title",e._v$3=l),d!==e._v$4&&r.classList.toggle("options__button--active",e._v$4=d),c!==e._v$5&&g(r,"title",e._v$5=c),h!==e._v$6&&i.classList.toggle("options__button--active",e._v$6=h),p!==e._v$7&&g(i,"title",e._v$7=p),f!==e._v$8&&n.classList.toggle("options__button--active",e._v$8=f),u!==e._v$9&&g(n,"title",e._v$9=u),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),t})(),dt.cloneNode(!0),(()=>{const o=ct.cloneNode(!0),i=o.firstChild.nextSibling,n=i.nextSibling,l=n.firstChild,c=l.nextSibling,g=n.nextSibling.nextSibling,p=g.nextSibling,f=p.nextSibling,u=f.nextSibling,m=u.nextSibling,b=m.nextSibling;return i.$$click=e=>{e.target.select()},l.$$click=()=>{navigator.clipboard.writeText(he.fen),s("fen")},d(l,(()=>"fen"===t()?"Copied!":"Copy FEN")),c.$$click=()=>{navigator.clipboard.writeText(st.getFENLink(he.fen)),s("fen-link")},d(c,(()=>"fen-link"===t()?"Copied!":"Copy link")),g.$$click=()=>ge("gameConfig","picSize","XS"),p.$$click=()=>ge("gameConfig","picSize","S"),f.$$click=()=>ge("gameConfig","picSize","M"),u.$$click=()=>ge("gameConfig","picSize","L"),m.$$click=()=>ge("gameConfig","picSize","XL"),b.$$click=async()=>{r(!0),await e.handlers.downloadImage(),r(!1)},d(b,(()=>a()?"Please wait...":"Save as image")),h((e=>{const t=he.fen,o="XS"===he.gameConfig.picSize,a="S"===he.gameConfig.picSize,r="M"===he.gameConfig.picSize,n="L"===he.gameConfig.picSize,s="XL"===he.gameConfig.picSize;return t!==e._v$10&&(i.value=e._v$10=t),o!==e._v$11&&g.classList.toggle("share__size--active",e._v$11=o),a!==e._v$12&&p.classList.toggle("share__size--active",e._v$12=a),r!==e._v$13&&f.classList.toggle("share__size--active",e._v$13=r),n!==e._v$14&&u.classList.toggle("share__size--active",e._v$14=n),s!==e._v$15&&m.classList.toggle("share__size--active",e._v$15=s),e}),{_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),o})(),c(p,{get when(){return he.pgn},get children(){return[dt.cloneNode(!0),(()=>{const e=ht.cloneNode(!0),o=e.firstChild.nextSibling,a=o.firstChild,r=a.nextSibling,i=o.nextSibling.firstChild,n=i.nextSibling;return a.$$click=()=>{navigator.clipboard.writeText(he.anonymous?he.game.anonymousPGN:he.pgn),s("pgn")},d(a,(()=>"pgn"===t()?"Copied!":"Copy PGN")),r.$$click=()=>{navigator.clipboard.writeText(window.location.href),s("pgn-link")},d(r,(()=>"pgn-link"===t()?"Copied!":"Copy link")),i.$$click=()=>{const e=new Blob([he.pgn],{type:"application/vnd.chess-pgn;charset=utf-8"}),t=he.game.getFileName(he.anonymous);at(e,t,"pgn")},n.$$click=()=>{const e=`[${he.game.getTitle({anonymous:he.anonymous})}](${window.location.href})`;navigator.clipboard.writeText(e),s("markdown")},d(n,(()=>"markdown"===t()?"Copied!":"Copy markdown")),e})(),(()=>{const t=gt.cloneNode(!0),o=t.firstChild.nextSibling,a=o.nextSibling,r=a.nextSibling,s=r.nextSibling,l=s.nextSibling,c=l.nextSibling,g=c.nextSibling,p=g.nextSibling,f=p.nextSibling;return o.$$click=()=>ge("gameConfig","animationSize","XS"),a.$$click=()=>ge("gameConfig","animationSize","S"),r.$$click=()=>ge("gameConfig","animationSize","M"),s.$$click=()=>ge("gameConfig","animationSize","L"),l.$$click=()=>ge("gameConfig","animationSize","XL"),c.$$click=()=>ge("gameConfig","format","GIF"),g.$$click=()=>ge("gameConfig","format","MP4"),p.$$click=()=>ge("gameConfig","format","WebM"),f.$$click=async()=>{n(!0),await e.handlers.downloadAnimation(),n(!1)},d(f,(()=>i()?"Please wait...":"Save animation")),h((e=>{const t="XS"===he.gameConfig.animationSize,i="S"===he.gameConfig.animationSize,n="M"===he.gameConfig.animationSize,d="L"===he.gameConfig.animationSize,h="XL"===he.gameConfig.animationSize,f="GIF"===he.gameConfig.format,u="MP4"===he.gameConfig.format,m="WebM"===he.gameConfig.format;return t!==e._v$16&&o.classList.toggle("share__size--active",e._v$16=t),i!==e._v$17&&a.classList.toggle("share__size--active",e._v$17=i),n!==e._v$18&&r.classList.toggle("share__size--active",e._v$18=n),d!==e._v$19&&s.classList.toggle("share__size--active",e._v$19=d),h!==e._v$20&&l.classList.toggle("share__size--active",e._v$20=h),f!==e._v$21&&c.classList.toggle("share__format--active",e._v$21=f),u!==e._v$22&&g.classList.toggle("share__format--active",e._v$22=u),m!==e._v$23&&p.classList.toggle("share__format--active",e._v$23=m),e}),{_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0,_v$20:void 0,_v$21:void 0,_v$22:void 0,_v$23:void 0}),t})()]}})]}})};s(["click"]);const ft=f("<div></div>"),ut=e=>{const[t,o]=y([]);return(async()=>{const e=[],t=new _e({size:144,tiles:2,showBorder:!0,showExtraInfo:!1});t.setBorderScale(3);for(const[o,a]of Object.entries(oe)){let r;a.ico?r=a.ico:(await t.updateConfig({boardStyle:o}),await t.frame(null),t.render(),r=t.toImgUrl()),e.push({key:o,img:r})}return e})().then((e=>o(e))),c(Fe,{get class(){return"boards"+(e.class?` ${e.class}`:"")},get children(){return c(b,{get each(){return t()},children:t=>(()=>{const o=ft.cloneNode(!0);return o.$$click=()=>{ge("boardConfig","boardStyle",t.key),e.handlers.changeBoardStyle(t.key)},g(o,"draggable",!1),h((e=>{const a="boards__ico"+(he.boardConfig.boardStyle===t.key?" boards__ico--active":""),r=`url(${t.img})`,i=t.key;return a!==e._v$&&(o.className=e._v$=a),r!==e._v$2&&o.style.setProperty("background-image",e._v$2=r),i!==e._v$3&&g(o,"title",e._v$3=i),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),o})()})}})};s(["click"]);const mt=f("<img>"),bt=re.map((e=>({key:e,img:`/pieces/${e}/nw.svg`}))),yt=e=>c(Fe,{get class(){return"pieces"+(e.class?` ${e.class}`:"")},get children(){return c(b,{each:bt,children:t=>(()=>{const o=mt.cloneNode(!0);return o.$$click=()=>{ge("boardConfig","piecesStyle",t.key),e.handlers.changePiecesStyle(t.key)},g(o,"draggable",!1),h((e=>{const a="pieces__ico"+(he.boardConfig.piecesStyle===t.key?" pieces__ico--active":""),r=t.img,i=t.key;return a!==e._v$&&(o.className=e._v$=a),r!==e._v$2&&g(o,"src",e._v$2=r),i!==e._v$3&&g(o,"title",e._v$3=i),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),o})()})}});s(["click"]);const vt=f("<button></button>"),_t=e=>(()=>{const t=vt.cloneNode(!0);return t.$$click=()=>e.setTab(e.name),d(t,(()=>e.children)),h((()=>t.className="tab"+(e.isActive?" tab--active":""))),t})();s(["click"]);const wt=f('<i class="las la-chess-board"></i>'),kt=f('<i class="las la-chess"></i>'),St=f('<div class="game"><div class="game-tabs"></div></div>'),xt=e=>{ge("activeTab",e)},Ct=e=>(()=>{const t=St.cloneNode(!0),o=t.firstChild;return d(o,c(_t,{name:"game",setTab:xt,get isActive(){return"game"===he.activeTab},children:"GAME"}),null),d(o,c(_t,{name:"load",setTab:xt,get isActive(){return"load"===he.activeTab},children:"LOAD"}),null),d(o,c(p,{get when(){return"triple"!==he.layout},get children(){return[c(_t,{name:"share",setTab:xt,get isActive(){return"share"===he.activeTab},children:"SHARE"}),c(_t,{name:"boards",setTab:xt,get isActive(){return"boards"===he.activeTab},get children(){return wt.cloneNode(!0)}}),c(_t,{name:"pieces",setTab:xt,get isActive(){return"pieces"===he.activeTab},get children(){return kt.cloneNode(!0)}})]}}),null),d(t,c(_,{get children(){return[c(v,{get when(){return"game"===he.activeTab},get children(){return[c(Xe,{get handlers(){return e.handlers}}),c(Ae,{get moves(){return e.moves},get handlers(){return e.handlers},get class(){return"single"===he.layout?"span2":void 0}}),c(p,{get when(){return"single"!==he.layout},get children(){return c(Re,{get handlers(){return e.handlers}})}})]}}),c(v,{get when(){return"load"===he.activeTab},get children(){return c(ot,{get handlers(){return e.handlers},class:"span3"})}}),c(p,{get when(){return"triple"!==he.layout},get children(){return[c(v,{get when(){return"share"===he.activeTab},get children(){return c(pt,{get handlers(){return e.handlers},class:"span3"})}}),c(v,{get when(){return"boards"===he.activeTab},get children(){return c(ut,{get handlers(){return e.handlers},class:"span3"})}}),c(v,{get when(){return"pieces"===he.activeTab},get children(){return c(yt,{get handlers(){return e.handlers},class:"span3"})}})]}})]}}),null),h((()=>o.classList.toggle("game-tabs--condensed","triple"!==he.layout))),t})();const $t=f('<i class="las la-share"></i>'),Bt=f('<i class="las la-chess-board"></i>'),Et=f('<i class="las la-chess"></i>'),Dt=f('<div class="setup"><div class="setup-tabs"></div></div>'),Lt=e=>{const[t,o]=y("share");return(()=>{const a=Dt.cloneNode(!0),r=a.firstChild;return d(r,c(_t,{name:"share",setTab:o,get isActive(){return"share"===t()},get children(){return[$t.cloneNode(!0)," SHARE"]}}),null),d(r,c(_t,{name:"boards",setTab:o,get isActive(){return"boards"===t()},get children(){return[Bt.cloneNode(!0)," BOARDS"]}}),null),d(r,c(_t,{name:"pieces",setTab:o,get isActive(){return"pieces"===t()},get children(){return[Et.cloneNode(!0)," PIECES"]}}),null),d(a,c(_,{get children(){return[c(v,{get when(){return"share"===t()},get children(){return c(pt,{get handlers(){return e.handlers}})}}),c(v,{get when(){return"boards"===t()},get children(){return c(ut,{get handlers(){return e.handlers}})}}),c(v,{get when(){return"pieces"===t()},get children(){return c(yt,{get handlers(){return e.handlers}})}})]}}),null),a})()};const zt=f('<div class="popup"><div class="popup__box"><button class="popup__close"><i class="las la-times"></i></button><h2 class="popup__title"></h2><div class="popup__content"></div></div></div>'),It=e=>(()=>{const t=zt.cloneNode(!0),o=t.firstChild.firstChild,a=o.nextSibling,r=a.nextSibling;return l(o,"click",e.onClose,!0),d(a,(()=>e.title)),d(r,(()=>e.children)),t})();s(["click"]);const Ft=e=>{switch(e){case"board":localStorage.setItem("boardConfig",JSON.stringify(he.boardConfig));break;case"game":localStorage.setItem("gameConfig",JSON.stringify(he.gameConfig));break;case"site":localStorage.setItem("siteConfig",JSON.stringify(he.siteConfig));break;case"recent":localStorage.setItem("recent",JSON.stringify(he.recent))}},Nt=f("<p>Saving files may not work correctly in this browser.</p>"),Pt=f("<p>To enjoy the full functionality of the website, please open it in <u><b>Safari</b></u>.</p>"),At=()=>c(p,{get when(){var e;return!he.siteConfig.iOSAppPopup&&he.siteConfig.wrongBrowserPopup&&"iOS"===he.os&&!(null!==(e=he.browser)&&void 0!==e&&e.includes("Safari"))},get children(){return c(It,{onClose:()=>{ge("siteConfig","wrongBrowserPopup",!1),Ft("site")},title:"Note",get children(){return[Nt.cloneNode(!0),Pt.cloneNode(!0)]}})}}),Tt=f("<p>For easy access, you can install this website as a standalone app.</p>"),Mt=f("<ul>To do that:<li>open the website in Chrome,</li><li>tap the menu icon (3 dots in the corner),</li><li>tap <u><b>Add to Home screen</b></u>.</li></ul>"),Ot=()=>c(p,{get when(){var e;return he.siteConfig.androidAppPopup&&(null===(e=he.os)||void 0===e?void 0:e.includes("Android"))},get children(){return c(It,{onClose:()=>{ge("siteConfig","androidAppPopup",!1),Ft("site")},title:"Tip",get children(){return[Tt.cloneNode(!0),Mt.cloneNode(!0)]}})}}),Rt=f("<p>For easy access, you can install this website as a standalone app.</p>"),Wt=f("<ul>To do that:<li>open the website in Safari,</li><li>tap the Share icon,</li><li>tap <u><b>Add to Home Screen</b></u>.</li></ul>"),Ht=()=>c(p,{get when(){var e;return he.siteConfig.iOSAppPopup&&(null===(e=he.os)||void 0===e?void 0:e.includes("iOS"))},get children(){return c(It,{onClose:()=>{ge("siteConfig","iOSAppPopup",!1),Ft("site")},title:"Tip",get children(){return[Rt.cloneNode(!0),Wt.cloneNode(!0)]}})}});const jt=f("<hr>"),Ut=f("<h2>Keyboard Shortcuts</h2>"),Gt=f('<div class="about__shortcuts"><ul><li><kbd>→</kbd> Next move</li><li><kbd>←</kbd> Previous move</li><li><kbd>↑</kbd> Start position</li><li><kbd>↓</kbd> Final position</li><li><kbd>f</kbd> Flip the board</li><li><kbd>Space</kbd> Play / Pause</li><li><kbd>Enter</kbd> Analyze on Lichess</li></ul><ul><li><kbd>l</kbd> Load from clipboard</li><li><kbd>a</kbd> Toggle anonymous</li><li><kbd>b</kbd> Toggle border</li><li><kbd>i</kbd> Toggle extra info</li><li><kbd>h</kbd> Toggle header (title screen)</li><li><kbd>s</kbd> Toggle shadows</li></ul></div>'),qt=f('<div class="about"><div class="about__box"><button class="about__close"><i class="las la-times"></i></button><div class="about__content"><h2>About</h2><p><b>ShareChess</b> is a free, open source website that allows you to share chess games as self-contained replay links (the whole game is stored in the url without the need for a database), PNG images, or GIF / MP4 / WebM animations.</p><p>The website provides a high variety of chessboard and piece designs to serve as an open alternative for commercial chess GIF makers.</p><p>You can find the complete source code on our <a href="https://github.com/sharechess/sharechess">GitHub page</a>.</p></div></div></div>'),Xt=()=>c(p,{get when(){return he.about},get children(){const e=qt.cloneNode(!0),t=e.firstChild.firstChild,o=t.nextSibling;return o.firstChild.nextSibling.nextSibling.nextSibling,t.$$click=()=>ge("about",!he.about),d(o,c(p,{get when(){return!he.mobile},get children(){return[jt.cloneNode(!0),Ut.cloneNode(!0),Gt.cloneNode(!0)]}}),null),e}});s(["click"]);const Jt=f('<div id="setup" class="setup-box"></div>'),Yt=f('<div><div class="layout"><div id="board" class="board-box"><canvas class="board" id="canvas"></canvas></div><div id="moves" class="game-box"></div></div></div>'),Kt=e=>(()=>{const t=Yt.cloneNode(!0),o=t.firstChild,a=o.firstChild;a.firstChild;const r=a.nextSibling;return d(t,c(ze,{get handlers(){return e.handlers}}),o),d(o,c(p,{get when(){return"triple"===he.layout},get children(){const t=Jt.cloneNode(!0);return d(t,c(Lt,{get handlers(){return e.handlers}})),t}}),a),d(a,c(p,{get when(){return"single"===he.layout},get children(){return c(Re,{get handlers(){return e.handlers}})}}),null),d(r,c(Ct,{get moves(){return e.state.moves},get handlers(){return e.handlers}})),d(t,c(Xt,{}),null),d(t,c(At,{}),null),d(t,c(Ot,{}),null),d(t,c(Ht,{}),null),h((e=>{const o=!he.siteConfig.darkMode,r="double"===he.layout;return o!==e._v$&&t.classList.toggle("light",e._v$=o),r!==e._v$2&&a.classList.toggle("board-box--left",e._v$2=r),e}),{_v$:void 0,_v$2:void 0}),t})(),Vt={XS:360,S:512,M:720,L:1024,XL:1440};class Qt{constructor(t,o,a,r=1e3){e(this,"gif",void 0),e(this,"frameTime",void 0),this.gif=new w({workers:2,quality:30,width:t,height:o,repeat:a?0:-1}),this.frameTime=r}add(e,t){for(;t--;)this.gif.addFrame(e,{delay:this.frameTime})}render(){return new Promise((e=>{const t=Date.now();this.gif.on("finished",(function(o){const a=new File([o],`board_${t}.gif`,{type:"image/gif",lastModified:t});e(a)})),this.gif.render()}))}}class Zt{constructor(t=1e3){e(this,"video",void 0),this.frameTime=t,this.video=new k({quality:.8,fileWriter:null,fd:null,frameDuration:1e3,transparent:!1})}add(e,t){this.video.addFrame(e,t*this.frameTime)}async render(){const e=await this.video.complete(),t=Date.now();return new File([e],`board_${t}.webm`,{type:"video/webm",lastModified:t})}}class eo{constructor(t,o,a=1e3){e(this,"hme",void 0),e(this,"encoder",null),e(this,"frameTime",void 0),this.width=t,this.height=o,this.hme=S.createH264MP4Encoder(),this.frameTime=a}async setup(e,t){this.encoder=await this.hme,this.encoder.width=e,this.encoder.height=t,this.encoder.frameRate=1e3/this.frameTime,this.encoder.quantizationParameter=10,this.encoder.initialize()}async add(e,t){for(null===this.encoder&&await this.setup(this.width,this.height);t--;){var o;null===(o=this.encoder)||void 0===o||o.addFrameRgba(e)}}async render(){var e,t,o;null===(e=this.encoder)||void 0===e||e.finalize();const a=null===(t=this.encoder)||void 0===t?void 0:t.FS.readFile(this.encoder.outputFilename),r=Date.now(),i=new File([a],`board_${r}.mp4`,{type:"video/mp4",lastModified:r});return null===(o=this.encoder)||void 0===o||o.delete(),i}}const to=(e,t)=>t instanceof Qt?e.toImageData():t instanceof eo?e.toClampedArray():e.canvas,oo=/^([1-8kqrbnp]+\/)+[1-8kqrbnp]+ [wb] ([kq]+|-) ([a-h1-8]{2}|-) \d+ \d+$/i,ao=/((\[[a-z0-9]+ +"[^"\n\r]+"](\r\n|\r|\n))*(\r\n|\r|\n)+){0,1}\d+\. *[a-h1-8x+#=]+/i,ro=(e,t)=>({prev(){e.pause(),e.prev()},next(){e.pause(),e.next()},first(){e.pause(),e.first()},last(){e.pause(),e.last()},togglePlay(){e.playing?e.pause():e.play()},goto(t){e.pause(),e.goto(t)},toggleBorder(){t.toggleBorder(),ge("boardConfig","showBorder",!he.boardConfig.showBorder),Ft("board")},showBorder(){t.showBorder(),ge("boardConfig","showBorder",!0),Ft("board")},hideBorder(){t.hideBorder(),ge("boardConfig","showBorder",!1),Ft("board")},toggleExtraInfo(){t.toggleExtraInfo(),ge("boardConfig","showExtraInfo",!he.boardConfig.showExtraInfo),Ft("board")},toggleAnonymous(){if(ge("anonymous",!he.anonymous),t.anonymous=he.anonymous,""!==he.pgn){const e=he.anonymous?he.game.anonymousPGN:he.game.pgn;st.set({pgn:e}),ge("refreshHash",!1)}},toggleTitleScreen(){ge("gameConfig","titleScreen",!he.gameConfig.titleScreen),Ft("game")},toggleShadows(){t.toggleShadows(),ge("boardConfig","showShadows",!he.boardConfig.showShadows),Ft("board")},flip(){t.flip(),ge("boardConfig","flipped",!he.boardConfig.flipped),ge("refreshHash",!1),st.set({side:he.boardConfig.flipped?"b":"w"})},changeBoardStyle(e){t.setStyle(e),ge("boardConfig","boardStyle",e),Ft("board")},changePiecesStyle(e){t.setPiecesStyle(e),ge("boardConfig","piecesStyle",e),Ft("board")},async loadPGN(o,a="w",r=0){const i=(new j).loadPGN(o);ge({pgn:i.pgn,fen:"",moves:i.getMoves(),ply:0,game:i}),st.set({pgn:i.pgn,side:a,ply:r}),await e.load(i),ge("activeTab","game"),"w"===a?t.flipWhite():t.flipBlack(),ge("boardConfig","flipped","b"===a),document.title=`ShareChess - ${i.getTitle({anonymous:!1})}`},async loadFEN(o,a=!0){const r=(new j).loadFEN(o);ge({pgn:"",fen:o,moves:r.getMoves(),ply:0,game:r}),await e.load(r),a&&(st.set({fen:he.fen}),ge("activeTab","game"));const i=r.getPosition(0).turn;"w"===i?t.flipWhite():t.flipBlack(),ge("boardConfig","flipped","b"===i),document.title=`ShareChess - FEN ${o}`},async load(e){return ge("refreshHash",!1),(e=>oo.test(e.trim()))(e)?(await this.loadFEN(e),!0):(e=>ao.test(e))(e)?(await this.loadPGN(e),!0):!!We(e)&&(await this.importPGN(e),!0)},async loadFromClipboard(){const e=await navigator.clipboard.readText();return this.load(e)},async importPGN(e){const t=await(async e=>{let t;try{t=new URL(e)}catch{return{error:!0,errorType:"INCORRECT_LINK"}}return/^(www\.)*lichess\.org/.test(t.hostname)?rt(t):{error:!0,errorType:"INCORRECT_LINK"}})(e);t.error||await this.loadPGN(t.pgn,t.side)},async downloadImage(){await new Promise((e=>setTimeout(e,0)));const e=await(async(e,t,o=0,a,r)=>{const i=new j;t?i.loadPGN(t):i.loadFEN(e);const n=new _e({...a,size:Vt[r]}),s=i.getPosition(o);return await n.frame(s,i.header),n.render(),n.toImgUrl()})(he.fen,he.pgn,he.ply,he.boardConfig,he.gameConfig.picSize);at(e,`fen_${Date.now()}`,"png")},async downloadAnimation(){await new Promise((e=>setTimeout(e,0)));const e=await(async(e,t,o,a,r)=>{const i=(new j).loadPGN(e),n=new _e({...t,size:Vt[a]}),s="GIF"===o?new Qt(n.width,n.height,!0):"MP4"===o?new eo(n.width,n.height):new Zt,l=i.header;r&&(await n.titleFrame(l),n.render(),await s.add(to(n,s),4));for(let d=0;d<i.length;d++){const e=i.getPosition(d);await n.frame(e,l),n.render();const t=0===e.end?5:0!==e.ply||r?1:2;await s.add(to(n,s),t)}return await s.render()})(he.pgn,he.boardConfig,he.gameConfig.format,he.gameConfig.animationSize,he.gameConfig.titleScreen),t=he.game.getFileName(he.anonymous);at(e,t,he.gameConfig.format.toLowerCase())},toggleSound(){ge("siteConfig","sounds",!he.siteConfig.sounds),Ft("site")},toggleSpeech(){ge("siteConfig","speech",!he.siteConfig.speech),Ft("site")},toggleDarkMode(){ge("siteConfig","darkMode",!he.siteConfig.darkMode),Ft("site")},async openOnLichess(){if(""===he.pgn)return window.open(`https://lichess.org/analysis/${he.fen.replace(/\s+/g,"_")}`),!0;try{const e=await(async(e,t)=>{if(t&&/^https:\/\/lichess\.org\/.{8}/.test(t))return t;const o=new URLSearchParams({pgn:e}).toString();try{const e=await fetch("https://lichess.org/api/import",{headers:{"content-type":"application/x-www-form-urlencoded"},body:o,method:"POST"});if(200===e.status)return(await e.json()).url;throw new Error("Cannot import to lichess")}catch(a){throw new Error("Cannot import to lichess")}})(he.pgn,he.game.header.Site);return window.open(`${e}/${he.boardConfig.flipped?"black":""}`),!0}catch(e){return!1}}}),io=async(e,t,o)=>{ge("refreshHash",e);const{pgn:a,fen:r,side:i,ply:n,boardStyle:s,piecesStyle:l}=await st.read();await(a?t.loadPGN(a,i,n):r?t.loadFEN(r):t.loadFEN("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",!1)),0!==n&&t.goto(n),s&&Object.keys(oe).includes(s)&&(ge("boardConfig","boardStyle",s),o.setStyle(s)),l&&re.includes(l)&&(ge("boardConfig","piecesStyle",l),o.setPiecesStyle(l)),ge("refreshHash",!0)},no=async()=>{const e=new _e(he.boardConfig),t=new Ee(e,he.gameConfig);t.watch((e=>ge("playing",e)));const o=ro(t,e);x((()=>c(Kt,{handlers:o,state:he})),document.getElementById("root"));const a=document.getElementById("canvas");await e.setCanvas(a),await t.init(),await io(!1,o,e),((e,t)=>{if(document.addEventListener("dblclick",(function(e){e.preventDefault()})),window.addEventListener("resize",(()=>{ge("layout",window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple")})),window.addEventListener("hashchange",(()=>{he.refreshHash?io(!0,e,t):ge("refreshHash",!0)})),!he.mobile){const t={ArrowLeft:e.prev,ArrowRight:e.next,ArrowUp:e.first,ArrowDown:e.last,f:e.flip," ":e.togglePlay,Enter:e.openOnLichess,l:e.loadFromClipboard.bind(e),a:e.toggleAnonymous,b:e.toggleBorder,i:e.toggleExtraInfo,h:e.toggleTitleScreen,s:e.toggleShadows};document.addEventListener("keydown",(e=>{const o=e.target;t[e.key]&&"INPUT"!==(null==o?void 0:o.nodeName)&&"TEXTAREA"!==(null==o?void 0:o.nodeName)&&(e.preventDefault(),t[e.key]())}));const o=e=>{e.preventDefault(),e.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach((e=>{document.addEventListener(e,o,!1)})),document.addEventListener("drop",(async t=>{var o;if(null!==(o=t.dataTransfer)&&void 0!==o&&o.files&&t.dataTransfer.files.length>0){const o=await Je(t.dataTransfer.files[0]);ge("refreshHash",!1),e.loadPGN(o)}}))}})(o,e)};Promise.all([new Promise((e=>{window.speechSynthesis||e(null),speechSynthesis.getVoices().length>0?e(null):window.speechSynthesis.onvoiceschanged=e})).catch((()=>null))]).then((()=>no()))}}}))}();
