import{_ as Be,c as U,U as Ge,i as He,a as je,h as x,d as M,b as A,e as I,s as N,t as v,f as m,g as Ue,j as g,S as L,m as re,F as le,k as W,M as H,l as Ee,G as Xe,n as Ye,o as qe,W as Ke,r as Je}from"./vendor.9523cce0.js";const Ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}};Ve();const Qe={horizontal:[0,0,1,0],vertical:[0,0,0,1],"diagonal-top":[0,0,1,1],"diagonal-bottom":[0,1,1,0]},Ze=(o,e,t,a,n,s)=>{let i;if(e.dir==="radial"){const c=Math.sqrt((t/2)**2+(a/2)**2);i=o.createRadialGradient(n+t/2,s+a/2,c,n+t/2,s+a/2,0)}else{const[c,h,u,d]=Qe[e.dir];i=o.createLinearGradient(n+c*t,s+h*a,n+u*t,s+d*a)}const l=e.colors.length-1;return e.colors.forEach((c,h)=>{i.addColorStop(h/l,c)}),i},ce=o=>new Promise(e=>{const t=new Image;t.addEventListener("load",()=>e(t),{once:!0}),t.src=o}),Y=async(o,e,t,a,n,s,i=8)=>{if(s.type==="image"){const c=await ce(s.data.src);i<8?o.drawImage(c,0,0,c.width*(i/8),c.height*(i/8),a,n,e,t):o.drawImage(c,a,n,e,t);return}const l=await(s.type==="solid"?s.data.color:Ze(o,s.data,e,t,a,n));if(l===null)throw new Error("Cannot create canvas fill style");o.fillStyle=l,o.fillRect(a,n,e,t)},et=22,tt="Fira Mono",fe=(o,e,t,a,n=!1,s,i,l,c)=>{const h=i/1024;if(h<=.32)return;const u=et*h,d=6*h,_=4*h,k="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26".split(",").slice(0,a),b=n?k:k.reverse();o.font=`${u}px ${tt}`,o.textBaseline=l?"middle":"top",b.forEach((S,C)=>{o.fillStyle=s>0?e.onBorder:C%2===0?e.onLight:e.onDark;const f=l?s/2:d,$=(l?t*C+s+t/2:t*C+d)+c;o.textAlign=l?"center":"left",o.fillText(S,f,$)});const p="ABCDEFGHIJKLMNOPQRSTUWVXYZ".split("").slice(0,a),B=n?p.reverse():p;o.textBaseline=l?"middle":"bottom",B.forEach((S,C)=>{o.fillStyle=s>0?e.onBorder:C%2===0?e.onDark:e.onLight;const f=l?t*C+s+t/2:t*C+d,$=(l?i-s/2:i-_)+c;o.textAlign=l?"center":"left",o.fillText(S,f,$)})},ot=(o,e,t)=>{o=o/255,e=e/255,t=t/255;let a=Math.max(o,e,t),n=a-Math.min(o,e,t),s=1-Math.abs(a+a-n-1),i=n&&(a==o?(e-t)/n:a==e?2+(t-o)/n:4+(o-e)/n);return[60*(i<0?i+6:i),s?n/s:0,(a+a-n)/2]};let at=(o,e,t)=>{const a=e*Math.min(t,1-t),n=(s,i=(s+o/30)%12)=>t-a*Math.max(Math.min(i-3,9-i,1),-1);return"#"+[Math.round(n(0)*255),Math.round(n(8)*255),Math.round(n(4)*255)].map(s=>s.toString(16)).join("")};const ge=(o,e,t=0,a=0)=>{const[n,s,i]=Be(o.length===4?1:2,o.slice(1).split("")).map(d=>parseInt(d.join(""),16));let[l,c,h]=ot(n,s,i);const u=Math.abs(e);return l>=60&&l<240?(l+=e,l<60&&l>60-u?l=60:l>240&&l<240+u&&(l=240)):(l-=e,l>60&&l<60+u?l=60:l<240&&l>240-u&&(l=240)),l=l>360?l-360:l>0?l+360:l,c=Math.min(1,Math.max(0,c+t)),h=Math.min(1,Math.max(0,h+a)),at(l,c,h)},nt="abcdefghijklmnopqrstuwvxyz",ue=(o,e,t)=>{const a=nt.indexOf(o[0]),n=Number(o[1])-1;return[e?t-a-1:a,e?n:t-n-1]},rt=async(o,e,t,{dark:a,light:n,moveIndicator:s},i,l,c,h)=>{const[u,d]=ue(e.from,c,l),[_,k]=ue(e.to,c,l),[b,p,B,S]=[u,d,_,k].map($=>$*t+i);let C,f;if(s.type==="hueShift"){const $={type:"solid",data:{color:n.data.color?ge(n.data.color,s.data):"#00ff0055"}},w={type:"solid",data:{color:a.data.color?ge(a.data.color,s.data):"#00ff0055"}};C=(u+d)%2===0?$:w,f=(_+k)%2===0?$:w}else C={type:"solid",data:{color:s.data}},f=C;Y(o,t,t,b,p+h,C),Y(o,t,t,B,S+h,f)},de={Event:"E",Site:"S",Round:"N",White:"W",Black:"B",Date:"D",Result:"R",FEN:"F",WhiteElo:"WE",BlackElo:"BE"},Le=Object.keys(de),st=Object.fromEntries(Object.entries(de).map(([o,e])=>[e,o])),De=o=>{const e=new U.Chess;if(e.load_pgn(o),e.delete_comments(),!e.header().Result){const i=(o.trim().match(/(1-0)|(0-1)|(1\/2-1\/2)$/)||[])[0];i&&e.header("Result",i)}const t=Object.entries(e.header()),[a,n]=t.length>0?e.pgn().split(`

`):[void 0,e.pgn()];return[t.filter(([i,l])=>Le.includes(i)&&l!=="?").map(([i,l])=>`[${i} "${l}"]`).sort().join(`
`),n].join(`

`)},pe=o=>{const e=new U.Chess;e.load_pgn(o);const t=e.history().join(" "),a=Object.entries(e.header()).filter(([n])=>Le.includes(n)).map(([n,s])=>`${de[n]} ${s}`).sort().join(`
`);return btoa([a,t].join(`

`))},it=o=>{const[e,t]=atob(o).split(`

`);let a;const n=e.split(`
`).map(i=>{const[l,...c]=i.split(" "),h=c.join(" ");return l==="R"&&(a=h),`[${st[l]} "${h}"]`}).join(`
`),s=t.split(" ").map((i,l)=>l%2===0?`${l/2+1}. ${i}`:i).join(" ")+` ${a}`;return[n,s].join(`

`)},lt=["January","February","March","April","May","June","July","August","September","October","November","December"],ct=o=>{const[e,t,a]=o.split(".").map(Number),n=Number.isNaN(t)?null:lt[t-1],s=Number.isNaN(a)||n===null?null:a,i=Number.isNaN(e)?null:e;return n&&s&&i?`${n} ${s}, ${i}`:n&&i?`${n} ${i}`:i?String(i):""},me=o=>o.split(",").map(e=>e.trim()).reverse().join(" "),te=o=>{if(o===null)return!1;try{return new URL(o),!0}catch{return!1}},dt=new Map([["q",9],["r",5],["b",3],["n",3],["p",1]]),z=(o,e=null)=>!o||o==="?"?e:o;class q{positions=[];game=new U.Chess;constructor(){}loadPGN(e){const t=new U.Chess,a=new U.Chess;t.load_pgn(De(e)),t.delete_comments();const n=t.history({verbose:!0}),s=t.header().FEN;return s&&a.load(s),this.positions=[{ply:0,move:null,end:n.length,fen:a.fen(),check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(a.fen()),last:n.length===0}],n.forEach((i,l)=>{a.move(i);const c=a.fen();this.positions.push({ply:l+1,move:i,end:n.length-1-l,fen:c,check:a.in_check(),mate:a.in_checkmate(),turn:a.turn(),material:this.materialInfo(a.board()),placement:this.getPlacement(c),last:l===n.length-1})}),this.game=t,this}loadFEN(e){return this.game=new U.Chess(e),this.positions=[{ply:0,move:null,end:0,fen:e,check:this.game.in_check(),mate:this.game.in_checkmate(),turn:this.game.turn(),material:this.materialInfo(this.game.board()),placement:this.getPlacement(this.game.fen()),last:!0}],this}getPlacement(e){const t=new U.Chess(e).board(),a=[];for(let n=0;n<8;n++)for(let s=0;s<8;s++)if(t[n][s]!==null){const{type:i,color:l}=t[n][s];a.push({x:s,y:n,type:i,color:l})}return a}materialInfo(e){const t=e.flat().filter(Boolean),a={w:0,b:0},n={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}},s={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}};for(const i of t)if(i!==null&&i.type!=="k"){a[i.color]+=dt.get(i.type)??0,s[i.color][i.type]+=1;const l=i.color==="b"?"w":"b";n[l][i.type]===0?n[i.color][i.type]+=1:n[l][i.type]-=1}return{sum:a,imbalance:n,count:s,diff:a.w-a.b}}get length(){return this.positions.length}get header(){const e=this.game.header(),t=z(e.White,"Anonymous"),a=z(e.Black,"Anonymous"),n=z(e.Date);return{White:t,Black:a,WhitePretty:me(t),BlackPretty:me(a),WhiteElo:z(e.WhiteElo),BlackElo:z(e.BlackElo),Date:n,DatePretty:n===null?null:ct(n),Event:z(e.Event),Round:z(e.Round),Site:z(e.Site),Result:z(e.Result)}}getTitle({anonymous:e}){const t=this.header,a=e?"Anonymous":t.WhitePretty,n=e?"Anonymous":t.BlackPretty;return`${a} vs ${n}`+(t.Event?` | ${t.Event}`:"")+(t.Round?`, Round ${t.Round}`:"")+(t.DatePretty?` | ${t.DatePretty}`:"")}getFileName(e){const t=this.header,a=e?"Anonymous":t.WhitePretty,n=e?"Anonymous":t.BlackPretty;return((t.Date?`${t.Date.replace(/\?/g,"X").replace(/\./g,"-")}_`:"")+`${a}_${n}`+(t.Event?`_${t.Event}`:"")+(t.Round?`_R${t.Round}`:"")).replace(/\s+/g,"-")}get pgn(){return this.game.pgn()}get anonymousPGN(){const e=this.game.pgn().replace(/\[White .+\]/,'[White "Anonymous"]').replace(/\[Black .+\]/,'[Black "Anonymous"]');return te(this.header.Site)?e.replace(/\[Site .+\]/,'[Site "?"]'):e}getPosition(e){return this.positions[e]??null}getMoves(){return this.positions.slice(1).map(({move:e})=>e?.san)}}const ht=()=>{const o=localStorage.getItem("boardConfig"),e=localStorage.getItem("gameConfig"),t=localStorage.getItem("siteConfig");return{boardConfig:o===null?{}:JSON.parse(o),gameConfig:e===null?{}:JSON.parse(e),siteConfig:t===null?{}:JSON.parse(t)}},ye=Ge(),Pe=He(),ae=ht(),ft={size:1024,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!Pe,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},gt={titleScreen:!0,format:"GIF",picSize:"M",animationSize:"M"},ut={darkMode:!0,sounds:!0,speech:!1,wrongBrowserPopup:!0,androidAppPopup:!0,iOSAppPopup:!0},pt={boardConfig:{...ft,...ae.boardConfig},gameConfig:{...gt,...ae.gameConfig},siteConfig:{...ut,...ae.siteConfig},game:new q,pgn:"",fen:"",moves:[],ply:0,mobile:Pe,layout:window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple",activeTab:"load",playing:!1,anonymous:!1,refreshHash:!0,browser:ye.browser.name,os:ye.os.name,about:!1},[r,y]=je(pt),mt=["adventurer","alfonso_x","alpha","anarchy","berlin","california","cardinal","cases","cburnett","chess7","chessnut","companion","condal","dubrovny","fantasy","fresca","gioco","governor","harlequin","horsey","icpieces","kingdom","kosal","leipzig","letter","line","lucena","maestro","magnetic","mark","marroquin","maya","mediaeval","merida","millennia","motif","pirat","pirouetti","pixel","regular","reillycraig","riohacha","shapes","smart","spatial","staunty","tatiana","tfb","traveller","utrecht","wisdom"],yt=["bb","bw","kb","kw","nb","nw","pb","pw","qb","qw","rb","rw"];let be=null,ve=new Map;const bt={async load(o){await Promise.all(yt.map(e=>{const t=`/pieces/${o}/${e}.svg`;return ce(t).then(a=>{ve.set(e,a)})}))},async get(o,e,t){be!==o&&(await this.load(o),be=o);const a=`${e}${t}`;return ve.get(a)}},vt=async(o,e,t,a,n,s,i,l=!0)=>{const{placement:c,check:h,mate:u,turn:d}=e;o.shadowColor="rgba(0, 0, 0, 0)",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;for(const{x:_,y:k,type:b,color:p}of c){const B=await bt.get(i,b,p),S=n?8-1-k:k,C=n?8-1-_:_;if((h||u)&&b==="k"&&p===d){const f=u?"#ff002f":"#ffa600";o.shadowColor=f,o.shadowBlur=t*(r.mobile,.15),o.shadowOffsetX=0,o.shadowOffsetY=0,o.drawImage(B,a+C*t,a+S*t+s,t,t)}else l&&(o.shadowColor="rgba(0, 0, 0, 0.5)",o.shadowOffsetX=t*.07,o.shadowOffsetY=t*.07,o.shadowBlur=t*.1);o.drawImage(B,a+C*t,a+S*t+s,t,t),o.shadowColor="rgba(0, 0, 0, 0)",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0}},T=(o,e,t,a,n,s,i,l,c)=>(o.font=`${n} ${a}px ${t}`,o.textAlign=l,o.textBaseline="middle",o.fillText(e,s,i,c),Math.ceil(o.measureText(e).width)),_t=async(o,e,t,a,n,s)=>{o.clearRect(0,0,e,e),await Y(o,e,e+a*2,0,0,n.border);const i="Ubuntu",l=[{key:"WhitePretty",line:60*t,fontSize:42*t,n:0},{key:"BlackPretty",line:60*t,fontSize:42*t,n:2},{key:"Event",line:30*t,fontSize:20*t,n:4},{key:"Round",line:30*t,fontSize:20*t,n:5},{key:"DatePretty",line:30*t,fontSize:20*t,n:7},{key:"Site",line:30*t,fontSize:20*t,n:8}],c=new Set(Object.keys(s)),h=l.filter(({key:b})=>c.has(b));if(s.WhitePretty&&s.BlackPretty&&h.push({key:"vs",line:50*t,fontSize:20*t,n:1}),(s.Event||s.Round)&&h.push({key:"margin",line:100*t,fontSize:0,n:3}),s.Date||s.Site){const b=s.Event||s.Round?20*t:100*t;h.push({key:"margin",line:b,fontSize:0,n:6})}const u=h.reduce((b,p)=>b+p.line,0);let d=(e+a*2-u)/2;o.fillStyle=n.coords.onBorder,h.sort((b,p)=>b.n-p.n).forEach(({key:b,line:p,fontSize:B})=>{if(b==="vs"){const C=d+p/2;T(o,"vs",i,B,700,e/2,C,"center"),d+=p;return}if(b==="margin"){d+=p;return}const S=s[b];if(S){const C=b==="Round"?`Round ${S}`:S,f=d+p/2;T(o,C,i,B,700,e/2,f,"center",e*.9)}d+=p});const _=await ce("/img/logo-full.svg"),k=e*.114*.5;o.shadowColor="rgba(0, 0, 0, 1)",o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=10*t,o.drawImage(_,e/4,a+e+a-k*2,e/2,k),o.shadowColor="rgba(0, 0, 0, 0)",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0},_e={k:"l",q:"w",r:"t",b:"n",n:"j",p:"o"},$t=async(o,e,t,a,n,s,i,l,c)=>{const h=Math.round(20*a);let u=(n-h)/2,d=n/2;const _=u;o.fillStyle=s.coords.onBorder;{const f=T(o,i.White==="Anonymous"?"White":i.White,"Ubuntu",h,700,_,l?d:t-d,"left"),$=i.WhiteElo?` ${i.WhiteElo}`:"";T(o,$,"Fira Mono",h,500,_+f,l?d:t-d,"left")}{const f=T(o,i.Black==="Anonymous"?"Black":i.Black,"Ubuntu",h,700,_,l?t-d:d,"left"),$=i.BlackElo?` ${i.BlackElo}`:"";T(o,$,"Fira Mono",h,500,_+f,l?t-d:d,"left")}let k=0,b=0;if(c.last&&i.Result){const[f,$]=i.Result.split("-"),w=f==="0"?"Lost":f==="1"?"Won":"Draw",P=$==="0"?"Lost":$==="1"?"Won":"Draw",R=T(o,w,"Ubuntu",h,700,e-u,l?d:t-d,"right"),O=T(o,P,"Ubuntu",h,700,e-u,l?t-d:d,"right"),G=Math.max(R,O);k=G+20*a,b=G+20*a}const{diff:p,imbalance:B}=c.material,S=p>0?`+${Math.abs(p)}`:"";k+=T(o,S,"Fira Mono",h,500,e-u-k,l?d:t-d,"right");const C=p<0?`+${Math.abs(p)}`:"";b+=T(o,C,"Fira Mono",h,500,e-u-b,l?t-d:d,"right");for(const[f,$]of Object.entries(B.w))for(let w=0;w<$;w++){const P=T(o,_e[f],"Chess",h,500,e-u-k,(l?d:t-d)-2*a,"right");k+=w===$-1?P*.85:f==="p"?P*.4:P*.6}for(const[f,$]of Object.entries(B.b))for(let w=0;w<$;w++){const P=T(o,_e[f],"Chess",h,500,e-u-b,(l?t-d:d)-2*a,"right");b+=w===$-1?P*.85:f==="p"?P*.4:P*.6}},wt={name:"Standard",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#00ad88"}},light:{type:"solid",data:{color:"#9EE0BC"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#00735a"}},coords:{onLight:"#00735a",onDark:"#d4fff5",onBorder:"#bbfaec"}},kt={name:"Spring",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#6BB53E"}},light:{type:"solid",data:{color:"#C1D997"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"solid",data:{color:"#40761E"}},coords:{onLight:"#40761E",onDark:"#DBF5AD",onBorder:"#DBF5AD"}},St={name:"Azure",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#277ECE"}},light:{type:"solid",data:{color:"#7DD3E2"}},moveIndicator:{type:"color",data:"#ff000044"},border:{type:"solid",data:{color:"#0F508C"}},coords:{onLight:"#0F508C",onDark:"#ACE3EC",onBorder:"#ACE3EC"}},Ct={name:"Clay",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#BF5344"}},light:{type:"solid",data:{color:"#D9B08F"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#793329"}},coords:{onLight:"#793329",onDark:"#F4C8A3",onBorder:"#F4C8A3"}},Bt={name:"Rock",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#949494"}},light:{type:"solid",data:{color:"#D4D4D4"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"solid",data:{color:"#595959"}},coords:{onLight:"#595959",onDark:"#EAEAEA",onBorder:"#EAEAEA"}},Et={name:"Danny",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#769656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312e2b"}},coords:{onLight:"#40522f",onDark:"#fcfce1",onBorder:"#eeeed2"}},Lt={name:"Danny Green",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569666"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#40ff007f"},border:{type:"solid",data:{color:"#2B312B"}},coords:{onLight:"#2F5238",onDark:"#fcfce1",onBorder:"#eeeed2"}},Dt={name:"Danny Cyan",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#569696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00ff807f"},border:{type:"solid",data:{color:"#2B3130"}},coords:{onLight:"#2F5152",onDark:"#fcfce1",onBorder:"#eeeed2"}},Pt={name:"Danny Blue",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#566696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#00bfff7f"},border:{type:"solid",data:{color:"#2B2E31"}},coords:{onLight:"#2F3752",onDark:"#fcfce1",onBorder:"#eeeed2"}},Nt={name:"Danny Purple",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#765696"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38af7f"},border:{type:"solid",data:{color:"#2D2B31"}},coords:{onLight:"#412F52b",onDark:"#fcfce1",onBorder:"#eeeed2"}},It={name:"Danny Pink",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965686"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ff38637f"},border:{type:"solid",data:{color:"#312B31"}},coords:{onLight:"#522F49",onDark:"#fcfce1",onBorder:"#eeeed2"}},xt={name:"Danny Red",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#965656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffaf387f"},border:{type:"solid",data:{color:"#312B2D"}},coords:{onLight:"#522F2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},At={name:"Danny Yellow",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#968656"}},light:{type:"solid",data:{color:"#eeeed2"}},moveIndicator:{type:"color",data:"#ffff007f"},border:{type:"solid",data:{color:"#312E2B"}},coords:{onLight:"#524A2F",onDark:"#fcfce1",onBorder:"#eeeed2"}},Ft={name:"Lichess",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b58863"}},light:{type:"solid",data:{color:"#f0d9b5"}},moveIndicator:{type:"hueShift",data:-40},border:{type:"solid",data:{color:"#80634d"}},coords:{onLight:"#9c6f49",onDark:"#f9f0e1",onBorder:"#f9f0e1"}},Tt={name:"Leko",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#919caf"}},light:{type:"solid",data:{color:"#c0c2d0"}},moveIndicator:{type:"hueShift",data:-90},border:{type:"solid",data:{color:"#58606e"}},coords:{onLight:"#58606e",onDark:"#dbe8ff",onBorder:"#dbe8ff"}},Mt={name:"Beige",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#93b092"}},light:{type:"solid",data:{color:"#becfc2"}},moveIndicator:{type:"hueShift",data:90},border:{type:"solid",data:{color:"#596e59"}},coords:{onLight:"#596e59",onDark:"#e4f5e4",onBorder:"#e4f5e4"}},Rt={name:"Lila",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#c0acb5"}},light:{type:"solid",data:{color:"#e5d0cb"}},moveIndicator:{type:"hueShift",data:-120},border:{type:"solid",data:{color:"#735c66"}},coords:{onLight:"#876b77",onDark:"#fff5f2",onBorder:"#e5d0cb"}},Ot={name:"Peach",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#E54B4B"}},light:{type:"solid",data:{color:"#EFB293"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#9E3131"}},coords:{onLight:"#e54b4b",onDark:"#EFB293",onBorder:"#EFB293"}},zt={name:"Violet",category:"solid",background:{type:"solid",data:{color:"#361b52"}},dark:{type:"solid",data:{color:"#7b4fa8"}},light:{type:"solid",data:{color:"#CB95CB"}},moveIndicator:{type:"hueShift",data:-60},border:{type:"solid",data:{color:"#50346e"}},coords:{onLight:"#50346e",onDark:"#eedeff",onBorder:"#e2c7ff"}},Wt={name:"Danya",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#4c7399"}},light:{type:"solid",data:{color:"#eae9d2"}},moveIndicator:{type:"color",data:"#00a5ff7f"},border:{type:"solid",data:{color:"#2a4057"}},coords:{onLight:"#2a4057",onDark:"#fffff0",onBorder:"#eae9d2"}},Gt={name:"Botez",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#8877b6"}},light:{type:"solid",data:{color:"#efefef"}},moveIndicator:{type:"color",data:"#7dacc97f"},border:{type:"solid",data:{color:"#554973"}},coords:{onLight:"#554973",onDark:"#f2f2f2",onBorder:"#efefef"}},Ht={name:"Beige",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#b0a392"}},light:{type:"solid",data:{color:"#cfc8be"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#6e6559"}},coords:{onLight:"#6e6559",onDark:"#f5eee5",onBorder:"#f5eee5"}},jt={name:"Rose",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#F04A73"}},light:{type:"solid",data:{color:"#F7A8A1"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#A62444"}},coords:{onLight:"#f04a73",onDark:"#ffb8c9",onBorder:"#ffb8c9"}},Ut={name:"Avocado",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#72a843"}},light:{type:"solid",data:{color:"#ececa4"}},moveIndicator:{type:"hueShift",data:70},border:{type:"solid",data:{color:"#2d3923"}},coords:{onLight:"#4d7a26",onDark:"#ffffc4",onBorder:"#ececa4"}},Xt={name:"Mono Teal",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#106C73"}},light:{type:"solid",data:{color:"#4C989D"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#106C73"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Yt={name:"Mono Chico",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#885953"}},light:{type:"solid",data:{color:"#AB8A86"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#885953"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},qt={name:"Mono Goblin",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#468557"}},light:{type:"solid",data:{color:"#7DA989"}},moveIndicator:{type:"hueShift",data:40},border:{type:"solid",data:{color:"#468557"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Kt={name:"Mono Mahogany",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#CA3838"}},light:{type:"solid",data:{color:"#DA7373"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#CA3838"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Jt={name:"Mono Blue",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C95D3B"}},light:{type:"solid",data:{color:"#D98D75"}},moveIndicator:{type:"hueShift",data:30},border:{type:"solid",data:{color:"#C95D3B"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Vt={name:"Mono Mulberry",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#C24B84"}},light:{type:"solid",data:{color:"#D481A9"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#C24B84"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Qt={name:"Mono Sycamore",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#809D41"}},light:{type:"solid",data:{color:"#A6BA7A"}},moveIndicator:{type:"hueShift",data:60},border:{type:"solid",data:{color:"#809D41"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},Zt={name:"Mono Blue",category:"solid",background:{type:"solid",data:{color:"transparent"}},dark:{type:"solid",data:{color:"#514FAE"}},light:{type:"solid",data:{color:"#8583C6"}},moveIndicator:{type:"hueShift",data:-30},border:{type:"solid",data:{color:"#514FAE"}},coords:{onLight:"#00000088",onDark:"#ffffffcc",onBorder:"#ffffffcc"}},eo={name:"Smooth Sunset",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5B061","#EC366D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC7D47","#C32C73"]}},coords:{onLight:"#CF545D",onDark:"#fff",onBorder:"#fff"}},to={name:"Smooth Summer",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#F5CB61","#F58D61"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffee55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#D1AC4F","#D07852"]}},coords:{onLight:"#B2793C",onDark:"#fff",onBorder:"#fff"}},oo={name:"Smooth Spring",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#D9DC5C","#60C945"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#B9BC4E","#50A839"]}},coords:{onLight:"#81A33A",onDark:"#fff",onBorder:"#fff"}},ao={name:"Smooth Forest",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#96C93D","#00B09B"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#65A32E","#007A80"]}},coords:{onLight:"#328E57",onDark:"#fff",onBorder:"#fff"}},no={name:"Smooth Laguna",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#00c4a0","#096fe0"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#009c7f","#0052ad"]}},coords:{onLight:"#007795",onDark:"#fff",onBorder:"#fff"}},ro={name:"Smooth Sea",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#2881E4","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ff00ff55"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#1863B7","#773DC1"]}},coords:{onLight:"#4750BC",onDark:"#fff",onBorder:"#fff"}},so={name:"Smooth Violet",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#DC3BCC","#9E52FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#AF2EA2","#8243D3"]}},coords:{onLight:"#9838BA",onDark:"#fff",onBorder:"#fff"}},io={name:"Smooth Mono",category:"gradient",background:{type:"gradient",data:{dir:"diagonal-top",colors:["#BFBFBF","#7D7D7D"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff7f"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"diagonal-top",colors:["#A1A1A1","#606060"]}},coords:{onLight:"#818181",onDark:"#fff",onBorder:"#fff"}},lo={name:"Contrast A",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#ff9b38","#389bff"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#3cff0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#f27f0d","#0d7ff2"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},co={name:"Contrast B",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF4DA6","#4D74FF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#BB3D7C","#3653BB"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},ho={name:"Contrast C",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#FF8D4D","#914DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#00ffff55"},border:{type:"gradient",data:{dir:"vertical",colors:["#E8702C","#6334B0"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},fo={name:"Contrast D",category:"gradient",background:{type:"gradient",data:{dir:"vertical",colors:["#61c43f","#864DFF"]}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"#ffffff66"}},moveIndicator:{type:"color",data:"#ffaa0055"},border:{type:"gradient",data:{dir:"vertical",colors:["#559a3c","#6333cc"]}},coords:{onLight:"#00000077",onDark:"#fff",onBorder:"#fff"}},go={name:"Wood 1",category:"pic",background:{type:"image",data:{src:"/textures/wood01.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood01_bg.jpg"}},coords:{onLight:"#604939",onDark:"#e1d0b7",onBorder:"#dac4a4"},ico:"/textures/wood01_ico.png"},uo={name:"Wood 2",category:"pic",background:{type:"image",data:{src:"/textures/wood02.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood02_bg.jpg"}},coords:{onLight:"#704642",onDark:"#e1c1b7",onBorder:"#d9b1a5"},ico:"/textures/wood02_ico.png"},po={name:"Wood 3",category:"pic",background:{type:"image",data:{src:"/textures/wood03.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood03_bg.jpg"}},coords:{onLight:"#986738",onDark:"#e2d3b6",onBorder:"#dac7a0"},ico:"/textures/wood03_ico.png"},mo={name:"Wood 4",category:"pic",background:{type:"image",data:{src:"/textures/wood04.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#ff007733"},border:{type:"image",data:{src:"/textures/wood04_bg.jpg"}},coords:{onLight:"#9e543b",onDark:"#e3c7b5",onBorder:"#ddbba4"},ico:"/textures/wood04_ico.png"},yo={name:"Wood 5",category:"pic",background:{type:"image",data:{src:"/textures/wood05.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood05_bg.jpg"}},coords:{onLight:"#8f653d",onDark:"#e3ceb5",onBorder:"#dcc2a3"},ico:"/textures/wood05_ico.png"},bo={name:"Wood 6",category:"pic",background:{type:"image",data:{src:"/textures/wood06.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood06_bg.jpg"}},coords:{onLight:"#865946",onDark:"#dfc8b9",onBorder:"#d7bba8"},ico:"/textures/wood06_ico.png"},vo={name:"Wood 7",category:"pic",background:{type:"image",data:{src:"/textures/wood07.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood07_bg.jpg"}},coords:{onLight:"#734926",onDark:"#cab99b",onBorder:"#cab99b"},ico:"/textures/wood07_ico.png"},_o={name:"Wood 8",category:"pic",background:{type:"image",data:{src:"/textures/wood08.jpg"}},dark:{type:"solid",data:{color:"transparent"}},light:{type:"solid",data:{color:"transparent"}},moveIndicator:{type:"color",data:"#55ff0022"},border:{type:"image",data:{src:"/textures/wood08_bg.jpg"}},coords:{onLight:"#723627",onDark:"#cbad9a",onBorder:"#cbad9a"},ico:"/textures/wood08_ico.png"},se={standard:wt,spring:kt,azure:St,violet:zt,rose:jt,peach:Ot,clay:Ct,rock:Bt,lila:Rt,leko:Tt,patina:Mt,mud:Ht,danny:Et,dannyGreen:Lt,dannyCyan:Dt,dannyBlue:Pt,dannyPurple:Nt,dannyPink:It,dannyRed:xt,dannyYellow:At,lichess:Ft,danya:Wt,botez:Gt,avocado:Ut,monoChico:Yt,monoMojo:Jt,monoMahogany:Kt,monoMulberry:Vt,monoBlue:Zt,monoTeal:Xt,monoGoblin:qt,monoSycamore:Qt,smoothSunset:eo,smoothSummer:to,smoothSpring:oo,smoothForest:ao,smoothLaguna:no,smoothSea:ro,smoothViolet:so,smoothMono:io,contrastA:lo,contrastB:co,contrastC:ho,contrastD:fo,wood1:go,wood2:uo,wood3:po,wood4:mo,wood5:yo,wood6:bo,wood7:vo,wood8:_o},$o={size:720,tiles:8,boardStyle:"standard",piecesStyle:"tatiana",showBorder:!0,showExtraInfo:!0,showMaterial:!0,showMoveIndicator:!0,showChecks:!0,showCoords:!0,showShadows:!1,flipped:!1},wo={White:"White",Black:"Black",WhitePretty:"White",BlackPretty:"Black",WhiteElo:null,BlackElo:null,Date:null,DatePretty:null,Event:null,Round:null,Site:null,Result:null};class oe{cfg=$o;_anonymous=!1;scale=1;size=0;squareSize=0;innerSize=0;borderWidth=0;margin=0;style=se.standard;header=wo;lastPosition=null;background=null;currentScreen="move";ctx;tempCtx;tempCanvas=document.createElement("canvas");canvas=document.createElement("canvas");constructor(e={}){const t=this.canvas.getContext("2d"),a=this.tempCanvas.getContext("2d");if(this.canvas.classList.add("board"),t===null||a===null)throw new Error("Cannot create canvas 2D context");this.ctx=t,this.tempCtx=a,this.updateConfig(e,!1)}async setCanvas(e){this.canvas=e,this.ctx=e.getContext("2d"),this.setSize(this.cfg.size),await this.refresh()}async updateConfig(e,t=!0){const a={...this.cfg,...e};this.cfg=a,this.setSize(a.size),this.setStyle(a.boardStyle),t&&await this.refresh()}set anonymous(e){this._anonymous=e,this.refresh()}async refresh(){await this.renderBackground(),this.currentScreen==="title"?await this.titleFrame(this.header):this.lastPosition!==null&&await this.frame(this.lastPosition,this.header),this.render()}setSize(e){this.size=e,this.scale=e/720,this.margin=this.cfg.showExtraInfo?Math.round(50*this.scale):0;const t=e+this.margin*2;(this.canvas.width!==e||this.canvas.height!==t)&&(this.canvas.width=e,this.canvas.height=t,this.tempCanvas.width=e,this.tempCanvas.height=t);const a=this.cfg.showBorder?this.size/32:0,n=this.size-a*2;return this.squareSize=Math.floor(n/this.cfg.tiles),this.innerSize=this.squareSize*this.cfg.tiles,this.borderWidth=(this.size-this.innerSize)/2,this}getSize(){return this.size}setStyle(e){return this.style=se[e],this.cfg.boardStyle=e,this.refresh(),this}setPiecesStyle(e){return this.cfg.piecesStyle=e,this.refresh(),this}flip(){return this.cfg.flipped=!this.cfg.flipped,this.refresh(),this}flipWhite(){if(!!this.cfg.flipped)return this.cfg.flipped=!1,this.refresh(),this}flipBlack(){if(!this.cfg.flipped)return this.cfg.flipped=!0,this.refresh(),this}hideBorder(){return this.cfg.showBorder=!1,this.setSize(this.size),this.refresh(),this}showBorder(){return this.cfg.showBorder=!0,this.setSize(this.size),this.refresh(),this}toggleBorder(){return this.cfg.showBorder=!this.cfg.showBorder,this.setSize(this.size),this.refresh(),this}toggleExtraInfo(){return this.cfg.showExtraInfo=!this.cfg.showExtraInfo,this.setSize(this.size),this.refresh(),this}toggleShadows(){return this.cfg.showShadows=!this.cfg.showShadows,this.refresh(),this}getFinalHeader(){return this._anonymous?{...this.header,White:"Anonymous",Black:"Anonymous",WhitePretty:"Anonymous",BlackPretty:"Anonymous",Site:te(this.header.Site)?null:this.header.Site}:{...this.header,Site:te(this.header.Site)?this.header.Site.replace(/^http[s]*:\/\//,""):this.header.Site}}async titleFrame(e){this.currentScreen="title",this.header=e,await _t(this.tempCtx,this.size,this.scale,this.margin,this.style,this.getFinalHeader())}async renderBackground(){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.size,e.height=this.size+this.margin*2;const{background:a,dark:n,light:s,border:i,coords:l}=this.style;await Y(t,this.width,this.height,0,0,i),await Y(t,this.innerSize,this.innerSize,this.cfg.showBorder?this.borderWidth:0,(this.cfg.showBorder?this.borderWidth:0)+this.margin,a,this.cfg.tiles);for(let c=0;c<this.cfg.tiles;c++)for(let h=0;h<this.cfg.tiles;h++){const u=h%2===0&&c%2===0||h%2!==0&&c%2!==0?s:n,d=h*this.squareSize+this.borderWidth,_=c*this.squareSize+this.borderWidth+this.margin;await Y(t,this.squareSize,this.squareSize,d,_,u)}this.cfg.showBorder&&this.cfg.showCoords&&fe(t,l,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.background=e}async frame(e,t){this.currentScreen="move",this.lastPosition=e,this.header=t??this.header,this.tempCtx.clearRect(0,0,this.size,this.size),this.background===null&&await this.renderBackground(),this.tempCtx.drawImage(await this.background,0,0),this.lastPosition?.move&&this.cfg.showMoveIndicator&&await rt(this.tempCtx,this.lastPosition.move,this.squareSize,this.style,this.borderWidth,this.cfg.tiles,this.cfg.flipped,this.margin),!this.cfg.showBorder&&this.cfg.showCoords&&fe(this.tempCtx,this.style.coords,this.squareSize,this.cfg.tiles,this.cfg.flipped,this.borderWidth,this.size,this.cfg.showBorder,this.margin),this.lastPosition&&(await vt(this.tempCtx,this.lastPosition,this.squareSize,this.borderWidth,this.cfg.flipped,this.margin,this.cfg.piecesStyle,this.cfg.showShadows),this.cfg.showExtraInfo&&t&&await $t(this.tempCtx,this.width,this.height,this.scale,this.margin,this.style,this.getFinalHeader(),this.cfg.flipped,this.lastPosition))}render(){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.drawImage(this.tempCanvas,0,0)}toImgUrl(){return this.canvas.toDataURL()}toImageData(){return this.ctx.getImageData(0,0,this.width,this.height)}toClampedArray(){return this.ctx.getImageData(0,0,this.width,this.height).data}toImgElement(){const e=this.toImgUrl(),t=new Image;return t.classList.add("board"),t.src=e,t}get width(){return this.size}get height(){return this.size+this.margin*2}toGIF(){}}const D={move:new x.Howl({src:["/sfx/mp3/move.mp3"],volume:.3}),take:new x.Howl({src:["/sfx/mp3/take.mp3"],volume:.9}),swap:new x.Howl({src:["/sfx/mp3/swap.mp3"],volume:.6}),snap:new x.Howl({src:["/sfx/mp3/snap.mp3"],volume:.6}),rewind:new x.Howl({src:["/sfx/mp3/rewind.mp3"],volume:.2}),snort:new x.Howl({src:["/sfx/mp3/snort.mp3"],volume:.5}),neigh:new x.Howl({src:["/sfx/mp3/neigh.mp3"],volume:.5}),fanfare:new x.Howl({src:["/sfx/mp3/fanfare.mp3"],volume:.5}),brickMove:new x.Howl({src:["/sfx/mp3/brick-move.mp3"],volume:.3}),brickTake:new x.Howl({src:["/sfx/mp3/brick-take.mp3"],volume:.2}),brickCastle:new x.Howl({src:["/sfx/mp3/brick-castle.mp3"],volume:.3}),coneMove:new x.Howl({src:["/sfx/mp3/cone-move.mp3"],volume:1}),coneTake:new x.Howl({src:["/sfx/mp3/cone-take.mp3"],volume:.3}),pipiMove:new x.Howl({src:["/sfx/mp3/pipi-move.mp3"],volume:.5}),pipiTake:new x.Howl({src:["/sfx/mp3/pipi-take.mp3"],volume:.3})},$e={x:" takes ","+":" check!","#":" mate!","=":" promotes to a ",P:"pawn ",R:"rook ",B:"bishop ",N:"knight ",Q:"queen ",K:"king ","O-O":"short castle","O-O-O":"long castle"},Z={volume:50,rate:1,lang:"en-US"},ko=o=>{if(o==="O-O"||o==="O-O-O")o=$e[o];else{const e=o.match(/[a-h1-8][a-h][1-8]/);e&&(o=o.replace(e[0],`${e[0][0]} ${e[0][1]}${e[0][2]}`)),o=o.split("").map(t=>$e[t]??t).join("").replace(/\s{2,}/g," ")}return o};class So{voice;constructor(){const e=speechSynthesis.getVoices();this.voice=e.find(t=>t.lang===Z.lang)}say(e){const t=new SpeechSynthesisUtterance(e);t.volume=Z.volume/100,t.lang=Z.lang,this.voice&&(t.voice=this.voice),t.rate=1+Z.rate/10,speechSynthesis.speak(t)}}const Co=o=>new Promise(e=>setTimeout(e,o));class Bo{constructor(e,t){this.board=e,this.config=t,this.speech=new So}interval=1e3;game=new q;ply=0;callback=()=>{};speech;playing=!1;async init(){await this.board.frame(this.game.getPosition(0),this.game.header).then(e=>this.board.render())}watch(e){this.callback=e}updateConfig(e){this.config={...this.config,...e}}getPosition(){const e=this.game.getPosition(this.ply);return y({ply:e.ply}),y({fen:e.fen}),e}async load(e){this.pause(),this.game=e,this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async play(){for(this.playing=!0,this.callback(this.playing,this.ply),this.ply===this.game.getMoves().length&&this.first();await Co(this.interval),!!this.playing;)this.next()}pause(){this.playing=!1,this.callback(this.playing,this.ply)}async prev(){const e=this.ply-1;if(!(e<-1||e<0&&this.config.titleScreen===!1)){if(this.ply=e,e===-1){await this.board.titleFrame(this.game.header),this.board.render();return}await this.board.frame(this.getPosition(),this.game.header),this.board.render(),r.siteConfig.sounds&&D.rewind.play()}}playSFX(e){e.mate?D.snap.play():/[ce]/.test(e.move?.flags)?D.take.play():/[kqp]/.test(e.move?.flags)?D.swap.play():D.move.play()}playAnarchySFX(e){if(e.mate&&D.snap.play(),e.move?.flags&&e.move.flags.includes("e")&&D.fanfare.play(),e.move?.flags&&e.move.flags.includes("p")&&D.brickCastle.play(),e.move?.flags&&e.move.flags.includes("c"))switch(e.move.piece){case"p":D.coneTake.play();break;case"r":D.brickTake.play();break;case"n":D.take.play(),D.neigh.play();break;case"k":D.pipiTake.play();break;default:D.take.play()}else if(/[kq]/.test(e.move?.flags))D.brickCastle.play();else switch(e.move?.piece){case"p":D.coneMove.play();break;case"r":D.brickMove.play();break;case"n":D.snort.play();break;case"k":D.pipiMove.play();break;default:D.move.play()}}async next(){const e=this.ply+1;if(e>=this.game.length){this.pause();return}this.ply=e;const t=this.getPosition();if(await this.board.frame(t,this.game.header),this.board.render(),this.ply>0&&r.siteConfig.speech&&this.speech.say(ko(t.move?.san)),this.ply>0&&r.siteConfig.sounds&&(r.boardConfig.piecesStyle==="anarchy"?this.playAnarchySFX(t):this.playSFX(t)),t.end===0&&r.siteConfig.speech){const a=this.game.header.Result;a&&this.speech.say(a==="1-0"?"White wins!":a==="0-1"?"Black wins!":"Draw!")}}async first(){this.ply=0,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async last(){this.ply=this.game.length-1,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}async goto(e){this.ply=e,await this.board.frame(this.getPosition(),this.game.header),this.board.render()}}const Eo=v('<header class="header-box"><div class="header__logo"><a href="/"><div class="header__logo-pic"></div></a></div><div class="header__options"><div class="header__options-ico" title="ABOUT"><i class="las la-question-circle"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico"><i class="las"></i></div><div class="header__options-ico" title="SOURCE CODE"><a href="https://github.com/sharechess/sharechess" target="_blank"><i class="lab la-github"></i></a></div></div></header>'),Lo=o=>(()=>{const e=Eo.cloneNode(!0),t=e.firstChild,a=t.nextSibling,n=a.firstChild,s=n.nextSibling,i=s.firstChild,l=s.nextSibling,c=l.firstChild,h=l.nextSibling,u=h.firstChild;return n.$$click=()=>y("about",!r.about),A(s,"click",o.handlers.toggleSound,!0),A(l,"click",o.handlers.toggleSpeech,!0),A(h,"click",o.handlers.toggleDarkMode,!0),I(d=>{const _=r.siteConfig.sounds?"MUTE":"SOUND ON",k=!r.siteConfig.sounds,b=r.siteConfig.sounds,p=r.siteConfig.speech?"SPEECH OFF":"SPEECH ON",B=!r.siteConfig.speech,S=r.siteConfig.speech,C=r.siteConfig.darkMode?"SWITCH TO LIGHT MODE":"SWITCH TO DARK MODE",f=r.siteConfig.darkMode,$=!r.siteConfig.darkMode;return _!==d._v$&&N(s,"title",d._v$=_),k!==d._v$2&&i.classList.toggle("la-volume-mute",d._v$2=k),b!==d._v$3&&i.classList.toggle("la-volume-up",d._v$3=b),p!==d._v$4&&N(l,"title",d._v$4=p),B!==d._v$5&&c.classList.toggle("la-deaf",d._v$5=B),S!==d._v$6&&c.classList.toggle("la-assistive-listening-systems",d._v$6=S),C!==d._v$7&&N(h,"title",d._v$7=C),f!==d._v$8&&u.classList.toggle("la-sun",d._v$8=f),$!==d._v$9&&u.classList.toggle("la-moon",d._v$9=$),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),e})();M(["click"]);const Do=v('<div><div class="scrollable__content"></div></div>'),Q=o=>(()=>{const e=Do.cloneNode(!0),t=e.firstChild;return m(t,()=>o.children),I(()=>e.className=`scrollable ${o.class}`),e})();const Po=v('<p class="moves__turn"></p>'),No=v('<div class="move"><span class="move__id">.</span><span class="move__ply"></span><span class="move__ply"></span></div>'),Io=o=>(Ue(()=>{r.mobile||document.querySelector(`[data-ply="${r.ply}"]`)?.scrollIntoView()}),g(Q,{get class(){return"moves"+(o.class?` ${o.class}`:"")},get children(){return[g(L,{get when(){return o.moves.length===0},get children(){const e=Po.cloneNode(!0);return m(e,(()=>{const t=re(()=>!!r.game.getPosition(0).mate,!0);return()=>t()?"Checkmate.":r.game.getPosition(0).turn==="w"?"White to move.":"Black to move."})()),e}}),g(le,{get each(){return Be(2,o.moves)},children:(e,t)=>{const[a,n]=e;return(()=>{const s=No.cloneNode(!0),i=s.firstChild,l=i.firstChild,c=i.nextSibling,h=c.nextSibling;return m(i,()=>t()+1,l),c.$$click=()=>o.handlers.goto(t()*2+1),m(c,a),h.$$click=()=>o.handlers.goto(t()*2+2),m(h,n),I(u=>{const d=r.ply===t()*2+1,_=t()*2+1,k=r.ply===t()*2+2,b=t()*2+2;return d!==u._v$&&c.classList.toggle("move__ply--current",u._v$=d),_!==u._v$2&&N(c,"data-ply",u._v$2=_),k!==u._v$3&&h.classList.toggle("move__ply--current",u._v$3=k),b!==u._v$4&&N(h,"data-ply",u._v$4=b),u},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),s})()}})]}}));M(["click"]);const xo=v('<i class="las la-play"></i>'),Ao=v('<div class="controls"><button class="controls__button controls__button--first" title="FIRST"><i class="las la-angle-double-left"></i></button><button class="controls__button" title="PREV"><i class="las la-angle-left"></i></button><button class="controls__button"></button><button class="controls__button controls__button--next" title="NEXT"><i class="las la-angle-right"></i></button><button class="controls__button controls__button--last" title="LAST"><i class="las la-angle-double-right"></i></button><button title="FLIP" class="flip__button"><i class="las la-sync rotatable" class="rotatable"></i></button></div>'),Fo=v('<i class="las la-pause"></i>'),Ne=o=>(()=>{const e=Ao.cloneNode(!0),t=e.firstChild,a=t.nextSibling,n=a.nextSibling,s=n.nextSibling,i=s.nextSibling,l=i.nextSibling,c=l.firstChild;return A(t,"click",o.handlers.first,!0),A(a,"click",o.handlers.prev,!0),A(n,"click",o.handlers.togglePlay,!0),m(n,g(L,{get when(){return!r.playing},get fallback(){return Fo.cloneNode(!0)},get children(){return xo.cloneNode(!0)}})),A(s,"click",o.handlers.next,!0),A(i,"click",o.handlers.last,!0),A(l,"click",o.handlers.flip,!0),I(h=>{const u=r.playing?"PAUSE":"PLAY",d=r.boardConfig.flipped;return u!==h._v$&&N(n,"title",h._v$=u),d!==h._v$2&&c.classList.toggle("rotated",h._v$2=d),h},{_v$:void 0,_v$2:void 0}),e})();M(["click"]);const Ie=o=>{if(o===null)return!1;try{return new URL(o).protocol==="https:"}catch{return!1}},we=v('<span class="info__rating"> (<!>)</span>'),ne=v("<p></p>"),To=v("<p>Round </p>"),Mo=v("<a></a>"),Ro=v('<div class="info"><div class="info__header"><div class="info__players"><div class="info__player"><div class="info__left"><button class="info__color info__color--white"></button></div><div class="info__right"><span class="info__score"></span></div></div><div class="info__player"><div class="info__left"><button class="info__color info__color--black"></button></div><div class="info__right"><span class="info__score"></span></div></div></div><div class="info__event"></div><div class="info__site"></div></div><div class="info__analyze"><button><i class="las la-vial"></i> </button></div></div>'),Oo=o=>{const[e,t]=W(!1);return(()=>{const a=Ro.cloneNode(!0),n=a.firstChild,s=n.firstChild,i=s.firstChild,l=i.firstChild;l.firstChild;const c=l.nextSibling,h=c.firstChild,u=i.nextSibling,d=u.firstChild;d.firstChild;const _=d.nextSibling,k=_.firstChild,b=s.nextSibling,p=b.nextSibling,B=n.nextSibling,S=B.firstChild;return S.firstChild.nextSibling,m(l,g(L,{get when(){return!r.anonymous},fallback:"Anonymous",get children(){return[re(()=>r.game.header.WhitePretty)," "]}}),null),m(l,g(L,{get when(){return r.game.header.WhiteElo},get children(){const f=we.cloneNode(!0),$=f.firstChild,w=$.nextSibling;return w.nextSibling,m(f,()=>r.game.header.WhiteElo,w),f}}),null),m(h,()=>r.game.header.Result==="1-0"?"1":r.game.header.Result==="0-1"?"0":r.game.header.Result==="1/2-1/2"?"1/2":""),m(d,g(L,{get when(){return!r.anonymous},fallback:"Anonymous",get children(){return[re(()=>r.game.header.BlackPretty)," "]}}),null),m(d,g(L,{get when(){return r.game.header.BlackElo},get children(){const f=we.cloneNode(!0),$=f.firstChild,w=$.nextSibling;return w.nextSibling,m(f,()=>r.game.header.BlackElo,w),f}}),null),m(k,()=>r.game.header.Result==="1-0"?"0":r.game.header.Result==="0-1"?"1":r.game.header.Result==="1/2-1/2"?"1/2":""),m(b,g(L,{get when(){return r.game.header.Event},get children(){const f=ne.cloneNode(!0);return m(f,()=>r.game.header.Event),f}}),null),m(b,g(L,{get when(){return r.game.header.Round},get children(){const f=To.cloneNode(!0);return f.firstChild,m(f,()=>r.game.header.Round,null),f}}),null),m(p,g(L,{get when(){return r.game.header.Site},get children(){const f=ne.cloneNode(!0);return m(f,g(L,{get when(){return!r.anonymous||!te(r.game.header.Site)},get children(){return g(L,{get when(){return Ie(r.game.header.Site)},get fallback(){return r.game.header.Site},get children(){const $=Mo.cloneNode(!0);return m($,()=>r.game.header.Site?.replace(/^https:\/\//,"")),I(()=>N($,"href",r.game.header.Site??"")),$}})}})),f}}),null),m(p,g(L,{get when(){return r.game.header.DatePretty},get children(){const f=ne.cloneNode(!0);return m(f,()=>r.game.header.DatePretty),f}}),null),S.$$click=async()=>{await o.handlers.openOnLichess()||(t(!0),setTimeout(()=>t(!1),1e3))},m(S,()=>e()?"Cannot import to lichess":"Analyze on Lichess",null),I(()=>S.classList.toggle("btn--error",e())),a})()};M(["click"]);const xe=o=>new Promise((e,t)=>{const a=new FileReader;a.onload=()=>{e(a.result)},a.onerror=t,a.readAsText(o)});const zo=v('<button class="load__game-btn"><i class="las la-paste"></i> </button>'),ke=v("<hr>"),Wo=v('<textarea class="load__game-input" name="load-game" placeholder="Paste PGN, FEN or Lichess link..."></textarea>'),Go=v('<button class="load__game-btn"></button>'),Ho=v('<input type="file" accept="application/vnd.chess-pgn,application/x-chess-pgn,.pgn">'),jo=v('<button class="load__pgn-btn load__pgn-file">Upload PGN file</button>'),Uo=v('<div class="load__pgn-file-info"><p>or</p><p>drop the PGN file anywhere on the page</p></div>'),Xo=o=>{const[e,t]=W(""),[a,n]=W(!1),[s,i]=W(!1);let l;return g(Q,{get class(){return"load"+(o.class?` ${o.class}`:"")},get children(){return[(()=>{const c=zo.cloneNode(!0);return c.firstChild.nextSibling,c.$$click=async()=>{await o.handlers.loadFromClipboard()||(n(!0),setTimeout(()=>n(!1),1e3))},m(c,()=>a()?"Incorrect data":"Load from clipboard",null),I(()=>c.classList.toggle("btn--error",a())),c})(),ke.cloneNode(!0),(()=>{const c=Wo.cloneNode(!0);return c.$$input=h=>t(h.currentTarget.value),N(c,"spellcheck",!1),I(()=>c.value=e()),c})(),(()=>{const c=Go.cloneNode(!0);return c.$$click=async()=>{await o.handlers.load(e())||(i(!0),setTimeout(()=>i(!1),1e3)),t("")},m(c,()=>s()?"Incorrect data":"LOAD"),I(()=>c.classList.toggle("btn--error",s())),c})(),ke.cloneNode(!0),(()=>{const c=Ho.cloneNode(!0);c.addEventListener("change",async u=>{const d=u.target;if(d?.files&&d.files.length>0){const _=await xe(d.files[0]);y("refreshHash",!1),o.handlers.loadPGN(_)}});const h=l;return typeof h=="function"?h(c):l=c,c.style.setProperty("display","none"),c})(),(()=>{const c=jo.cloneNode(!0);return c.$$click=()=>{l&&l.click()},c})(),g(L,{get when(){return!r.mobile},get children(){return Uo.cloneNode(!0)}})]}})};M(["click","input"]);const ie=(o,e,t)=>{const a=typeof o=="string"?o:URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=`${e}.${t}`,n.target="_blank",n.click(),URL.revokeObjectURL(a)},Ae=async o=>{const[e,t]=o.pathname.replace(/^\//,"").split("/").map(a=>a.trim());if(/^(([a-z0-9]{8})|([a-z0-9]{12}))$/i.test(e)){const a=e.slice(0,8),n=await fetch(`https://lichess.org/game/export/${a}?evals=0&clocks=0`);if(!String(n.status).startsWith("2"))return{error:!0,errorType:"SERVER_ERROR"};const s=await n.text();return{error:!1,pgn:s,side:String(t).startsWith("black")||o.hash.startsWith("black")?"b":"w"}}return{error:!0,errorType:"INCORRECT_LINK"}},Yo=async o=>{let e;try{e=new URL(o)}catch{return{error:!0,errorType:"INCORRECT_LINK"}}return/^(www\.)*lichess\.org/.test(e.hostname)?Ae(e):{error:!0,errorType:"INCORRECT_LINK"}},ee={pgn:"",fen:"",side:"w",ply:0};let E={...ee};const X={set(o){if(o.fen){E={...ee},E.fen=o.fen,location.hash=`fen/${E.fen.replace(/ /g,"_")}`;return}o.pgn&&(E={...ee},E.pgn=pe(o.pgn)),o.side&&(E.side=o.side),o.ply!==void 0&&(E.ply=o.ply),location.hash=`pgn/${E.side}/${E.ply}/${E.pgn}`},get(){return location.href},getFENLink(o){return`${location.origin}/#fen/${o.replace(/ /g,"_")}`},async read(){const[o,...e]=location.hash.split("/");if(/fen/.test(o))E={...ee},E.fen=decodeURI(e.join("/")).replace(/_/g," ");else if(/pgn/.test(o)){const[t,a,...n]=e;E.side=t,E.ply=Number(a),E.pgn=n.join("/"),E.fen=""}else if(/lid/.test(o)){const[t,a,...n]=e;E.side=t,E.ply=Number(a);const s=await Ae(new URL(`https://lichess.org/${n[0]}`));s.error?(E.pgn="",E.fen=""):(E.pgn=pe(De(s.pgn)),E.fen="")}return{pgn:E.pgn?it(E.pgn):"",fen:E.fen,side:E.side,ply:E.ply}},entries(){return{...E}}},qo=v('<div class="share__view"><h2 class="header--first">Board options</h2><button class="options__button" title="TOGGLE ANONYMOUS"><i class="las la-user-secret"></i></button><button class="options__button"><i class="las la-expand"></i></button><button class="options__button"><i class="las la-info-circle"></i></button><button class="options__button"><i class="las la-heading"></i></button><button class="options__button"><i class="las la-cloud"></i></button></div>'),Se=v("<hr>"),Ko=v('<div class="share__fen"><h2>Current position</h2><input type="text" name="current_fen" readonly placeholder="Current FEN..."><div class="double"><button class="share__btn share__btn--left"></button><button class="share__btn share__btn--right"></button></div><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__btn"></button></div>'),Jo=v('<div class="share__pgn"><h2>Game</h2><div class="double"><button class="share__btn"></button><button class="share__btn"></button></div><div class="double"><button class="share__btn">Export PGN</button><button class="share__btn"></button></div></div>'),Vo=v('<div class="share__animation"><hr class="invisible"><button class="share__size share__size--first">XS</button><button class="share__size">S</button><button class="share__size">M</button><button class="share__size">L</button><button class="share__size share__size--last">XL</button><button class="share__format share__format--first">GIF</button><button class="share__format">MP4</button><button class="share__format share__format--last">WebM</button><button class="share__create-animation"></button></div>'),Fe=o=>{const[e,t]=W(""),[a,n]=W(!1),[s,i]=W(!1),l=c=>{t(c),setTimeout(()=>t(""),1e3)};return g(Q,{get class(){return"share"+(o.class?` ${o.class}`:"")},get children(){return[(()=>{const c=qo.cloneNode(!0),h=c.firstChild,u=h.nextSibling,d=u.nextSibling,_=d.nextSibling,k=_.nextSibling,b=k.nextSibling;return A(u,"click",o.handlers.toggleAnonymous,!0),A(d,"click",o.handlers.toggleBorder,!0),A(_,"click",o.handlers.toggleExtraInfo,!0),A(k,"click",o.handlers.toggleTitleScreen,!0),A(b,"click",o.handlers.toggleShadows,!0),I(p=>{const B=r.anonymous,S=r.boardConfig.showBorder,C=r.boardConfig.showBorder?"HIDE BORDER":"SHOW BORDER",f=r.boardConfig.showExtraInfo,$=r.boardConfig.showExtraInfo?"HIDE EXTRA INFO":"SHOW EXTRA INFO",w=r.gameConfig.titleScreen,P=r.gameConfig.titleScreen?"EXCLUDE TITLE SCREEN":"INCLUDE TITLE SCREEN",R=r.boardConfig.showShadows,O=r.boardConfig.showShadows?"HIDE SHADOWS":"SHOW SHADOWS";return B!==p._v$&&u.classList.toggle("options__button--active",p._v$=B),S!==p._v$2&&d.classList.toggle("options__button--active",p._v$2=S),C!==p._v$3&&N(d,"title",p._v$3=C),f!==p._v$4&&_.classList.toggle("options__button--active",p._v$4=f),$!==p._v$5&&N(_,"title",p._v$5=$),w!==p._v$6&&k.classList.toggle("options__button--active",p._v$6=w),P!==p._v$7&&N(k,"title",p._v$7=P),R!==p._v$8&&b.classList.toggle("options__button--active",p._v$8=R),O!==p._v$9&&N(b,"title",p._v$9=O),p},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),c})(),Se.cloneNode(!0),(()=>{const c=Ko.cloneNode(!0),h=c.firstChild,u=h.nextSibling,d=u.nextSibling,_=d.firstChild,k=_.nextSibling,b=d.nextSibling,p=b.nextSibling,B=p.nextSibling,S=B.nextSibling,C=S.nextSibling,f=C.nextSibling,$=f.nextSibling;return u.$$click=w=>{w.target.select()},_.$$click=()=>{navigator.clipboard.writeText(r.fen),l("fen")},m(_,()=>e()==="fen"?"Copied!":"Copy FEN"),k.$$click=()=>{navigator.clipboard.writeText(X.getFENLink(r.fen)),l("fen-link")},m(k,()=>e()==="fen-link"?"Copied!":"Copy link"),p.$$click=()=>y("gameConfig","picSize","XS"),B.$$click=()=>y("gameConfig","picSize","S"),S.$$click=()=>y("gameConfig","picSize","M"),C.$$click=()=>y("gameConfig","picSize","L"),f.$$click=()=>y("gameConfig","picSize","XL"),$.$$click=async()=>{n(!0),await o.handlers.downloadImage(),n(!1)},m($,()=>a()?"Please wait...":"Save as image"),I(w=>{const P=r.fen,R=r.gameConfig.picSize==="XS",O=r.gameConfig.picSize==="S",G=r.gameConfig.picSize==="M",K=r.gameConfig.picSize==="L",J=r.gameConfig.picSize==="XL";return P!==w._v$10&&(u.value=w._v$10=P),R!==w._v$11&&p.classList.toggle("share__size--active",w._v$11=R),O!==w._v$12&&B.classList.toggle("share__size--active",w._v$12=O),G!==w._v$13&&S.classList.toggle("share__size--active",w._v$13=G),K!==w._v$14&&C.classList.toggle("share__size--active",w._v$14=K),J!==w._v$15&&f.classList.toggle("share__size--active",w._v$15=J),w},{_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),c})(),g(L,{get when(){return r.pgn},get children(){return[Se.cloneNode(!0),(()=>{const c=Jo.cloneNode(!0),h=c.firstChild,u=h.nextSibling,d=u.firstChild,_=d.nextSibling,k=u.nextSibling,b=k.firstChild,p=b.nextSibling;return d.$$click=()=>{navigator.clipboard.writeText(r.anonymous?r.game.anonymousPGN:r.pgn),l("pgn")},m(d,()=>e()==="pgn"?"Copied!":"Copy PGN"),_.$$click=()=>{navigator.clipboard.writeText(window.location.href),l("pgn-link")},m(_,()=>e()==="pgn-link"?"Copied!":"Copy link"),b.$$click=()=>{const B=new Blob([r.pgn],{type:"application/vnd.chess-pgn;charset=utf-8"}),S=r.game.getFileName(r.anonymous);ie(B,S,"pgn")},p.$$click=()=>{const S=`[${r.game.getTitle({anonymous:r.anonymous})}](${window.location.href})`;navigator.clipboard.writeText(S),l("markdown")},m(p,()=>e()==="markdown"?"Copied!":"Copy markdown"),c})(),(()=>{const c=Vo.cloneNode(!0),h=c.firstChild,u=h.nextSibling,d=u.nextSibling,_=d.nextSibling,k=_.nextSibling,b=k.nextSibling,p=b.nextSibling,B=p.nextSibling,S=B.nextSibling,C=S.nextSibling;return u.$$click=()=>y("gameConfig","animationSize","XS"),d.$$click=()=>y("gameConfig","animationSize","S"),_.$$click=()=>y("gameConfig","animationSize","M"),k.$$click=()=>y("gameConfig","animationSize","L"),b.$$click=()=>y("gameConfig","animationSize","XL"),p.$$click=()=>y("gameConfig","format","GIF"),B.$$click=()=>y("gameConfig","format","MP4"),S.$$click=()=>y("gameConfig","format","WebM"),C.$$click=async()=>{i(!0),await o.handlers.downloadAnimation(),i(!1)},m(C,()=>s()?"Please wait...":"Save animation"),I(f=>{const $=r.gameConfig.animationSize==="XS",w=r.gameConfig.animationSize==="S",P=r.gameConfig.animationSize==="M",R=r.gameConfig.animationSize==="L",O=r.gameConfig.animationSize==="XL",G=r.gameConfig.format==="GIF",K=r.gameConfig.format==="MP4",J=r.gameConfig.format==="WebM";return $!==f._v$16&&u.classList.toggle("share__size--active",f._v$16=$),w!==f._v$17&&d.classList.toggle("share__size--active",f._v$17=w),P!==f._v$18&&_.classList.toggle("share__size--active",f._v$18=P),R!==f._v$19&&k.classList.toggle("share__size--active",f._v$19=R),O!==f._v$20&&b.classList.toggle("share__size--active",f._v$20=O),G!==f._v$21&&p.classList.toggle("share__format--active",f._v$21=G),K!==f._v$22&&B.classList.toggle("share__format--active",f._v$22=K),J!==f._v$23&&S.classList.toggle("share__format--active",f._v$23=J),f},{_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0,_v$20:void 0,_v$21:void 0,_v$22:void 0,_v$23:void 0}),c})()]}})]}})};M(["click"]);const Qo=v("<div></div>"),Zo=async()=>{const o=[],e=new oe({size:144,tiles:2,showBorder:!0,showExtraInfo:!1});for(const[t,a]of Object.entries(se)){let n;a.ico?n=a.ico:(await e.updateConfig({boardStyle:t}),await e.frame(null),e.render(),n=e.toImgUrl()),o.push({key:t,name:a.name,category:a.category,img:n})}return o},Te=o=>{const[e,t]=W([]);return Zo().then(a=>t(a)),g(Q,{get class(){return"boards"+(o.class?` ${o.class}`:"")},get children(){return g(le,{get each(){return e()},children:a=>(()=>{const n=Qo.cloneNode(!0);return n.$$click=()=>{y("boardConfig","boardStyle",a.key),o.handlers.changeBoardStyle(a.key)},N(n,"draggable",!1),I(s=>{const i="boards__ico"+(r.boardConfig.boardStyle===a.key?" boards__ico--active":""),l=`url(${a.img})`,c=a.name;return i!==s._v$&&(n.className=s._v$=i),l!==s._v$2&&n.style.setProperty("background-image",s._v$2=l),c!==s._v$3&&N(n,"title",s._v$3=c),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),n})()})}})};M(["click"]);const ea=v("<img>"),ta=mt.map(o=>({key:o,img:`/pieces/${o}/nw.svg`})),Me=o=>g(Q,{get class(){return"pieces"+(o.class?` ${o.class}`:"")},get children(){return g(le,{each:ta,children:e=>(()=>{const t=ea.cloneNode(!0);return t.$$click=()=>{y("boardConfig","piecesStyle",e.key),o.handlers.changePiecesStyle(e.key)},N(t,"draggable",!1),I(a=>{const n="pieces__ico"+(r.boardConfig.piecesStyle===e.key?" pieces__ico--active":""),s=e.img,i=e.key;return n!==a._v$&&(t.className=a._v$=n),s!==a._v$2&&N(t,"src",a._v$2=s),i!==a._v$3&&N(t,"title",a._v$3=i),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()})}});M(["click"]);const oa=v("<button></button>"),j=o=>(()=>{const e=oa.cloneNode(!0);return e.$$click=()=>o.setTab(o.name),m(e,()=>o.children),I(()=>e.className="tab"+(o.isActive?" tab--active":"")),e})();M(["click"]);const aa=v('<i class="las la-chess-board"></i>'),na=v('<i class="las la-chess"></i>'),ra=v('<div class="game"><div class="game-tabs"></div></div>'),V=o=>{y("activeTab",o)},sa=o=>(()=>{const e=ra.cloneNode(!0),t=e.firstChild;return m(t,g(j,{name:"game",setTab:V,get isActive(){return r.activeTab==="game"},children:"GAME"}),null),m(t,g(j,{name:"load",setTab:V,get isActive(){return r.activeTab==="load"},children:"LOAD"}),null),m(t,g(L,{get when(){return r.layout!=="triple"},get children(){return[g(j,{name:"share",setTab:V,get isActive(){return r.activeTab==="share"},children:"SHARE"}),g(j,{name:"boards",setTab:V,get isActive(){return r.activeTab==="boards"},get children(){return aa.cloneNode(!0)}}),g(j,{name:"pieces",setTab:V,get isActive(){return r.activeTab==="pieces"},get children(){return na.cloneNode(!0)}})]}}),null),m(e,g(Ee,{get children(){return[g(H,{get when(){return r.activeTab==="game"},get children(){return[g(Oo,{get handlers(){return o.handlers}}),g(Io,{get moves(){return o.moves},get handlers(){return o.handlers},get class(){return r.layout==="single"?"span2":void 0}}),g(L,{get when(){return r.layout!=="single"},get children(){return g(Ne,{get handlers(){return o.handlers}})}})]}}),g(H,{get when(){return r.activeTab==="load"},get children(){return g(Xo,{get handlers(){return o.handlers},class:"span3"})}}),g(L,{get when(){return r.layout!=="triple"},get children(){return[g(H,{get when(){return r.activeTab==="share"},get children(){return g(Fe,{get handlers(){return o.handlers},class:"span3"})}}),g(H,{get when(){return r.activeTab==="boards"},get children(){return g(Te,{get handlers(){return o.handlers},class:"span3"})}}),g(H,{get when(){return r.activeTab==="pieces"},get children(){return g(Me,{get handlers(){return o.handlers},class:"span3"})}})]}})]}}),null),I(()=>t.classList.toggle("game-tabs--condensed",r.layout!=="triple")),e})();const ia=v('<i class="las la-share"></i>'),la=v('<i class="las la-chess-board"></i>'),ca=v('<i class="las la-chess"></i>'),da=v('<div class="setup"><div class="setup-tabs"></div></div>'),ha=o=>{const[e,t]=W("share");return(()=>{const a=da.cloneNode(!0),n=a.firstChild;return m(n,g(j,{name:"share",setTab:t,get isActive(){return e()==="share"},get children(){return[ia.cloneNode(!0)," SHARE"]}}),null),m(n,g(j,{name:"boards",setTab:t,get isActive(){return e()==="boards"},get children(){return[la.cloneNode(!0)," BOARDS"]}}),null),m(n,g(j,{name:"pieces",setTab:t,get isActive(){return e()==="pieces"},get children(){return[ca.cloneNode(!0)," PIECES"]}}),null),m(a,g(Ee,{get children(){return[g(H,{get when(){return e()==="share"},get children(){return g(Fe,{get handlers(){return o.handlers}})}}),g(H,{get when(){return e()==="boards"},get children(){return g(Te,{get handlers(){return o.handlers}})}}),g(H,{get when(){return e()==="pieces"},get children(){return g(Me,{get handlers(){return o.handlers}})}})]}}),null),a})()};const fa=v('<div class="popup"><div class="popup__box"><button class="popup__close"><i class="las la-times"></i></button><h2 class="popup__title"></h2><div class="popup__content"></div></div></div>'),he=o=>(()=>{const e=fa.cloneNode(!0),t=e.firstChild,a=t.firstChild,n=a.nextSibling,s=n.nextSibling;return A(a,"click",o.onClose,!0),m(n,()=>o.title),m(s,()=>o.children),e})();M(["click"]);const F=o=>{switch(o){case"board":localStorage.setItem("boardConfig",JSON.stringify(r.boardConfig));break;case"game":localStorage.setItem("gameConfig",JSON.stringify(r.gameConfig));break;case"site":localStorage.setItem("siteConfig",JSON.stringify(r.siteConfig));break}},ga=v("<p>Saving files may not work correctly in this browser.</p>"),ua=v("<p>To enjoy the full functionality of the website, please open it in <u><b>Safari</b></u>.</p>"),pa=()=>g(L,{get when(){return!r.siteConfig.iOSAppPopup&&r.siteConfig.wrongBrowserPopup&&r.os==="iOS"&&!r.browser?.includes("Safari")},get children(){return g(he,{onClose:()=>{y("siteConfig","wrongBrowserPopup",!1),F("site")},title:"Note",get children(){return[ga.cloneNode(!0),ua.cloneNode(!0)]}})}}),ma=v("<p>For easy access, you can install this website as a standalone app.</p>"),ya=v("<ul>To do that:<li>open the website in Chrome,</li><li>tap the menu icon (3 dots in the corner),</li><li>tap <u><b>Add to Home screen</b></u>.</li></ul>"),ba=()=>g(L,{get when(){return r.siteConfig.androidAppPopup&&r.os?.includes("Android")},get children(){return g(he,{onClose:()=>{y("siteConfig","androidAppPopup",!1),F("site")},title:"Tip",get children(){return[ma.cloneNode(!0),ya.cloneNode(!0)]}})}}),va=v("<p>For easy access, you can install this website as a standalone app.</p>"),_a=v("<ul>To do that:<li>open the website in Safari,</li><li>tap the Share icon,</li><li>tap <u><b>Add to Home Screen</b></u>.</li></ul>"),$a=()=>g(L,{get when(){return r.siteConfig.iOSAppPopup&&r.os?.includes("iOS")},get children(){return g(he,{onClose:()=>{y("siteConfig","iOSAppPopup",!1),F("site")},title:"Tip",get children(){return[va.cloneNode(!0),_a.cloneNode(!0)]}})}});const wa=v("<hr>"),ka=v("<h2>Keyboard Shortcuts</h2>"),Sa=v('<div class="about__shortcuts"><ul><li><kbd>\u2192</kbd> Next move</li><li><kbd>\u2190</kbd> Previous move</li><li><kbd>\u2191</kbd> Start position</li><li><kbd>\u2193</kbd> Final position</li><li><kbd>f</kbd> Flip the board</li><li><kbd>Space</kbd> Play / Pause</li><li><kbd>Enter</kbd> Analyze on Lichess</li></ul><ul><li><kbd>l</kbd> Load from clipboard</li><li><kbd>a</kbd> Toggle anonymous</li><li><kbd>b</kbd> Toggle border</li><li><kbd>i</kbd> Toggle extra info</li><li><kbd>h</kbd> Toggle header (title screen)</li><li><kbd>s</kbd> Toggle shadows</li></ul></div>'),Ca=v('<div class="about"><div class="about__box"><button class="about__close"><i class="las la-times"></i></button><div class="about__content"><h2>About</h2><p><b>ShareChess</b> is a free, open source website that allows you to share chess games as self-contained replay links (the whole game is stored in the url without the need for a database), PNG images, or GIF / MP4 / WebM animations.</p><p>The website provides a high variety of chessboard and piece designs to serve as an open alternative for commercial chess GIF makers.</p><p>You can find the complete source code on our <a href="https://github.com/sharechess/sharechess">GitHub page</a>.</p></div></div></div>'),Ba=()=>g(L,{get when(){return r.about},get children(){const o=Ca.cloneNode(!0),e=o.firstChild,t=e.firstChild,a=t.nextSibling;return a.firstChild.nextSibling.nextSibling.nextSibling,t.$$click=()=>y("about",!r.about),m(a,g(L,{get when(){return!r.mobile},get children(){return[wa.cloneNode(!0),ka.cloneNode(!0),Sa.cloneNode(!0)]}}),null),o}});M(["click"]);const Ea=v('<div id="setup" class="setup-box"></div>'),La=v('<div><div class="layout"><div id="board" class="board-box"><canvas class="board" id="canvas"></canvas></div><div id="moves" class="game-box"></div></div></div>'),Da=o=>(()=>{const e=La.cloneNode(!0),t=e.firstChild,a=t.firstChild;a.firstChild;const n=a.nextSibling;return m(e,g(Lo,{get handlers(){return o.handlers}}),t),m(t,g(L,{get when(){return r.layout==="triple"},get children(){const s=Ea.cloneNode(!0);return m(s,g(ha,{get handlers(){return o.handlers}})),s}}),a),m(a,g(L,{get when(){return r.layout==="single"},get children(){return g(Ne,{get handlers(){return o.handlers}})}}),null),m(n,g(sa,{get moves(){return o.state.moves},get handlers(){return o.handlers}})),m(e,g(Ba,{}),null),m(e,g(pa,{}),null),m(e,g(ba,{}),null),m(e,g($a,{}),null),I(s=>{const i=!r.siteConfig.darkMode,l=r.layout==="double";return i!==s._v$&&e.classList.toggle("light",s._v$=i),l!==s._v$2&&a.classList.toggle("board-box--left",s._v$2=l),s},{_v$:void 0,_v$2:void 0}),e})(),Re={XS:360,S:512,M:720,L:1024,XL:1440},Pa=async(o,e,t=0,a,n)=>{const s=new q;e?s.loadPGN(e):s.loadFEN(o);const i=new oe({...a,size:Re[n]}),l=s.getPosition(t);return await i.frame(l,s.header),i.render(),i.toImgUrl()};class Oe{gif;frameTime;constructor(e,t,a,n=1e3){this.gif=new Xe({workers:2,quality:30,width:e,height:t,repeat:a?0:-1}),this.frameTime=n}add(e,t){for(;t--;)this.gif.addFrame(e,{delay:this.frameTime})}render(){return new Promise(e=>{const t=Date.now();this.gif.on("finished",function(a){const n=new File([a],`board_${t}.gif`,{type:"image/gif",lastModified:t});e(n)}),this.gif.render()})}}class Na{constructor(e=1e3){this.frameTime=e,this.video=new Ye({quality:.8,fileWriter:null,fd:null,frameDuration:1e3,transparent:!1})}video;add(e,t){this.video.addFrame(e,t*this.frameTime)}async render(){const e=await this.video.complete(),t=Date.now();return new File([e],`board_${t}.webm`,{type:"video/webm",lastModified:t})}}class ze{constructor(e,t,a=1e3){this.width=e,this.height=t,this.hme=qe.createH264MP4Encoder(),this.frameTime=a}hme;encoder=null;frameTime;async setup(e,t){this.encoder=await this.hme,this.encoder.width=e,this.encoder.height=t,this.encoder.frameRate=1e3/this.frameTime,this.encoder.quantizationParameter=10,this.encoder.initialize()}async add(e,t){for(this.encoder===null&&await this.setup(this.width,this.height);t--;)this.encoder?.addFrameRgba(e)}async render(){this.encoder?.finalize();const e=this.encoder?.FS.readFile(this.encoder.outputFilename),t=Date.now(),a=new File([e],`board_${t}.mp4`,{type:"video/mp4",lastModified:t});return this.encoder?.delete(),a}}const Ce=(o,e)=>e instanceof Oe?o.toImageData():e instanceof ze?o.toClampedArray():o.canvas,Ia=async(o,e,t,a,n)=>{const s=new q().loadPGN(o),i=new oe({...e,size:Re[a]}),l=t==="GIF"?new Oe(i.width,i.height,!0):t==="MP4"?new ze(i.width,i.height):new Na,c=s.header;n&&(await i.titleFrame(c),i.render(),await l.add(Ce(i,l),4));for(let h=0;h<s.length;h++){const u=s.getPosition(h);await i.frame(u,c),i.render();const d=u.end===0?5:u.ply===0&&!n?2:1;await l.add(Ce(i,l),d)}return await l.render()},xa=/^([1-8kqrbnp]+\/)+[1-8kqrbnp]+ [wb] ([kq]+|-) ([a-h1-8]{2}|-) \d+ \d+$/i,Aa=o=>xa.test(o.trim()),Fa=/((\[[a-z0-9]+ +"[^"\n\r]+"](\r\n|\r|\n))*(\r\n|\r|\n)+){0,1}\d+\. +[a-h1-8x+#=]+/i,Ta=o=>Fa.test(o),Ma=async(o,e)=>{if(e&&/^https:\/\/lichess\.org\/.{8}/.test(e))return e;const t=new URLSearchParams({pgn:o}).toString();try{const a=await fetch("https://lichess.org/api/import",{headers:{"content-type":"application/x-www-form-urlencoded"},body:t,method:"POST"});if(a.status===200)return(await a.json()).url;throw new Error("Cannot import to lichess")}catch{throw new Error("Cannot import to lichess")}},Ra=(o,e)=>({prev(){o.pause(),o.prev()},next(){o.pause(),o.next()},first(){o.pause(),o.first()},last(){o.pause(),o.last()},togglePlay(){o.playing?o.pause():o.play()},goto(t){o.pause(),o.goto(t)},toggleBorder(){e.toggleBorder(),y("boardConfig","showBorder",!r.boardConfig.showBorder),F("board")},showBorder(){e.showBorder(),y("boardConfig","showBorder",!0),F("board")},hideBorder(){e.hideBorder(),y("boardConfig","showBorder",!1),F("board")},toggleExtraInfo(){e.toggleExtraInfo(),y("boardConfig","showExtraInfo",!r.boardConfig.showExtraInfo),F("board")},toggleAnonymous(){if(y("anonymous",!r.anonymous),e.anonymous=r.anonymous,r.pgn!==""){const t=r.anonymous?r.game.anonymousPGN:r.game.pgn;X.set({pgn:t}),y("refreshHash",!1)}},toggleTitleScreen(){y("gameConfig","titleScreen",!r.gameConfig.titleScreen),F("game")},toggleShadows(){e.toggleShadows(),y("boardConfig","showShadows",!r.boardConfig.showShadows),F("board")},flip(){e.flip(),y("boardConfig","flipped",!r.boardConfig.flipped),y("refreshHash",!1),X.set({side:r.boardConfig.flipped?"b":"w"})},changeBoardStyle(t){e.setStyle(t),y("boardConfig","boardStyle",t),F("board")},changePiecesStyle(t){e.setPiecesStyle(t),y("boardConfig","piecesStyle",t),F("board")},async loadPGN(t,a="w",n=0){const s=new q().loadPGN(t);y({pgn:s.pgn,fen:"",moves:s.getMoves(),ply:0,game:s}),X.set({pgn:s.pgn,side:a,ply:n}),await o.load(s),y("activeTab","game"),a==="w"?e.flipWhite():e.flipBlack(),y("boardConfig","flipped",a==="b"),document.title=`ShareChess - ${s.getTitle({anonymous:!1})}`},async loadFEN(t,a=!0){const n=new q().loadFEN(t);y({pgn:"",fen:t,moves:n.getMoves(),ply:0,game:n}),await o.load(n),a&&(X.set({fen:r.fen}),y("activeTab","game"));const s=n.getPosition(0).turn;s==="w"?e.flipWhite():e.flipBlack(),y("boardConfig","flipped",s==="b"),document.title=`ShareChess - FEN ${t}`},async load(t){return y("refreshHash",!1),Aa(t)?(await this.loadFEN(t),!0):Ta(t)?(await this.loadPGN(t),!0):Ie(t)?(await this.importPGN(t),!0):!1},async loadFromClipboard(){const t=await navigator.clipboard.readText();return this.load(t)},async importPGN(t){const a=await Yo(t);a.error||await this.loadPGN(a.pgn,a.side)},async downloadImage(){await new Promise(a=>setTimeout(a,0));const t=await Pa(r.fen,r.pgn,r.ply,r.boardConfig,r.gameConfig.picSize);ie(t,`fen_${Date.now()}`,"png")},async downloadAnimation(){await new Promise(n=>setTimeout(n,0));const t=await Ia(r.pgn,r.boardConfig,r.gameConfig.format,r.gameConfig.animationSize,r.gameConfig.titleScreen),a=r.game.getFileName(r.anonymous);ie(t,a,r.gameConfig.format.toLowerCase())},toggleSound(){y("siteConfig","sounds",!r.siteConfig.sounds),F("site")},toggleSpeech(){y("siteConfig","speech",!r.siteConfig.speech),F("site")},toggleDarkMode(){y("siteConfig","darkMode",!r.siteConfig.darkMode),F("site")},async openOnLichess(){if(r.pgn==="")return window.open(`https://lichess.org/analysis/${r.fen.replace(/\s+/g,"_")}`),!0;try{const t=await Ma(r.pgn,r.game.header.Site);return window.open(`${t}/${r.boardConfig.flipped?"black":""}`),!0}catch{return!1}}}),We=async(o,e)=>{y("refreshHash",o);const{pgn:t,fen:a,side:n,ply:s}=await X.read();await(t?e.loadPGN(t,n,s):a?e.loadFEN(a):e.loadFEN("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",!1)),s!==0&&e.goto(s),y("refreshHash",!0)},Oa=o=>{if(document.addEventListener("dblclick",function(e){e.preventDefault()}),window.addEventListener("resize",()=>{y("layout",window.innerWidth<window.innerHeight?"single":window.innerWidth<1366?"double":"triple")}),window.addEventListener("hashchange",()=>{if(!r.refreshHash){y("refreshHash",!0);return}We(!0,o)}),!r.mobile){const e={ArrowLeft:o.prev,ArrowRight:o.next,ArrowUp:o.first,ArrowDown:o.last,f:o.flip," ":o.togglePlay,Enter:o.openOnLichess,l:o.loadFromClipboard.bind(o),a:o.toggleAnonymous,b:o.toggleBorder,i:o.toggleExtraInfo,h:o.toggleTitleScreen,s:o.toggleShadows};document.addEventListener("keydown",a=>{const n=a.target;e[a.key]&&n?.nodeName!=="INPUT"&&n?.nodeName!=="TEXTAREA"&&(a.preventDefault(),e[a.key]())});const t=a=>{a.preventDefault(),a.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(a=>{document.addEventListener(a,t,!1)}),document.addEventListener("drop",async a=>{if(a.dataTransfer?.files&&a.dataTransfer.files.length>0){const n=await xe(a.dataTransfer.files[0]);y("refreshHash",!1),o.loadPGN(n)}})}},za=async()=>{const o=new oe(r.boardConfig),e=new Bo(o,r.gameConfig);e.watch(n=>y("playing",n)),X.read();const t=Ra(e,o);Je(()=>g(Da,{handlers:t,state:r}),document.getElementById("root"));const a=document.getElementById("canvas");await o.setCanvas(a),await e.init(),await We(!1,t),Oa(t)};Promise.all([new Promise(o=>Ke.load({google:{families:["Ubuntu:500,700","Fira Mono:500"]},custom:{families:["Chess"],urls:["/fonts.css"]},active:()=>o(null)})).catch(()=>null),new Promise(o=>{speechSynthesis.getVoices().length>0?o(null):window.speechSynthesis.onvoiceschanged=o}).catch(()=>null)]).then(()=>za());
